{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/lib/auth.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { User, ActionType } from '@/types'; \nimport bcrypt from 'bcryptjs';\n\nconst prisma = new PrismaClient();\n\n// This is a placeholder for the real audit log function\nconst logAuditEvent = async (event: any) => {\n    console.log('Audit Event Logged:', event);\n    // In a real implementation, this would write to the AuditLog table\n};\n\nconst defaultNotificationPreferences = {\n  email: {\n    newAnnouncement: true,\n    newEvent: true,\n    directMessage: true,\n    groupChatMessage: false,\n    membershipUpdate: true,\n  },\n};\n\nconst defaultAccountSettings = {\n    timezonePreference: 'America/New_York',\n    dateFormat: 'MM/DD/YYYY',\n    timeFormat: '12h',\n    languagePreference: 'en-US',\n};\n\nexport async function registerUser(displayName: string, email: string, pass: string): Promise<{ success: boolean; message?: string; user?: User }> {\n  const existingUser = await prisma.user.findUnique({\n    where: { email: email.toLowerCase() },\n  });\n\n  if (existingUser) {\n    return { success: false, message: 'An account with this email already exists.' };\n  }\n\n  const hashedPassword = await bcrypt.hash(pass, 10);\n\n  const newUser = await prisma.user.create({\n    data: {\n      email: email.toLowerCase(),\n      password: hashedPassword,\n      isSuperAdmin: false,\n      profile: {\n        create: {\n          displayName,\n          avatarUrl: `https://i.pravatar.cc/48?u=user-${Date.now()}`,\n          bio: '',\n          locationCity: '',\n          locationCountry: '',\n          languages: '', // Storing as a comma-separated string\n        },\n      },\n      privacySettings: {\n        create: {\n          showAffiliations: true,\n        },\n      },\n      accountSettings: {\n        create: {\n            ...defaultAccountSettings\n        }\n      },\n      notificationPreferences: defaultNotificationPreferences,\n    },\n    include: {\n        profile: true,\n        privacySettings: true,\n        accountSettings: true,\n    }\n  });\n\n  await logAuditEvent({\n    actorUserId: newUser.id,\n    actionType: 'USER_REGISTERED', // This should be part of an enum\n    entityType: 'USER',\n    entityId: newUser.id,\n  });\n\n  // We need to be careful about what we return. The password should not be returned.\n  const { password, ...userWithoutPassword } = newUser;\n\n  return { success: true, user: userWithoutPassword as User };\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAE/B,wDAAwD;AACxD,MAAM,gBAAgB,OAAO;IACzB,QAAQ,GAAG,CAAC,uBAAuB;AACnC,mEAAmE;AACvE;AAEA,MAAM,iCAAiC;IACrC,OAAO;QACL,iBAAiB;QACjB,UAAU;QACV,eAAe;QACf,kBAAkB;QAClB,kBAAkB;IACpB;AACF;AAEA,MAAM,yBAAyB;IAC3B,oBAAoB;IACpB,YAAY;IACZ,YAAY;IACZ,oBAAoB;AACxB;AAEO,eAAe,aAAa,WAAmB,EAAE,KAAa,EAAE,IAAY;IACjF,MAAM,eAAe,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;QAChD,OAAO;YAAE,OAAO,MAAM,WAAW;QAAG;IACtC;IAEA,IAAI,cAAc;QAChB,OAAO;YAAE,SAAS;YAAO,SAAS;QAA6C;IACjF;IAEA,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,MAAM;IAE/C,MAAM,UAAU,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC;QACvC,MAAM;YACJ,OAAO,MAAM,WAAW;YACxB,UAAU;YACV,cAAc;YACd,SAAS;gBACP,QAAQ;oBACN;oBACA,WAAW,CAAC,gCAAgC,EAAE,KAAK,GAAG,IAAI;oBAC1D,KAAK;oBACL,cAAc;oBACd,iBAAiB;oBACjB,WAAW;gBACb;YACF;YACA,iBAAiB;gBACf,QAAQ;oBACN,kBAAkB;gBACpB;YACF;YACA,iBAAiB;gBACf,QAAQ;oBACJ,GAAG,sBAAsB;gBAC7B;YACF;YACA,yBAAyB;QAC3B;QACA,SAAS;YACL,SAAS;YACT,iBAAiB;YACjB,iBAAiB;QACrB;IACF;IAEA,MAAM,cAAc;QAClB,aAAa,QAAQ,EAAE;QACvB,YAAY;QACZ,YAAY;QACZ,UAAU,QAAQ,EAAE;IACtB;IAEA,mFAAmF;IACnF,MAAM,EAAE,QAAQ,EAAE,GAAG,qBAAqB,GAAG;IAE7C,OAAO;QAAE,SAAS;QAAM,MAAM;IAA4B;AAC5D"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/api/auth/register/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { registerUser } from '@/lib/auth';\n\nexport async function POST(request: Request) {\n  try {\n    const { displayName, email, password } = await request.json();\n\n    if (!displayName || !email || !password) {\n      return NextResponse.json({ message: 'Missing required fields' }, { status: 400 });\n    }\n\n    const result = await registerUser(displayName, email, password);\n\n    if (!result.success) {\n      return NextResponse.json({ message: result.message }, { status: 400 });\n    }\n\n    return NextResponse.json(result.user);\n  } catch (error) {\n    console.error('Registration error:', error);\n    return NextResponse.json({ message: 'An unexpected error occurred.' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3D,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,SAAS,MAAM,IAAA,6HAAY,EAAC,aAAa,OAAO;QAEtD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,OAAO,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO,IAAI;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACvF;AACF"}}]
}