{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/lib/auth.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\nimport { User, ActionType } from '@/types'; \r\nimport bcrypt from 'bcryptjs';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// This is a placeholder for the real audit log function\r\nconst logAuditEvent = async (event: any) => {\r\n    console.log('Audit Event Logged:', event);\r\n    // In a real implementation, this would write to the AuditLog table\r\n};\r\n\r\nconst defaultNotificationPreferences = {\r\n  email: {\r\n    newAnnouncement: true,\r\n    newEvent: true,\r\n    directMessage: true,\r\n    groupChatMessage: false,\r\n    membershipUpdate: true,\r\n  },\r\n};\r\n\r\nconst defaultAccountSettings = {\r\n    timezonePreference: 'America/New_York',\r\n    dateFormat: 'MM/DD/YYYY',\r\n    timeFormat: '12h',\r\n    languagePreference: 'en-US',\r\n};\r\n\r\nexport async function registerUser(displayName: string, email: string, pass: string): Promise<{ success: boolean; message?: string; user?: User }> {\r\n  const existingUser = await prisma.user.findUnique({\r\n    where: { email: email.toLowerCase() },\r\n  });\r\n\r\n  if (existingUser) {\r\n    return { success: false, message: 'An account with this email already exists.' };\r\n  }\r\n\r\n  const hashedPassword = await bcrypt.hash(pass, 10);\r\n\r\n  const newUser = await prisma.user.create({\r\n    data: {\r\n      email: email.toLowerCase(),\r\n      password: hashedPassword,\r\n      isSuperAdmin: false,\r\n      profile: {\r\n        create: {\r\n          displayName,\r\n          avatarUrl: `https://i.pravatar.cc/48?u=user-${Date.now()}`,\r\n          bio: '',\r\n          locationCity: '',\r\n          locationCountry: '',\r\n          languages: '', // Storing as a comma-separated string\r\n        },\r\n      },\r\n      privacySettings: {\r\n        create: {\r\n          showAffiliations: true,\r\n        },\r\n      },\r\n      accountSettings: {\r\n        create: {\r\n            ...defaultAccountSettings\r\n        }\r\n      },\r\n      notificationPreferences: defaultNotificationPreferences,\r\n    },\r\n    include: {\r\n        profile: true,\r\n        privacySettings: true,\r\n        accountSettings: true,\r\n    }\r\n  });\r\n\r\n  await logAuditEvent({\r\n    actorUserId: newUser.id,\r\n    actionType: 'USER_REGISTERED', // This should be part of an enum\r\n    entityType: 'USER',\r\n    entityId: newUser.id,\r\n  });\r\n\r\n  // We need to be careful about what we return. The password should not be returned.\r\n  const { password, ...userWithoutPassword } = newUser;\r\n\r\n  return { success: true, user: userWithoutPassword as User };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAE/B,wDAAwD;AACxD,MAAM,gBAAgB,OAAO;IACzB,QAAQ,GAAG,CAAC,uBAAuB;AACnC,mEAAmE;AACvE;AAEA,MAAM,iCAAiC;IACrC,OAAO;QACL,iBAAiB;QACjB,UAAU;QACV,eAAe;QACf,kBAAkB;QAClB,kBAAkB;IACpB;AACF;AAEA,MAAM,yBAAyB;IAC3B,oBAAoB;IACpB,YAAY;IACZ,YAAY;IACZ,oBAAoB;AACxB;AAEO,eAAe,aAAa,WAAmB,EAAE,KAAa,EAAE,IAAY;IACjF,MAAM,eAAe,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;QAChD,OAAO;YAAE,OAAO,MAAM,WAAW;QAAG;IACtC;IAEA,IAAI,cAAc;QAChB,OAAO;YAAE,SAAS;YAAO,SAAS;QAA6C;IACjF;IAEA,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,MAAM;IAE/C,MAAM,UAAU,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC;QACvC,MAAM;YACJ,OAAO,MAAM,WAAW;YACxB,UAAU;YACV,cAAc;YACd,SAAS;gBACP,QAAQ;oBACN;oBACA,WAAW,CAAC,gCAAgC,EAAE,KAAK,GAAG,IAAI;oBAC1D,KAAK;oBACL,cAAc;oBACd,iBAAiB;oBACjB,WAAW;gBACb;YACF;YACA,iBAAiB;gBACf,QAAQ;oBACN,kBAAkB;gBACpB;YACF;YACA,iBAAiB;gBACf,QAAQ;oBACJ,GAAG,sBAAsB;gBAC7B;YACF;YACA,yBAAyB;QAC3B;QACA,SAAS;YACL,SAAS;YACT,iBAAiB;YACjB,iBAAiB;QACrB;IACF;IAEA,MAAM,cAAc;QAClB,aAAa,QAAQ,EAAE;QACvB,YAAY;QACZ,YAAY;QACZ,UAAU,QAAQ,EAAE;IACtB;IAEA,mFAAmF;IACnF,MAAM,EAAE,QAAQ,EAAE,GAAG,qBAAqB,GAAG;IAE7C,OAAO;QAAE,SAAS;QAAM,MAAM;IAA4B;AAC5D"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/api/auth/register/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { registerUser } from '@/lib/auth';\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { displayName, email, password } = await request.json();\r\n\r\n    if (!displayName || !email || !password) {\r\n      return NextResponse.json({ message: 'Missing required fields' }, { status: 400 });\r\n    }\r\n\r\n    const result = await registerUser(displayName, email, password);\r\n\r\n    if (!result.success) {\r\n      return NextResponse.json({ message: result.message }, { status: 400 });\r\n    }\r\n\r\n    return NextResponse.json(result.user);\r\n  } catch (error) {\r\n    console.error('Registration error:', error);\r\n    return NextResponse.json({ message: 'An unexpected error occurred.' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3D,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,SAAS,MAAM,IAAA,6HAAY,EAAC,aAAa,OAAO;QAEtD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,OAAO,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO,IAAI;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACvF;AACF"}}]
}