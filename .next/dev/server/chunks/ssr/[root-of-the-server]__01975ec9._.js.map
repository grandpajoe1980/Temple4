{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\ndeclare global {\r\n  // allow global `var` declarations\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  globalThis.prisma ||\r\n  new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,SACX,WAAW,MAAM,IACjB,IAAI,6IAAY;AAElB,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/lib/data.ts"],"sourcesContent":["import { prisma } from './db';\r\nimport { Tenant, User, Post, Event, UserTenantMembership, Notification, AuditLog, Conversation, TenantRole, MembershipStatus, TenantSettings, TenantBranding } from '@prisma/client';\r\nimport bcrypt from 'bcryptjs';\r\n\r\ntype TenantWithDetails = Tenant & {\r\n    settings: TenantSettings | null;\r\n    branding: TenantBranding | null;\r\n};\r\n\r\nexport async function getTenantsForUser(userId: string): Promise<Tenant[]> {\r\n  const memberships = await prisma.userTenantMembership.findMany({\r\n    where: {\r\n      userId: userId,\r\n      status: 'APPROVED',\r\n    },\r\n    include: {\r\n      tenant: true,\r\n    },\r\n  });\r\n\r\n  return memberships.map((membership: { tenant: Tenant; }) => membership.tenant);\r\n}\r\n\r\nexport async function getTenantById(tenantId: string) {\r\n  return await prisma.tenant.findUnique({\r\n    where: { id: tenantId },\r\n    include: {\r\n      settings: true,\r\n      branding: true,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function getUserById(userId: string) {\r\n  return await prisma.user.findUnique({\r\n    where: { id: userId },\r\n    include: {\r\n      profile: true,\r\n      privacySettings: true,\r\n      accountSettings: true,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function getTenants(): Promise<Tenant[]> {\r\n    const tenants = await prisma.tenant.findMany({\r\n        include: {\r\n            settings: true,\r\n            branding: true,\r\n        }\r\n    });\r\n    \r\n    // Transform Prisma data to match Tenant interface with nested address\r\n    return tenants.map(tenant => ({\r\n        ...tenant,\r\n        address: {\r\n            street: tenant.street,\r\n            city: tenant.city,\r\n            state: tenant.state,\r\n            country: tenant.country,\r\n            postalCode: tenant.postalCode,\r\n        },\r\n        settings: tenant.settings || {\r\n            isPublic: true,\r\n            allowMemberDirectory: true,\r\n            allowEvents: true,\r\n            allowDonations: true,\r\n            allowSmallGroups: true,\r\n            allowMessaging: true,\r\n        },\r\n        branding: tenant.branding || {\r\n            logoUrl: '',\r\n            bannerImageUrl: '',\r\n            primaryColor: '#d97706',\r\n            accentColor: '#92400e',\r\n        },\r\n        permissions: tenant.permissions as any || {},\r\n    })) as Tenant[];\r\n}\r\n\r\nexport async function getEventsForTenant(tenantId: string): Promise<Event[]> {\r\n  return await prisma.event.findMany({\r\n    where: { tenantId },\r\n    orderBy: { startDateTime: 'asc' },\r\n  });\r\n}\r\n\r\nexport async function getPostsForTenant(tenantId: string): Promise<Post[]> {\r\n  return await prisma.post.findMany({\r\n    where: { tenantId, isPublished: true },\r\n    orderBy: { publishedAt: 'desc' },\r\n    include: {\r\n      author: {\r\n        include: {\r\n          profile: true,\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport async function getMembershipForUserInTenant(userId: string, tenantId: string): Promise<UserTenantMembership | null> {\r\n  return await prisma.userTenantMembership.findUnique({\r\n    where: {\r\n      userId_tenantId: {\r\n        userId,\r\n        tenantId,\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nexport async function getNotificationsForUser(userId: string): Promise<Notification[]> {\r\n    return await prisma.notification.findMany({\r\n        where: { userId },\r\n        orderBy: { createdAt: 'desc' },\r\n    });\r\n}\r\n\r\nexport async function markNotificationAsRead(notificationId: string): Promise<Notification> {\r\n    return await prisma.notification.update({\r\n        where: { id: notificationId },\r\n        data: { isRead: true },\r\n    });\r\n}\r\n\r\nexport async function markAllNotificationsAsRead(userId: string) {\r\n    return await prisma.notification.updateMany({\r\n        where: { userId },\r\n        data: { isRead: true },\r\n    });\r\n}\r\n\r\nexport async function getUserByEmail(email: string) {\r\n    return await prisma.user.findUnique({\r\n        where: { email },\r\n        include: {\r\n            profile: true,\r\n            privacySettings: true,\r\n            accountSettings: true,\r\n        },\r\n    });\r\n}\r\n\r\nexport async function registerUser(displayName: string, email: string, pass: string) {\r\n    const existingUser = await getUserByEmail(email);\r\n    if (existingUser) {\r\n        return { success: false, message: 'User with this email already exists.' };\r\n    }\r\n    const hashedPassword = await bcrypt.hash(pass, 10);\r\n    const user = await prisma.user.create({\r\n        data: {\r\n            email,\r\n            password: hashedPassword,\r\n            profile: {\r\n                create: {\r\n                    displayName,\r\n                },\r\n            },\r\n            accountSettings: { create: {} },\r\n            privacySettings: { create: {} },\r\n        },\r\n        include: {\r\n            profile: true,\r\n            privacySettings: true,\r\n            accountSettings: true,\r\n        }\r\n    });\r\n    return { success: true, user };\r\n}\r\n\r\nexport async function createTenant(tenantDetails: Omit<Tenant, 'id' | 'slug' | 'permissions'>, ownerId: string): Promise<Tenant> {\r\n    const tenant = await prisma.tenant.create({\r\n        data: {\r\n            ...tenantDetails,\r\n            slug: tenantDetails.name.toLowerCase().replace(/ /g, '-'),\r\n            memberships: {\r\n                create: {\r\n                    userId: ownerId,\r\n                    roles: {\r\n                        create: {\r\n                            role: TenantRole.ADMIN,\r\n                        }\r\n                    },\r\n                    status: MembershipStatus.APPROVED,\r\n                }\r\n            },\r\n            settings: { \r\n                create: {\r\n                    isPublic: false,\r\n                    membershipApprovalMode: 'APPROVAL_REQUIRED',\r\n                    enableCalendar: true,\r\n                    enablePosts: true,\r\n                    enableSermons: true,\r\n                    enablePodcasts: true,\r\n                    enableBooks: true,\r\n                    enableDonations: true,\r\n                    enableVolunteering: true,\r\n                    enableSmallGroups: true,\r\n                    enableLiveStream: true,\r\n                    enablePrayerWall: true,\r\n                    enableResourceCenter: true,\r\n                    visitorVisibility: {},\r\n                    donationSettings: {},\r\n                    liveStreamSettings: {},\r\n                } \r\n            },\r\n            branding: { \r\n                create: {\r\n                    logoUrl: '',\r\n                    bannerImageUrl: '',\r\n                    primaryColor: '#000000',\r\n                    accentColor: '#FFFFFF',\r\n                    customLinks: [],\r\n                } \r\n            },\r\n        }\r\n    });\r\n    return tenant;\r\n}\r\n\r\nexport async function updateTenant(tenant: Partial<TenantWithDetails>): Promise<Tenant> {\r\n    const { id, settings, branding, ...data } = tenant;\r\n    \r\n    const updateData: any = { ...data };\r\n\r\n    if (settings) {\r\n        const { id: settingsId, tenantId: settingsTenantId, ...restOfSettings } = settings;\r\n        updateData.settings = {\r\n            update: {\r\n                ...restOfSettings,\r\n                visitorVisibility: restOfSettings.visitorVisibility || undefined,\r\n                donationSettings: restOfSettings.donationSettings || undefined,\r\n                liveStreamSettings: restOfSettings.liveStreamSettings || undefined,\r\n            }\r\n        };\r\n    }\r\n\r\n    if (branding) {\r\n        const { id: brandingId, tenantId: brandingTenantId, ...restOfBranding } = branding;\r\n        updateData.branding = {\r\n            update: {\r\n                ...restOfBranding,\r\n                customLinks: restOfBranding.customLinks || undefined,\r\n            }\r\n        };\r\n    }\r\n\r\n    return await prisma.tenant.update({\r\n        where: { id },\r\n        data: updateData,\r\n    });\r\n}\r\n\r\nexport async function requestToJoinTenant(userId: string, tenantId: string): Promise<UserTenantMembership> {\r\n    const existingMembership = await getMembershipForUserInTenant(userId, tenantId);\r\nif (existingMembership) {\r\n        return existingMembership;\r\n    }\r\n    return await prisma.userTenantMembership.create({\r\n        data: {\r\n            userId,\r\n            tenantId,\r\n            roles: {\r\n                create: {\r\n                    role: TenantRole.MEMBER,\r\n                }\r\n            },\r\n            status: MembershipStatus.PENDING,\r\n        }\r\n    });\r\n}\r\n\r\n// NOTE: These are not secure and are for demonstration only.\r\n// In a real app, you'd use secure tokens and a proper reset flow.\r\nexport async function requestPasswordReset(email: string): Promise<boolean> {\r\n    const user = await getUserByEmail(email);\r\n    if (!user) return false;\r\n    // In a real app, generate a token, save it, and email a link.\r\n    console.log(`Password reset requested for ${email}. In this demo, we'll just allow a direct reset.`);\r\n    return true;\r\n}\r\n\r\nexport async function resetPassword(email: string, newPass: string) {\r\n    const user = await getUserByEmail(email);\r\n    if (!user) return { success: false, message: \"User not found.\" };\r\n    const hashedPassword = await bcrypt.hash(newPass, 10);\r\n    await prisma.user.update({\r\n        where: { email },\r\n        data: { password: hashedPassword },\r\n    });\r\n    return { success: true };\r\n}\r\n\r\nexport async function logAuditEvent(event: Omit<AuditLog, 'id' | 'createdAt'>): Promise<AuditLog> {\r\n    return await prisma.auditLog.create({\r\n        data: {\r\n            ...event,\r\n            metadata: event.metadata || {},\r\n        },\r\n    });\r\n}\r\n\r\nexport async function getOrCreateDirectConversation(userId1: string, userId2: string): Promise<Conversation> {\r\n    const existing = await prisma.conversation.findFirst({\r\n        where: {\r\n            isDirectMessage: true,\r\n            participants: {\r\n                every: {\r\n                    userId: { in: [userId1, userId2] }\r\n                }\r\n            }\r\n        },\r\n        include: { participants: true }\r\n    });\r\n\r\n    if (existing) return existing;\r\n\r\n    return await prisma.conversation.create({\r\n        data: {\r\n            isDirectMessage: true,\r\n            participants: {\r\n                create: [\r\n                    { userId: userId1 },\r\n                    { userId: userId2 },\r\n                ]\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nexport async function getConversationsForUser(userId: string) {\r\n    return await prisma.conversation.findMany({\r\n        where: {\r\n            participants: {\r\n                some: {\r\n                    userId: userId\r\n                }\r\n            }\r\n        },\r\n        include: {\r\n            participants: {\r\n                include: {\r\n                    user: {\r\n                        include: {\r\n                            profile: true\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            messages: {\r\n                orderBy: {\r\n                    createdAt: 'desc'\r\n                },\r\n                take: 1,\r\n                include: {\r\n                    user: {\r\n                        include: {\r\n                            profile: true\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        orderBy: {\r\n            id: 'desc'\r\n        }\r\n    });\r\n}\r\n\r\nexport async function getMessagesForConversation(conversationId: string) {\r\n    return await prisma.chatMessage.findMany({\r\n        where: {\r\n            conversationId: conversationId\r\n        },\r\n        include: {\r\n            user: {\r\n                include: {\r\n                    profile: true\r\n                }\r\n            }\r\n        },\r\n        orderBy: {\r\n            createdAt: 'asc'\r\n        }\r\n    });\r\n}\r\n\r\nexport async function addMessage(conversationId: string, senderId: string, content: string) {\r\n    const message = await prisma.chatMessage.create({\r\n        data: {\r\n            conversationId,\r\n            userId: senderId,\r\n            text: content\r\n        },\r\n        include: {\r\n            user: {\r\n                include: {\r\n                    profile: true\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    return message;\r\n}\r\n\r\nexport async function deleteMessage(messageId: string) {\r\n    return await prisma.chatMessage.delete({\r\n        where: { id: messageId }\r\n    });\r\n}\r\n\r\nexport async function markConversationAsRead(conversationId: string, userId: string) {\r\n    // This would update read receipts via ConversationParticipant's lastReadMessageId\r\n    // For now, just return success\r\n    return { success: true };\r\n}\r\n\r\nexport async function getAllUsers() {\r\n    return await prisma.user.findMany({\r\n        include: {\r\n            profile: true\r\n        }\r\n    });\r\n}\r\n\r\nexport async function getAuditLogs() {\r\n    return await prisma.auditLog.findMany({\r\n        include: {\r\n            actorUser: {\r\n                include: {\r\n                    profile: true\r\n                }\r\n            },\r\n            effectiveUser: {\r\n                include: {\r\n                    profile: true\r\n                }\r\n            }\r\n        },\r\n        orderBy: {\r\n            createdAt: 'desc'\r\n        },\r\n        take: 100\r\n    });\r\n}\r\n\r\n// Get enriched memberships for a user (includes tenant details)\r\nexport async function getEnrichedMembershipsForUser(userId: string) {\r\n    const memberships = await prisma.userTenantMembership.findMany({\r\n        where: { userId },\r\n        include: {\r\n            tenant: {\r\n                include: {\r\n                    settings: true,\r\n                    branding: true,\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    return memberships.map(m => ({\r\n        membership: m,\r\n        tenant: m.tenant\r\n    }));\r\n}\r\n\r\n// Update membership profile (display name and title within a tenant)\r\nexport async function updateMembershipProfile(\r\n    userId: string, \r\n    membershipId: string, \r\n    data: { displayName?: string; displayTitle?: string }\r\n) {\r\n    return await prisma.userTenantMembership.update({\r\n        where: { id: membershipId, userId },\r\n        data: {\r\n            displayName: data.displayName,\r\n            displayTitle: data.displayTitle\r\n        }\r\n    });\r\n}\r\n\r\n// Update user notification preferences\r\nexport async function updateUserNotificationPreferences(\r\n    userId: string,\r\n    preferences: any\r\n) {\r\n    // Note: This assumes notification preferences are stored in a JSON field or separate table\r\n    // Adjust based on your actual schema\r\n    return await prisma.user.update({\r\n        where: { id: userId },\r\n        data: {\r\n            // If you have a notificationPreferences JSON field:\r\n            // notificationPreferences: preferences\r\n        }\r\n    });\r\n}\r\n\r\n// ===== MISSING FUNCTION STUBS =====\r\n// These functions are called by components but not yet fully implemented\r\n\r\nexport async function getMembersForTenant(tenantId: string) {\r\n    // TODO: Implement member fetching with enriched data\r\n    return [];\r\n}\r\n\r\nexport async function updateMembershipStatus(userId: string, tenantId: string, status: string) {\r\n    // TODO: Implement membership status update\r\n    return null;\r\n}\r\n\r\nexport async function updateMemberRolesAndTitle(userId: string, tenantId: string, roles: any[], title: string) {\r\n    // TODO: Implement member roles and title update\r\n    return null;\r\n}\r\n\r\nexport async function getSmallGroupsForTenant(tenantId: string) {\r\n    // TODO: Implement small groups fetching\r\n    return [];\r\n}\r\n\r\nexport async function createSmallGroup(tenantId: string, groupData: any) {\r\n    // TODO: Implement small group creation\r\n    return null;\r\n}\r\n\r\nexport async function getVolunteerNeedsForTenant(tenantId: string) {\r\n    // TODO: Implement volunteer needs fetching\r\n    return [];\r\n}\r\n\r\nexport async function addVolunteerNeed(tenantId: string, needData: any) {\r\n    // TODO: Implement volunteer need creation\r\n    return null;\r\n}\r\n\r\nexport async function getResourceItemsForTenant(tenantId: string) {\r\n    // TODO: Implement resource items fetching\r\n    return [];\r\n}\r\n\r\nexport async function addResourceItem(tenantId: string, itemData: any) {\r\n    // TODO: Implement resource item creation\r\n    return null;\r\n}\r\n\r\nexport async function deleteResourceItem(itemId: string) {\r\n    // TODO: Implement resource item deletion\r\n    return null;\r\n}\r\n\r\nexport async function getCommunityPostsForTenant(tenantId: string) {\r\n    // TODO: Implement community posts fetching\r\n    return [];\r\n}\r\n\r\nexport async function updateCommunityPostStatus(postId: string, status: string) {\r\n    // TODO: Implement community post status update\r\n    return null;\r\n}\r\n\r\nexport async function getContactSubmissionsForTenant(tenantId: string) {\r\n    // TODO: Implement contact submissions fetching\r\n    return [];\r\n}\r\n\r\nexport async function updateContactSubmissionStatus(submissionId: string, status: string) {\r\n    // TODO: Implement contact submission status update\r\n    return null;\r\n}\r\n\r\nexport async function respondToContactSubmission(submissionId: string, response: string) {\r\n    // TODO: Implement contact submission response\r\n    return null;\r\n}\r\n\r\nexport async function updateTenantPermissions(tenantId: string, permissions: any) {\r\n    // TODO: Implement tenant permissions update\r\n    return null;\r\n}\r\n\r\nexport async function addPost(tenantId: string, postData: any) {\r\n    // TODO: Implement post creation\r\n    return null;\r\n}\r\n\r\nexport async function addEvent(tenantId: string, eventData: any) {\r\n    // TODO: Implement event creation\r\n    return null;\r\n}\r\n\r\nexport async function getSermonsForTenant(tenantId: string) {\r\n    // TODO: Implement sermons fetching\r\n    return [];\r\n}\r\n\r\nexport async function getPodcastsForTenant(tenantId: string) {\r\n    // TODO: Implement podcasts fetching\r\n    return [];\r\n}\r\n\r\nexport async function getBooksForTenant(tenantId: string) {\r\n    // TODO: Implement books fetching\r\n    return [];\r\n}\r\n\r\nexport async function getDonationsForTenant(tenantId: string) {\r\n    // TODO: Implement donations fetching\r\n    return [];\r\n}\r\n\r\nexport async function addDonationRecord(tenantId: string, donationData: any) {\r\n    // TODO: Implement donation record creation\r\n    return null;\r\n}\r\n\r\nexport async function addContactSubmission(tenantId: string, submissionData: any) {\r\n    // TODO: Implement contact submission creation\r\n    return null;\r\n}\r\n\r\nexport async function addCommunityPost(tenantId: string, postData: any) {\r\n    // TODO: Implement community post creation\r\n    return null;\r\n}\r\n\r\nexport async function joinSmallGroup(groupId: string, userId: string) {\r\n    // TODO: Implement small group join\r\n    return null;\r\n}\r\n\r\nexport async function leaveSmallGroup(groupId: string, userId: string) {\r\n    // TODO: Implement small group leave\r\n    return null;\r\n}\r\n\r\nexport async function signUpForNeed(needId: string, userId: string) {\r\n    // TODO: Implement volunteer need sign up\r\n    return null;\r\n}\r\n\r\nexport async function cancelSignUp(needId: string, userId: string) {\r\n    // TODO: Implement volunteer need cancellation\r\n    return null;\r\n}\r\n\r\nexport async function createConversation(conversationData: any) {\r\n    // TODO: Implement conversation creation\r\n    return null;\r\n}\r\n\r\nexport async function adminUpdateUserProfile(userId: string, profileData: any) {\r\n    // TODO: Implement admin user profile update\r\n    return null;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 793, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/lib/permissions.ts"],"sourcesContent":["import { TenantRole, User, Tenant, ChatMessage, Conversation, UserTenantMembership } from '@prisma/client';\r\nimport { prisma } from './db';\r\n\r\n// Define RolePermissions based on your application's logic, as it's not in Prisma schema\r\nexport interface RolePermissions {\r\n  canCreatePosts: boolean;\r\n  canCreateEvents: boolean;\r\n  canCreateSermons: boolean;\r\n  canCreatePodcasts: boolean;\r\n  canCreateBooks: boolean;\r\n  canCreateGroupChats: boolean;\r\n  canInviteMembers: boolean;\r\n  canApproveMembership: boolean;\r\n  canBanMembers: boolean;\r\n  canModeratePosts: boolean;\r\n  canModerateChats: boolean;\r\n  canPostInAnnouncementChannels?: boolean;\r\n  canManagePrayerWall: boolean;\r\n  canUploadResources: boolean;\r\n  canManageResources: boolean;\r\n  canManageContactSubmissions: boolean;\r\n}\r\n\r\n// This can be a simple enum if you don't need the string values\r\nexport enum TenantRoleType {\r\n    MEMBER = 'MEMBER',\r\n    STAFF = 'STAFF',\r\n    MODERATOR = 'MODERATOR',\r\n}\r\n\r\nasync function getMembershipForUserInTenant(userId: string, tenantId: string): Promise<(UserTenantMembership & { roles: { role: TenantRole }[] }) | null> {\r\n    return prisma.userTenantMembership.findUnique({\r\n        where: {\r\n            userId_tenantId: {\r\n                userId,\r\n                tenantId,\r\n            },\r\n        },\r\n        include: {\r\n            roles: {\r\n                select: {\r\n                    role: true\r\n                }\r\n            },\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\n/**\r\n * Maps a specific TenantRole to a more general TenantRoleType for permission lookups.\r\n */\r\nfunction getRoleType(role: TenantRole): TenantRoleType | 'ADMIN' {\r\n    switch (role) {\r\n        case TenantRole.ADMIN:\r\n            return 'ADMIN';\r\n        case TenantRole.STAFF:\r\n        case TenantRole.CLERGY:\r\n            return TenantRoleType.STAFF;\r\n        case TenantRole.MODERATOR:\r\n            return TenantRoleType.MODERATOR;\r\n        case TenantRole.MEMBER:\r\n            return TenantRoleType.MEMBER;\r\n        default:\r\n            return TenantRoleType.MEMBER;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Checks if a user has a specific permission within a tenant.\r\n * This is the centralized source of truth for all permission checks.\r\n *\r\n * @param user The user to check.\r\n * @param tenant The tenant context for the permission.\r\n * @param permission The permission to check for (e.g., 'canCreatePosts').\r\n * @returns {boolean} True if the user has the permission, false otherwise.\r\n */\r\nexport async function can(user: User, tenant: Tenant, permission: keyof RolePermissions): Promise<boolean> {\r\n  // Super Admins can do anything.\r\n  if (user.isSuperAdmin) {\r\n    return true;\r\n  }\r\n\r\n  // Find the user's membership for this specific tenant.\r\n  const membership = await getMembershipForUserInTenant(user.id, tenant.id);\r\n\r\n  // If the user is not a member or not approved, they have no permissions.\r\n  if (!membership || membership.status !== 'APPROVED') {\r\n    return false;\r\n  }\r\n  \r\n  // Check if any of the user's roles grant the required permission.\r\n  for (const roleInfo of membership.roles) {\r\n    const roleType = getRoleType(roleInfo.role);\r\n    const permissions = tenant.permissions as any;\r\n\r\n    // If permissions is null or undefined, no permissions are granted\r\n    if (!permissions) {\r\n      continue;\r\n    }\r\n\r\n    if (roleType === 'ADMIN') {\r\n        // Admins have all permissions defined under the ADMIN key.\r\n        if (permissions.ADMIN && permissions.ADMIN[permission]) {\r\n            return true;\r\n        }\r\n    } else {\r\n        // For other roles, check against their TenantRoleType.\r\n        const rolePerms = permissions[roleType];\r\n        if (rolePerms && rolePerms[permission]) {\r\n            return true; // Permission granted by at least one role.\r\n        }\r\n    }\r\n  }\r\n\r\n  return false; // No role granted the permission.\r\n}\r\n\r\n/**\r\n * Checks if a user has a specific role within a tenant.\r\n *\r\n * @param user The user to check.\r\n * @param tenantId The ID of the tenant context for the role.\r\n * @param role The role to check for.\r\n * @returns {boolean} True if the user has the role, false otherwise.\r\n */\r\nexport async function hasRole(userId: string, tenantId: string, requiredRoles: TenantRole[]): Promise<boolean> {\r\n  const membership = await getMembershipForUserInTenant(userId, tenantId);\r\n\r\n  if (!membership || membership.status !== 'APPROVED') {\r\n    return false;\r\n  }\r\n\r\n  return membership.roles.some(roleInfo => requiredRoles.includes(roleInfo.role));\r\n}\r\n\r\n/**\r\n * Checks if a user can view a certain type of content (e.g., posts, events).\r\n * It checks tenant settings for public visibility and feature enablement.\r\n *\r\n * @param userId The ID of the user attempting to view. Can be null for anonymous users.\r\n * @param tenantId The ID of the tenant where the content resides.\r\n * @param contentType The key for the content type in tenant settings (e.g., 'posts', 'calendar').\r\n * @returns {Promise<boolean>} True if the user can view the content.\r\n */\r\nexport async function canUserViewContent(userId: string | null, tenantId: string, contentType: 'posts' | 'calendar' | 'sermons' | 'podcasts' | 'books' | 'prayerWall'): Promise<boolean> {\r\n    try {\r\n        const tenant = await prisma.tenant.findUnique({\r\n            where: { id: tenantId },\r\n            include: { settings: true }\r\n        });\r\n\r\n        if (!tenant || !tenant.settings) {\r\n            return false;\r\n        }\r\n\r\n        const settings = tenant.settings as any;\r\n\r\n        // Check if the entire feature is disabled\r\n        const featureFlag = `enable${contentType.charAt(0).toUpperCase() + contentType.slice(1)}`;\r\n        if (!settings[featureFlag]) {\r\n            return false;\r\n        }\r\n\r\n        const membership = userId ? await getMembershipForUserInTenant(userId, tenantId) : null;\r\n\r\n        // If user is not a member, check public visibility settings\r\n        if (!membership || membership.status !== 'APPROVED') {\r\n            // Check if visitorVisibility exists and has the content type property\r\n            if (!settings.visitorVisibility || typeof settings.visitorVisibility !== 'object') {\r\n                return false;\r\n            }\r\n            const result = settings.visitorVisibility[contentType] === true;\r\n            return result;\r\n        }\r\n\r\n        // If they are an approved member, they can view it as long as the feature is enabled.\r\n        return true;\r\n    } catch (error) {\r\n        console.error('[canUserViewContent] Error:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Checks if a user has permission to create a post in a tenant.\r\n *\r\n * @param userId The ID of the user.\r\n * @param tenantId The ID of the tenant.\r\n * @param isAnnouncement Whether the post is an announcement.\r\n * @returns {Promise<boolean>} True if the user can create the post.\r\n */\r\nexport async function canUserPost(userId: string, tenantId: string, isAnnouncement: boolean): Promise<boolean> {\r\n    const user = await prisma.user.findUnique({ where: { id: userId } });\r\n    const tenant = await prisma.tenant.findUnique({ where: { id: tenantId } });\r\n\r\n    if (!user || !tenant) return false;\r\n\r\n    if (isAnnouncement) {\r\n        return can(user, tenant, 'canPostInAnnouncementChannels');\r\n    }\r\n    return can(user, tenant, 'canCreatePosts');\r\n}\r\n\r\n\r\n/**\r\n * Checks if a user can delete a specific message.\r\n */\r\nexport async function canDeleteMessage(\r\n  user: User,\r\n  message: ChatMessage,\r\n  conversation: Conversation,\r\n  tenant: Tenant\r\n): Promise<boolean> {\r\n  if (user.isSuperAdmin) {\r\n    return true;\r\n  }\r\n  // User can delete their own message\r\n  if (message.userId === user.id) {\r\n    return true;\r\n  }\r\n  // Check for moderation permissions\r\n  if (!conversation.isDirectMessage) { // isGroupChat\r\n    if (await can(user, tenant, 'canModerateChats')) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 965, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/ui/Button.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n  variant?: 'primary' | 'secondary' | 'danger';\r\n  size?: 'sm' | 'md';\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Button: React.FC<ButtonProps> = ({ children, variant = 'primary', size = 'md', className, ...props }) => {\r\n  const baseClasses = \"rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\";\r\n\r\n  const variantClasses = {\r\n    primary: 'bg-amber-600 text-white hover:bg-amber-700 focus:ring-amber-500',\r\n    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400',\r\n    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',\r\n  };\r\n  \r\n  const sizeClasses = {\r\n      md: \"px-4 py-2 text-sm\",\r\n      sm: \"px-3 py-1.5 text-xs\",\r\n  }\r\n\r\n  return (\r\n    <button className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${className}`} {...props}>\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default Button;\r\n"],"names":[],"mappings":";;;;;;AAQA,MAAM,SAAgC,CAAC,EAAE,QAAQ,EAAE,UAAU,SAAS,EAAE,OAAO,IAAI,EAAE,SAAS,EAAE,GAAG,OAAO;IACxG,MAAM,cAAc;IAEpB,MAAM,iBAAiB;QACrB,SAAS;QACT,WAAW;QACX,QAAQ;IACV;IAEA,MAAM,cAAc;QAChB,IAAI;QACJ,IAAI;IACR;IAEA,qBACE,8OAAC;QAAO,WAAW,GAAG,YAAY,CAAC,EAAE,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,WAAW;QAAG,GAAG,KAAK;kBACxG;;;;;;AAGP;uCAEe"}},
    {"offset": {"line": 997, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/ui/Modal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect } from 'react';\r\n\r\ninterface ModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  title: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Modal: React.FC<ModalProps> = ({ isOpen, onClose, title, children }) => {\r\n  useEffect(() => {\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('keydown', handleEscape);\r\n    return () => {\r\n      document.removeEventListener('keydown', handleEscape);\r\n    };\r\n  }, [onClose]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-start overflow-y-auto p-4 sm:p-10\"\r\n      aria-labelledby=\"modal-title\"\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        className=\"bg-white rounded-lg shadow-xl max-w-lg w-full overflow-hidden\"\r\n        onClick={(e) => e.stopPropagation()} // Prevent clicks inside the modal from closing it\r\n      >\r\n        <div className=\"flex justify-between items-center p-4 border-b border-gray-200\">\r\n          <h2 id=\"modal-title\" className=\"text-lg font-semibold text-gray-900\">\r\n            {title}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600\"\r\n            aria-label=\"Close modal\"\r\n          >\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div className=\"p-6\">\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Modal;"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAWA,MAAM,QAA8B,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE;IACvE,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe,CAAC;YACpB,IAAI,MAAM,GAAG,KAAK,UAAU;gBAC1B;YACF;QACF;QACA,SAAS,gBAAgB,CAAC,WAAW;QACrC,OAAO;YACL,SAAS,mBAAmB,CAAC,WAAW;QAC1C;IACF,GAAG;QAAC;KAAQ;IAEZ,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QACC,WAAU;QACV,mBAAgB;QAChB,MAAK;QACL,cAAW;QACX,SAAS;kBAET,cAAA,8OAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAEjC,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,IAAG;4BAAc,WAAU;sCAC5B;;;;;;sCAEH,8OAAC;4BACC,SAAS;4BACT,WAAU;4BACV,cAAW;sCAEX,cAAA,8OAAC;gCAAI,OAAM;gCAA6B,WAAU;gCAAU,MAAK;gCAAO,SAAQ;gCAAY,QAAO;0CACjG,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;8BAI3E,8OAAC;oBAAI,WAAU;8BACZ;;;;;;;;;;;;;;;;;AAKX;uCAEe"}},
    {"offset": {"line": 1104, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/types.ts"],"sourcesContent":["// --- ENUMS ---\r\n\r\nexport enum TenantRole {\r\n  MEMBER = 'MEMBER',\r\n  STAFF = 'STAFF',\r\n  CLERGY = 'CLERGY',\r\n  MODERATOR = 'MODERATOR',\r\n  ADMIN = 'ADMIN',\r\n}\r\n\r\n// Role types for permission mapping\r\nexport enum TenantRoleType {\r\n  MEMBER = 'MEMBER',\r\n  STAFF = 'STAFF',\r\n  MODERATOR = 'MODERATOR',\r\n}\r\n\r\nexport enum MembershipStatus {\r\n  REQUESTED = 'REQUESTED',\r\n  APPROVED = 'APPROVED',\r\n  REJECTED = 'REJECTED',\r\n  BANNED = 'BANNED',\r\n}\r\n\r\nexport enum MembershipApprovalMode {\r\n  OPEN = 'OPEN',\r\n  APPROVAL_REQUIRED = 'APPROVAL_REQUIRED',\r\n}\r\n\r\nexport enum VolunteerStatus {\r\n  CONFIRMED = 'CONFIRMED',\r\n  CANCELED = 'CANCELED',\r\n}\r\n\r\nexport enum SmallGroupRole {\r\n  LEADER = 'LEADER',\r\n  MEMBER = 'MEMBER',\r\n}\r\n\r\nexport enum CommunityPostType {\r\n    PRAYER_REQUEST = 'PRAYER_REQUEST',\r\n    TANGIBLE_NEED = 'TANGIBLE_NEED',\r\n}\r\n\r\nexport enum CommunityPostStatus {\r\n    PENDING_APPROVAL = 'PENDING_APPROVAL',\r\n    PUBLISHED = 'PUBLISHED',\r\n    FULFILLED = 'FULFILLED',\r\n}\r\n\r\nexport enum ResourceVisibility {\r\n    PUBLIC = 'PUBLIC',\r\n    MEMBERS_ONLY = 'MEMBERS_ONLY',\r\n}\r\n\r\nexport enum FileType {\r\n    PDF = 'PDF',\r\n    DOCX = 'DOCX',\r\n    MP3 = 'MP3',\r\n    JPG = 'JPG',\r\n    PNG = 'PNG',\r\n    OTHER = 'OTHER',\r\n}\r\n\r\nexport enum ContactSubmissionStatus {\r\n    UNREAD = 'UNREAD',\r\n    READ = 'READ',\r\n    ARCHIVED = 'ARCHIVED',\r\n}\r\n\r\n\r\n// --- USER-RELATED MODELS ---\r\nexport interface NotificationPreferences {\r\n  email: {\r\n    newAnnouncement: boolean;\r\n    newEvent: boolean;\r\n    directMessage: boolean;\r\n    groupChatMessage: boolean;\r\n    membershipUpdate: boolean;\r\n  };\r\n}\r\n\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  password?: string; // NOTE: For mock login simulation.\r\n  isSuperAdmin: boolean;\r\n  profile: UserProfile;\r\n  privacySettings: UserPrivacySettings;\r\n  accountSettings: AccountSettings;\r\n  notificationPreferences: NotificationPreferences;\r\n}\r\n\r\nexport interface UserProfile {\r\n  displayName: string;\r\n  avatarUrl?: string;\r\n  bio?: string;\r\n  locationCity?: string;\r\n  locationCountry?: string;\r\n  languages?: string[];\r\n}\r\n\r\nexport interface UserPrivacySettings {\r\n  showAffiliations: boolean;\r\n}\r\n\r\nexport interface AccountSettings {\r\n  timezonePreference?: string;\r\n  dateFormat?: string;\r\n  timeFormat?: string;\r\n  languagePreference?: string;\r\n}\r\n\r\n\r\n// --- TENANT-RELATED MODELS ---\r\n\r\nexport interface Tenant {\r\n  id: string;\r\n  name: string;\r\n  slug: string;\r\n  creed: string;\r\n  address: {\r\n    street: string;\r\n    city: string;\r\n    state: string;\r\n    country: string;\r\n    postalCode: string;\r\n  };\r\n  contactEmail?: string;\r\n  phoneNumber?: string;\r\n  description: string;\r\n  settings: TenantSettings;\r\n  branding: TenantBranding;\r\n  permissions: TenantFeaturePermissions;\r\n}\r\n\r\nexport interface TenantBranding {\r\n  logoUrl: string;\r\n  bannerImageUrl: string;\r\n  primaryColor: string;\r\n  accentColor: string;\r\n  customLinks: Array<{ label: string; url: string }>;\r\n}\r\n\r\nexport interface LiveStreamSettings {\r\n  provider: 'YOUTUBE' | 'FACEBOOK' | 'VIMEO' | 'OTHER';\r\n  embedUrl: string;\r\n  isLive: boolean; // Manual toggle by admin\r\n}\r\n\r\nexport interface TenantSettings {\r\n  isPublic: boolean;\r\n  membershipApprovalMode: MembershipApprovalMode;\r\n  // Features\r\n  enableCalendar: boolean;\r\n  enablePosts: boolean;\r\n  enableSermons: boolean;\r\n  enablePodcasts: boolean;\r\n  enableBooks: boolean;\r\n  enableMemberDirectory: boolean;\r\n  enableGroupChat: boolean;\r\n  enableComments: boolean;\r\n  enableReactions: boolean;\r\n  enableDonations: boolean;\r\n  enableVolunteering: boolean;\r\n  enableSmallGroups: boolean;\r\n  enableLiveStream: boolean;\r\n  enablePrayerWall: boolean;\r\n  enableResourceCenter: boolean;\r\n  donationSettings: DonationSettings;\r\n  liveStreamSettings: LiveStreamSettings;\r\n  // Visibility (simplified for mock)\r\n  visitorVisibility: {\r\n    calendar: boolean;\r\n    posts: boolean;\r\n    sermons: boolean;\r\n    podcasts: boolean;\r\n    books: boolean;\r\n    prayerWall: boolean;\r\n  };\r\n}\r\n\r\n\r\nexport interface RolePermissions {\r\n  canCreatePosts: boolean;\r\n  canCreateEvents: boolean;\r\n  canCreateSermons: boolean;\r\n  canCreatePodcasts: boolean;\r\n  canCreateBooks: boolean;\r\n  canCreateGroupChats: boolean;\r\n  canInviteMembers: boolean;\r\n  canApproveMembership: boolean;\r\n  canBanMembers: boolean;\r\n  canModeratePosts: boolean;\r\n  canModerateChats: boolean;\r\n  canPostInAnnouncementChannels?: boolean;\r\n  canManagePrayerWall: boolean;\r\n  canUploadResources: boolean;\r\n  canManageResources: boolean;\r\n  canManageContactSubmissions: boolean;\r\n}\r\n\r\n// Sticking with a map for easier frontend access\r\nexport type TenantFeaturePermissions = {\r\n  [key in TenantRoleType]?: RolePermissions;\r\n} & { ADMIN: RolePermissions };\r\n\r\n\r\nexport interface UserTenantMembership {\r\n  id: string;\r\n  userId: string;\r\n  tenantId: string;\r\n  status: MembershipStatus;\r\n  roles: UserTenantRole[];\r\n  displayName?: string; // Tenant-specific display name override\r\n}\r\n\r\nexport interface UserTenantRole {\r\n    id: string;\r\n    role: TenantRole;\r\n    displayTitle?: string;\r\n    isPrimary: boolean;\r\n}\r\n\r\n// Enriched type for displaying members in the UI\r\nexport interface EnrichedMember extends User {\r\n  membership: UserTenantMembership;\r\n}\r\n\r\n\r\n// --- CONTENT & MESSAGING (Largely Unchanged) ---\r\n\r\nexport interface Post {\r\n  id: string;\r\n  tenantId: string;\r\n  authorUserId: string;\r\n  type: 'BLOG' | 'ANNOUNCEMENT' | 'BOOK';\r\n  title: string;\r\n  body: string;\r\n  isPublished: boolean;\r\n  publishedAt: Date;\r\n}\r\nexport interface PostInput {\r\n  title: string;\r\n  body: string;\r\n  type: 'BLOG' | 'ANNOUNCEMENT' | 'BOOK';\r\n  isPublished: boolean;\r\n}\r\nexport interface PostWithAuthor extends Post {\r\n    authorDisplayName: string;\r\n    authorAvatarUrl?: string;\r\n}\r\n\r\nexport interface Event {\r\n  id:string;\r\n  tenantId: string;\r\n  createdByUserId: string;\r\n  title: string;\r\n  description: string;\r\n  startDateTime: Date;\r\n  endDateTime: Date;\r\n  locationText: string;\r\n  isOnline: boolean;\r\n  onlineUrl?: string;\r\n}\r\nexport interface EventWithCreator extends Event {\r\n    creatorDisplayName: string;\r\n    creatorAvatarUrl?: string;\r\n}\r\n\r\nexport interface MediaItem {\r\n  id: string;\r\n  tenantId: string;\r\n  authorUserId: string;\r\n  type: 'SERMON_VIDEO' | 'PODCAST_AUDIO';\r\n  title: string;\r\n  description: string;\r\n  embedUrl: string;\r\n  publishedAt: Date;\r\n}\r\nexport interface EnrichedMediaItem extends MediaItem {\r\n    authorDisplayName: string;\r\n    authorAvatarUrl?: string;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  conversationId: string;\r\n  userId: string;\r\n  text: string;\r\n  createdAt: Date;\r\n  isDeleted?: boolean;\r\n}\r\n\r\nexport interface EnrichedChatMessage extends ChatMessage {\r\n  userDisplayName: string;\r\n  userAvatarUrl?: string;\r\n}\r\n\r\nexport interface Conversation {\r\n  id: string;\r\n  isDirect: boolean;\r\n  tenantId: string | null;\r\n  isPrivateGroup: boolean;\r\n  name?: string; // For group channels\r\n  description?: string; // Description for channels\r\n  createdByUserId: string;\r\n  isDefaultChannel: boolean;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface ConversationParticipant {\r\n  id: string;\r\n  conversationId: string;\r\n  userId: string;\r\n  lastReadMessageId?: string | null;\r\n}\r\n\r\nexport interface EnrichedConversation extends Conversation {\r\n    participants: User[];\r\n    unreadCount: number;\r\n    lastMessage?: EnrichedChatMessage;\r\n    displayName: string;\r\n}\r\n\r\n\r\n// --- ADMIN & AUDIT TYPES ---\r\n\r\nexport enum ActionType {\r\n  IMPERSONATE_START = 'IMPERSONATE_START',\r\n  IMPERSONATE_END = 'IMPERSONATE_END',\r\n  CREATE_POST = 'CREATE_POST',\r\n  DELETE_POST = 'DELETE_POST',\r\n  BAN_USER = 'BAN_USER',\r\n  UNBAN_USER = 'UNBAN_USER',\r\n  DELETE_MESSAGE = 'DELETE_MESSAGE',\r\n  USER_JOINED_TENANT = 'USER_JOINED_TENANT',\r\n  MEMBERSHIP_STATUS_UPDATED = 'MEMBERSHIP_STATUS_UPDATED',\r\n  MEMBER_ROLES_UPDATED = 'MEMBER_ROLES_UPDATED',\r\n  MEMBERSHIP_PROFILE_UPDATED = 'MEMBERSHIP_PROFILE_UPDATED',\r\n  USER_REGISTERED = 'USER_REGISTERED',\r\n  USER_PROFILE_UPDATED = 'USER_PROFILE_UPDATED',\r\n  ADMIN_UPDATED_USER_PROFILE = 'ADMIN_UPDATED_USER_PROFILE',\r\n  TENANT_PERMISSIONS_UPDATED = 'TENANT_PERMISSIONS_UPDATED',\r\n}\r\n\r\nexport interface AuditLog {\r\n  id: string;\r\n  actorUserId: string;\r\n  effectiveUserId?: string;\r\n  actionType: ActionType;\r\n  entityType?: string;\r\n  entityId?: string;\r\n  metadata?: Record<string, any>;\r\n  createdAt: Date;\r\n}\r\n\r\n// --- NOTIFICATION MODELS ---\r\nexport type NotificationType =\r\n  | 'NEW_DIRECT_MESSAGE'\r\n  | 'NEW_ANNOUNCEMENT'\r\n  | 'MEMBERSHIP_APPROVED'\r\n  | 'NEW_CONTACT_SUBMISSION';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  userId: string; // The recipient\r\n  actorUserId?: string; // The user who caused the notification\r\n  type: NotificationType;\r\n  message: string;\r\n  link?: string; // e.g., messages, tenant/tenant-1\r\n  isRead: boolean;\r\n  createdAt: Date;\r\n}\r\n\r\n// --- DONATION MODELS ---\r\nexport interface DonationSettings {\r\n  mode: 'EXTERNAL' | 'INTEGRATED';\r\n  externalUrl?: string;\r\n  integratedProvider?: 'STRIPE' | 'PAYPAL';\r\n  currency: string;\r\n  suggestedAmounts: number[];\r\n  allowCustomAmounts: boolean;\r\n  leaderboardEnabled: boolean;\r\n  leaderboardVisibility: 'PUBLIC' | 'MEMBERS_ONLY';\r\n  leaderboardTimeframe: 'ALL_TIME' | 'YEARLY' | 'MONTHLY';\r\n}\r\n\r\nexport interface DonationRecord {\r\n  id: string;\r\n  tenantId: string;\r\n  userId: string | null; // null for anonymous from public page\r\n  displayName: string; // denormalized for anonymous/guest donations\r\n  amount: number;\r\n  currency: string;\r\n  donatedAt: Date;\r\n  isAnonymousOnLeaderboard: boolean;\r\n  message?: string;\r\n}\r\n\r\nexport interface EnrichedDonationRecord extends DonationRecord {\r\n    userAvatarUrl?: string;\r\n}\r\n\r\n// --- VOLUNTEER MODELS ---\r\nexport interface VolunteerNeed {\r\n  id: string;\r\n  tenantId: string;\r\n  eventId?: string; // Optional link to an Event\r\n  title: string;\r\n  description: string;\r\n  date: Date;\r\n  slotsNeeded: number;\r\n}\r\n\r\nexport interface VolunteerSignup {\r\n  id: string;\r\n  needId: string;\r\n  userId: string;\r\n  signedUpAt: Date;\r\n  status: VolunteerStatus;\r\n}\r\n\r\n// Enriched types for UI\r\nexport interface EnrichedSignup {\r\n  signup: VolunteerSignup;\r\n  user: User;\r\n}\r\n\r\nexport interface EnrichedVolunteerNeed extends VolunteerNeed {\r\n  signups: EnrichedSignup[];\r\n}\r\n\r\n// --- SMALL GROUP MODELS ---\r\nexport interface SmallGroup {\r\n  id: string;\r\n  tenantId: string;\r\n  name: string;\r\n  description: string;\r\n  leaderUserId: string;\r\n  meetingSchedule: string; // e.g., \"Tuesdays at 7 PM\"\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface SmallGroupMembership {\r\n  id: string;\r\n  groupId: string;\r\n  userId: string;\r\n  role: SmallGroupRole;\r\n  joinedAt: Date;\r\n}\r\n\r\n// Enriched types for UI\r\nexport interface EnrichedGroupMember {\r\n    membership: SmallGroupMembership;\r\n    user: User;\r\n}\r\n\r\nexport interface EnrichedSmallGroup extends SmallGroup {\r\n    leader: User;\r\n    members: EnrichedGroupMember[];\r\n}\r\n\r\n// --- COMMUNITY BOARD / PRAYER WALL MODELS ---\r\nexport interface CommunityPost {\r\n    id: string;\r\n    tenantId: string;\r\n    authorUserId: string | null; // Null for anonymous\r\n    type: CommunityPostType;\r\n    body: string;\r\n    isAnonymous: boolean;\r\n    status: CommunityPostStatus;\r\n    createdAt: Date;\r\n}\r\n\r\nexport interface EnrichedCommunityPost extends CommunityPost {\r\n    authorDisplayName: string;\r\n    authorAvatarUrl?: string;\r\n}\r\n\r\n// --- RESOURCE CENTER MODELS ---\r\nexport interface ResourceItem {\r\n    id: string;\r\n    tenantId: string;\r\n    uploaderUserId: string;\r\n    title: string;\r\n    description: string;\r\n    fileUrl: string; // For mock, this is just a string. In real app, it would be a URL to a file.\r\n    fileType: FileType;\r\n    visibility: ResourceVisibility;\r\n    createdAt: Date;\r\n}\r\n\r\nexport interface EnrichedResourceItem extends ResourceItem {\r\n    uploaderDisplayName: string;\r\n    uploaderAvatarUrl?: string;\r\n}\r\n\r\n// --- CONTACT & SUBMISSIONS ---\r\nexport interface ContactSubmission {\r\n    id: string;\r\n    tenantId: string;\r\n    name: string;\r\n    email: string;\r\n    message: string;\r\n    status: ContactSubmissionStatus;\r\n    createdAt: Date;\r\n}"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;AAET,IAAA,AAAK,oCAAA;;;;;;WAAA;;AASL,IAAA,AAAK,wCAAA;;;;WAAA;;AAML,IAAA,AAAK,0CAAA;;;;;WAAA;;AAOL,IAAA,AAAK,gDAAA;;;WAAA;;AAKL,IAAA,AAAK,yCAAA;;;WAAA;;AAKL,IAAA,AAAK,wCAAA;;;WAAA;;AAKL,IAAA,AAAK,2CAAA;;;WAAA;;AAKL,IAAA,AAAK,6CAAA;;;;WAAA;;AAML,IAAA,AAAK,4CAAA;;;WAAA;;AAKL,IAAA,AAAK,kCAAA;;;;;;;WAAA;;AASL,IAAA,AAAK,iDAAA;;;;WAAA;;AAyQL,IAAA,AAAK,oCAAA;;;;;;;;;;;;;;;;WAAA"}},
    {"offset": {"line": 1220, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/ui/Input.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\r\n  label: string;\r\n  containerClassName?: string;\r\n}\r\n\r\nconst Input: React.FC<InputProps> = ({ label, id, containerClassName, ...props }) => {\r\n  return (\r\n    <div className={containerClassName}>\r\n      <label htmlFor={id} className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n        {label}\r\n      </label>\r\n      <input\r\n        id={id}\r\n        className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400\"\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Input;"],"names":[],"mappings":";;;;;;AAOA,MAAM,QAA8B,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,kBAAkB,EAAE,GAAG,OAAO;IAC9E,qBACE,8OAAC;QAAI,WAAW;;0BACd,8OAAC;gBAAM,SAAS;gBAAI,WAAU;0BAC3B;;;;;;0BAEH,8OAAC;gBACC,IAAI;gBACJ,WAAU;gBACT,GAAG,KAAK;;;;;;;;;;;;AAIjB;uCAEe"}},
    {"offset": {"line": 1260, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/tenant/forms/ResourceForm.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport type { ResourceItem } from '@/types';\r\nimport { FileType, ResourceVisibility } from '@/types';\r\nimport Input from '../../ui/Input';\r\nimport Button from '../../ui/Button';\r\n\r\ninterface ResourceFormProps {\r\n  onSubmit: (data: Omit<ResourceItem, 'id' | 'createdAt' | 'tenantId' | 'uploaderUserId'>) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst ResourceForm: React.FC<ResourceFormProps> = ({ onSubmit, onCancel }) => {\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [fileUrl, setFileUrl] = useState('');\r\n  const [fileType, setFileType] = useState<FileType>(FileType.PDF);\r\n  const [visibility, setVisibility] = useState<ResourceVisibility>(ResourceVisibility.MEMBERS_ONLY);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!title || !fileUrl) {\r\n      alert('Please fill out the Title and File URL fields.');\r\n      return;\r\n    }\r\n    onSubmit({ title, description, fileUrl, fileType, visibility });\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <Input\r\n        label=\"Title\"\r\n        id=\"title\"\r\n        name=\"title\"\r\n        value={title}\r\n        onChange={(e) => setTitle(e.target.value)}\r\n        required\r\n      />\r\n      <div>\r\n        <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n          Description\r\n        </label>\r\n        <textarea\r\n          id=\"description\"\r\n          name=\"description\"\r\n          rows={3}\r\n          className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900\"\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n        />\r\n      </div>\r\n       <Input\r\n        label=\"File URL (mock)\"\r\n        id=\"fileUrl\"\r\n        name=\"fileUrl\"\r\n        type=\"url\"\r\n        value={fileUrl}\r\n        onChange={(e) => setFileUrl(e.target.value)}\r\n        required\r\n        placeholder=\"https://example.com/file.pdf\"\r\n      />\r\n       <div>\r\n        <label htmlFor=\"fileType\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n          File Type\r\n        </label>\r\n        <select\r\n          id=\"fileType\"\r\n          name=\"fileType\"\r\n          className=\"w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900\"\r\n          value={fileType}\r\n          onChange={(e) => setFileType(e.target.value as FileType)}\r\n        >\r\n          {Object.values(FileType).map(type => (\r\n            <option key={type} value={type}>{type}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Visibility</label>\r\n        <div className=\"flex space-x-4\">\r\n            <label className=\"flex items-center space-x-2\">\r\n                <input type=\"radio\" name=\"visibility\" value={ResourceVisibility.MEMBERS_ONLY} checked={visibility === ResourceVisibility.MEMBERS_ONLY} onChange={() => setVisibility(ResourceVisibility.MEMBERS_ONLY)} className=\"h-4 w-4 text-amber-600 border-gray-300 focus:ring-amber-500\" />\r\n                <span>Members Only</span>\r\n            </label>\r\n             <label className=\"flex items-center space-x-2\">\r\n                <input type=\"radio\" name=\"visibility\" value={ResourceVisibility.PUBLIC} checked={visibility === ResourceVisibility.PUBLIC} onChange={() => setVisibility(ResourceVisibility.PUBLIC)} className=\"h-4 w-4 text-amber-600 border-gray-300 focus:ring-amber-500\" />\r\n                <span>Public</span>\r\n            </label>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex justify-end items-center space-x-4 pt-4 border-t border-gray-200\">\r\n        <Button type=\"button\" variant=\"secondary\" onClick={onCancel}>\r\n          Cancel\r\n        </Button>\r\n        <Button type=\"submit\">\r\n          Save Resource\r\n        </Button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default ResourceForm;"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AACA;;;;;;AAOA,MAAM,eAA4C,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE;IACvE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAW,iHAAQ,CAAC,GAAG;IAC/D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAqB,2HAAkB,CAAC,YAAY;IAEhG,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,CAAC,SAAS,CAAC,SAAS;YACtB,MAAM;YACN;QACF;QACA,SAAS;YAAE;YAAO;YAAa;YAAS;YAAU;QAAW;IAC/D;IAEA,qBACE,8OAAC;QAAK,UAAU;QAAc,WAAU;;0BACtC,8OAAC,4IAAK;gBACJ,OAAM;gBACN,IAAG;gBACH,MAAK;gBACL,OAAO;gBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,QAAQ;;;;;;0BAEV,8OAAC;;kCACC,8OAAC;wBAAM,SAAQ;wBAAc,WAAU;kCAA+C;;;;;;kCAGtF,8OAAC;wBACC,IAAG;wBACH,MAAK;wBACL,MAAM;wBACN,WAAU;wBACV,OAAO;wBACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;0BAGjD,8OAAC,4IAAK;gBACL,OAAM;gBACN,IAAG;gBACH,MAAK;gBACL,MAAK;gBACL,OAAO;gBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;gBAC1C,QAAQ;gBACR,aAAY;;;;;;0BAEb,8OAAC;;kCACA,8OAAC;wBAAM,SAAQ;wBAAW,WAAU;kCAA+C;;;;;;kCAGnF,8OAAC;wBACC,IAAG;wBACH,MAAK;wBACL,WAAU;wBACV,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;kCAE1C,OAAO,MAAM,CAAC,iHAAQ,EAAE,GAAG,CAAC,CAAA,qBAC3B,8OAAC;gCAAkB,OAAO;0CAAO;+BAApB;;;;;;;;;;;;;;;;0BAInB,8OAAC;;kCACC,8OAAC;wBAAM,WAAU;kCAA+C;;;;;;kCAChE,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAM,WAAU;;kDACb,8OAAC;wCAAM,MAAK;wCAAQ,MAAK;wCAAa,OAAO,2HAAkB,CAAC,YAAY;wCAAE,SAAS,eAAe,2HAAkB,CAAC,YAAY;wCAAE,UAAU,IAAM,cAAc,2HAAkB,CAAC,YAAY;wCAAG,WAAU;;;;;;kDACjN,8OAAC;kDAAK;;;;;;;;;;;;0CAET,8OAAC;gCAAM,WAAU;;kDACd,8OAAC;wCAAM,MAAK;wCAAQ,MAAK;wCAAa,OAAO,2HAAkB,CAAC,MAAM;wCAAE,SAAS,eAAe,2HAAkB,CAAC,MAAM;wCAAE,UAAU,IAAM,cAAc,2HAAkB,CAAC,MAAM;wCAAG,WAAU;;;;;;kDAC/L,8OAAC;kDAAK;;;;;;;;;;;;;;;;;;;;;;;;0BAIhB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,6IAAM;wBAAC,MAAK;wBAAS,SAAQ;wBAAY,SAAS;kCAAU;;;;;;kCAG7D,8OAAC,6IAAM;wBAAC,MAAK;kCAAS;;;;;;;;;;;;;;;;;;AAM9B;uCAEe"}},
    {"offset": {"line": 1509, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/ui/Card.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\n\r\ninterface CardProps {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  title?: string;\r\n  description?: string;\r\n}\r\n\r\nconst Card: React.FC<CardProps> = ({ children, className, title, description }) => {\r\n  return (\r\n    <div className={`bg-white shadow-md rounded-lg overflow-hidden ${className}`}>\r\n        {title && (\r\n            <div className=\"p-6 border-b border-gray-200\">\r\n                <h3 className=\"text-lg font-semibold leading-6 text-gray-900\">{title}</h3>\r\n                {description && <p className=\"mt-1 text-sm text-gray-500\">{description}</p>}\r\n            </div>\r\n        )}\r\n      <div className=\"p-6\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Card;\r\n"],"names":[],"mappings":";;;;;;AAUA,MAAM,OAA4B,CAAC,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,WAAW,EAAE;IAC5E,qBACE,8OAAC;QAAI,WAAW,CAAC,8CAA8C,EAAE,WAAW;;YACvE,uBACG,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;kCAAiD;;;;;;oBAC9D,6BAAe,8OAAC;wBAAE,WAAU;kCAA8B;;;;;;;;;;;;0BAGrE,8OAAC;gBAAI,WAAU;0BACZ;;;;;;;;;;;;AAIT;uCAEe"}},
    {"offset": {"line": 1564, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/tenant/ResourceItemCard.tsx"],"sourcesContent":["import React from 'react';\r\nimport type { EnrichedResourceItem, User, Tenant } from '@/types';\r\nimport { FileType, ResourceVisibility } from '@/types';\r\nimport { can } from '@/lib/permissions';\r\nimport { deleteResourceItem } from '@/lib/data';\r\nimport Card from '../ui/Card';\r\nimport Button from '../ui/Button';\r\n\r\ninterface ResourceItemCardProps {\r\n  resource: EnrichedResourceItem;\r\n  currentUser: User;\r\n  tenant: Tenant;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst FileTypeIcon: React.FC<{ type: FileType }> = ({ type }) => {\r\n  // FIX: Changed `JSX.Element` to `React.ReactElement` to resolve the \"Cannot find namespace 'JSX'\" error by using the explicit type from the imported React module.\r\n  const iconMap: { [key in FileType]: React.ReactElement } = {\r\n    [FileType.PDF]: (\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-full w-full\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n        <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 11-2 0V4H6a1 1 0 11-2 0V4zm4.586 4.586a1 1 0 00-1.414 0L6 9.757V14a1 1 0 001 1h6a1 1 0 001-1V9.757l-1.172-1.171a1 1 0 00-1.414 0L10 9.586 8.586 8.586z\" clipRule=\"evenodd\" />\r\n      </svg>\r\n    ),\r\n    [FileType.DOCX]: (\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-full w-full\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n        <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 11-2 0V4H6a1 1 0 11-2 0V4zm1 6a1 1 0 011-1h6a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H6z\" clipRule=\"evenodd\" />\r\n      </svg>\r\n    ),\r\n    [FileType.MP3]: (\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-full w-full\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n        <path d=\"M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 1.343-3 3s1.343 3 3 3 3-1.343 3-3V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 1.343-3 3s1.343 3 3 3 3-1.343 3-3V3z\" />\r\n      </svg>\r\n    ),\r\n    [FileType.JPG]: (\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-full w-full\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n        <path fillRule=\"evenodd\" d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\" clipRule=\"evenodd\" />\r\n      </svg>\r\n    ),\r\n    [FileType.PNG]: (\r\n       <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-full w-full\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n        <path fillRule=\"evenodd\" d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\" clipRule=\"evenodd\" />\r\n      </svg>\r\n    ),\r\n    [FileType.OTHER]: (\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-full w-full\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n        <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\r\n      </svg>\r\n    ),\r\n  };\r\n  return iconMap[type] || iconMap[FileType.OTHER];\r\n};\r\n\r\nconst ResourceItemCard: React.FC<ResourceItemCardProps> = ({ resource, currentUser, tenant, onUpdate }) => {\r\n  const canManage = can(currentUser, tenant, 'canManageResources');\r\n\r\n  const handleDelete = () => {\r\n    if (window.confirm('Are you sure you want to delete this resource? This action cannot be undone.')) {\r\n      deleteResourceItem(resource.id, currentUser.id);\r\n      onUpdate();\r\n    }\r\n  };\r\n  \r\n  const iconBgColor = resource.visibility === ResourceVisibility.MEMBERS_ONLY ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-100 text-gray-600';\r\n\r\n  return (\r\n    <Card className=\"!p-0 flex flex-col h-full\">\r\n      <div className=\"p-6 flex-grow flex flex-col\">\r\n        <div className=\"flex items-start space-x-4\">\r\n          <div className={`w-12 h-12 flex-shrink-0 rounded-lg p-2 ${iconBgColor}`}>\r\n            <FileTypeIcon type={resource.fileType} />\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 line-clamp-2\">{resource.title}</h3>\r\n            {resource.visibility === ResourceVisibility.MEMBERS_ONLY && (\r\n              <span className=\"inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800 mt-1\">\r\n                Members Only\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <p className=\"mt-4 text-sm text-gray-600 flex-grow line-clamp-3\">{resource.description}</p>\r\n      </div>\r\n      <div className=\"bg-gray-50 px-6 py-3 border-t border-gray-200\">\r\n        <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n          <span>{resource.uploaderDisplayName}</span>\r\n          <span>{resource.createdAt.toLocaleDateString()}</span>\r\n        </div>\r\n        <div className=\"mt-3 flex items-center space-x-2\">\r\n            <a href={resource.fileUrl} download className=\"w-full\">\r\n                <Button className=\"w-full\">Download</Button>\r\n            </a>\r\n            {canManage && (\r\n                <Button variant=\"danger\" size=\"sm\" onClick={handleDelete} className=\"!p-2.5\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                        <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                </Button>\r\n            )}\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default ResourceItemCard;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1874, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/josep/VSCODEprojects/Temple/Temple4/app/components/tenant/ResourceCenterPage.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport type { Tenant, User, ResourceItem } from '@/types';\r\nimport { getResourceItemsForTenant, getMembershipForUserInTenant, addResourceItem } from '@/lib/data';\r\nimport { can } from '@/lib/permissions';\r\nimport Button from '../ui/Button';\r\nimport Modal from '../ui/Modal';\r\nimport ResourceForm from './forms/ResourceForm';\r\nimport ResourceItemCard from './ResourceItemCard';\r\n\r\ninterface ResourceCenterPageProps {\r\n  tenant: Tenant;\r\n  user: User;\r\n  onRefresh: () => void;\r\n}\r\n\r\nconst ResourceCenterPage: React.FC<ResourceCenterPageProps> = ({ tenant, user, onRefresh }) => {\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  \r\n  const membership = useMemo(() => getMembershipForUserInTenant(user.id, tenant.id), [user.id, tenant.id]);\r\n  const isMember = membership?.status === 'APPROVED';\r\n  \r\n  const resources = useMemo(() => getResourceItemsForTenant(tenant.id, isMember), [tenant.id, isMember, onRefresh]);\r\n\r\n  const canUpload = can(user, tenant, 'canUploadResources');\r\n\r\n  const handleCreateResource = (data: Omit<ResourceItem, 'id' | 'createdAt' | 'tenantId' | 'uploaderUserId'>) => {\r\n    addResourceItem({\r\n      ...data,\r\n      tenantId: tenant.id,\r\n      uploaderUserId: user.id,\r\n    });\r\n    onRefresh();\r\n    setIsModalOpen(false);\r\n    alert('Resource uploaded successfully!');\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-gray-900\">Resource Center</h2>\r\n          <p className=\"mt-1 text-sm text-gray-500\">\r\n            Downloadable files and resources from {tenant.name}.\r\n          </p>\r\n        </div>\r\n        {canUpload && (\r\n          <Button onClick={() => setIsModalOpen(true)}>+ Upload Resource</Button>\r\n        )}\r\n      </div>\r\n\r\n      {resources.length > 0 ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {resources.map(resource => (\r\n            <ResourceItemCard key={resource.id} resource={resource} currentUser={user} tenant={tenant} onUpdate={onRefresh} />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center bg-white p-12 rounded-lg shadow-sm\">\r\n          <h3 className=\"text-lg font-medium text-gray-900\">No Resources Available</h3>\r\n          <p className=\"mt-1 text-sm text-gray-500\">\r\n            There are no resources here yet. {canUpload ? 'Why not upload one?' : ''}\r\n          </p>\r\n        </div>\r\n      )}\r\n      \r\n      <Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} title=\"Upload a New Resource\">\r\n        <ResourceForm onSubmit={handleCreateResource} onCancel={() => setIsModalOpen(false)} />\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResourceCenterPage;"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;AAiBA,MAAM,qBAAwD,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;IACxF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,MAAM,aAAa,IAAA,gNAAO,EAAC,IAAM,IAAA,2IAA4B,EAAC,KAAK,EAAE,EAAE,OAAO,EAAE,GAAG;QAAC,KAAK,EAAE;QAAE,OAAO,EAAE;KAAC;IACvG,MAAM,WAAW,YAAY,WAAW;IAExC,MAAM,YAAY,IAAA,gNAAO,EAAC,IAAM,IAAA,wIAAyB,EAAC,OAAO,EAAE,EAAE,WAAW;QAAC,OAAO,EAAE;QAAE;QAAU;KAAU;IAEhH,MAAM,YAAY,IAAA,yHAAG,EAAC,MAAM,QAAQ;IAEpC,MAAM,uBAAuB,CAAC;QAC5B,IAAA,8HAAe,EAAC;YACd,GAAG,IAAI;YACP,UAAU,OAAO,EAAE;YACnB,gBAAgB,KAAK,EAAE;QACzB;QACA;QACA,eAAe;QACf,MAAM;IACR;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAAmC;;;;;;0CACjD,8OAAC;gCAAE,WAAU;;oCAA6B;oCACD,OAAO,IAAI;oCAAC;;;;;;;;;;;;;oBAGtD,2BACC,8OAAC,6IAAM;wBAAC,SAAS,IAAM,eAAe;kCAAO;;;;;;;;;;;;YAIhD,UAAU,MAAM,GAAG,kBAClB,8OAAC;gBAAI,WAAU;0BACZ,UAAU,GAAG,CAAC,CAAA,yBACb,8OAAC,2JAAgB;wBAAmB,UAAU;wBAAU,aAAa;wBAAM,QAAQ;wBAAQ,UAAU;uBAA9E,SAAS,EAAE;;;;;;;;;yEAItC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAoC;;;;;;kCAClD,8OAAC;wBAAE,WAAU;;4BAA6B;4BACN,YAAY,wBAAwB;;;;;;;;;;;;;0BAK5E,8OAAC,4IAAK;gBAAC,QAAQ;gBAAa,SAAS,IAAM,eAAe;gBAAQ,OAAM;0BACtE,cAAA,8OAAC,gKAAY;oBAAC,UAAU;oBAAsB,UAAU,IAAM,eAAe;;;;;;;;;;;;;;;;;AAIrF;uCAEe"}}]
}