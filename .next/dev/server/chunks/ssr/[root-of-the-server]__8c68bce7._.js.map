{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\ndeclare global {\n  // allow global `var` declarations\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClient | undefined;\n}\n\nexport const prisma =\n  globalThis.prisma ||\n  new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,SACX,WAAW,MAAM,IACjB,IAAI,6IAAY;AAElB,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/lib/data.ts"],"sourcesContent":["import { prisma } from './db';\nimport { Tenant, User, Post, Event, UserTenantMembership, Notification, AuditLog, Conversation, TenantRole, MembershipStatus, TenantSettings, TenantBranding } from '@prisma/client';\nimport bcrypt from 'bcryptjs';\n\ntype TenantWithDetails = Tenant & {\n    settings: TenantSettings | null;\n    branding: TenantBranding | null;\n};\n\nexport async function getTenantsForUser(userId: string): Promise<Tenant[]> {\n  const memberships = await prisma.userTenantMembership.findMany({\n    where: {\n      userId: userId,\n      status: 'APPROVED',\n    },\n    include: {\n      tenant: true,\n    },\n  });\n\n  return memberships.map((membership: { tenant: Tenant; }) => membership.tenant);\n}\n\nexport async function getTenantById(tenantId: string) {\n  return await prisma.tenant.findUnique({\n    where: { id: tenantId },\n    include: {\n      settings: true,\n      branding: true,\n    },\n  });\n}\n\nexport async function getUserById(userId: string) {\n  return await prisma.user.findUnique({\n    where: { id: userId },\n    include: {\n      profile: true,\n      privacySettings: true,\n      accountSettings: true,\n    },\n  });\n}\n\nexport async function getTenants(): Promise<Tenant[]> {\n    const tenants = await prisma.tenant.findMany({\n        include: {\n            settings: true,\n            branding: true,\n        }\n    });\n    \n    // Transform Prisma data to match Tenant interface with nested address\n    return tenants.map(tenant => ({\n        ...tenant,\n        address: {\n            street: tenant.street,\n            city: tenant.city,\n            state: tenant.state,\n            country: tenant.country,\n            postalCode: tenant.postalCode,\n        },\n        settings: tenant.settings || {\n            isPublic: true,\n            allowMemberDirectory: true,\n            allowEvents: true,\n            allowDonations: true,\n            allowSmallGroups: true,\n            allowMessaging: true,\n        },\n        branding: tenant.branding || {\n            logoUrl: '',\n            bannerImageUrl: '',\n            primaryColor: '#d97706',\n            accentColor: '#92400e',\n        },\n        permissions: tenant.permissions as any || {},\n    })) as Tenant[];\n}\n\nexport async function getEventsForTenant(tenantId: string): Promise<Event[]> {\n  return await prisma.event.findMany({\n    where: { tenantId },\n    orderBy: { startDateTime: 'asc' },\n  });\n}\n\nexport async function getPostsForTenant(tenantId: string): Promise<Post[]> {\n  return await prisma.post.findMany({\n    where: { tenantId, isPublished: true },\n    orderBy: { publishedAt: 'desc' },\n    include: {\n      author: {\n        include: {\n          profile: true,\n        }\n      }\n    }\n  });\n}\n\nexport async function getMembershipForUserInTenant(userId: string, tenantId: string): Promise<UserTenantMembership | null> {\n  return await prisma.userTenantMembership.findUnique({\n    where: {\n      userId_tenantId: {\n        userId,\n        tenantId,\n      }\n    },\n  });\n}\n\nexport async function getNotificationsForUser(userId: string): Promise<Notification[]> {\n    return await prisma.notification.findMany({\n        where: { userId },\n        orderBy: { createdAt: 'desc' },\n    });\n}\n\nexport async function markNotificationAsRead(notificationId: string): Promise<Notification> {\n    return await prisma.notification.update({\n        where: { id: notificationId },\n        data: { isRead: true },\n    });\n}\n\nexport async function markAllNotificationsAsRead(userId: string) {\n    return await prisma.notification.updateMany({\n        where: { userId },\n        data: { isRead: true },\n    });\n}\n\nexport async function getUserByEmail(email: string) {\n    return await prisma.user.findUnique({\n        where: { email },\n        include: {\n            profile: true,\n            privacySettings: true,\n            accountSettings: true,\n        },\n    });\n}\n\nexport async function registerUser(displayName: string, email: string, pass: string) {\n    const existingUser = await getUserByEmail(email);\n    if (existingUser) {\n        return { success: false, message: 'User with this email already exists.' };\n    }\n    const hashedPassword = await bcrypt.hash(pass, 10);\n    const user = await prisma.user.create({\n        data: {\n            email,\n            password: hashedPassword,\n            profile: {\n                create: {\n                    displayName,\n                },\n            },\n            accountSettings: { create: {} },\n            privacySettings: { create: {} },\n        },\n        include: {\n            profile: true,\n            privacySettings: true,\n            accountSettings: true,\n        }\n    });\n    return { success: true, user };\n}\n\nexport async function createTenant(tenantDetails: Omit<Tenant, 'id' | 'slug' | 'permissions'>, ownerId: string): Promise<Tenant> {\n    const tenant = await prisma.tenant.create({\n        data: {\n            ...tenantDetails,\n            slug: tenantDetails.name.toLowerCase().replace(/ /g, '-'),\n            memberships: {\n                create: {\n                    userId: ownerId,\n                    roles: {\n                        create: {\n                            role: TenantRole.ADMIN,\n                        }\n                    },\n                    status: MembershipStatus.APPROVED,\n                }\n            },\n            settings: { \n                create: {\n                    isPublic: false,\n                    membershipApprovalMode: 'APPROVAL_REQUIRED',\n                    enableCalendar: true,\n                    enablePosts: true,\n                    enableSermons: true,\n                    enablePodcasts: true,\n                    enableBooks: true,\n                    enableDonations: true,\n                    enableVolunteering: true,\n                    enableSmallGroups: true,\n                    enableLiveStream: true,\n                    enablePrayerWall: true,\n                    enableResourceCenter: true,\n                    visitorVisibility: {},\n                    donationSettings: {},\n                    liveStreamSettings: {},\n                } \n            },\n            branding: { \n                create: {\n                    logoUrl: '',\n                    bannerImageUrl: '',\n                    primaryColor: '#000000',\n                    accentColor: '#FFFFFF',\n                    customLinks: [],\n                } \n            },\n        }\n    });\n    return tenant;\n}\n\nexport async function updateTenant(tenant: Partial<TenantWithDetails>): Promise<Tenant> {\n    const { id, settings, branding, ...data } = tenant;\n    \n    const updateData: any = { ...data };\n\n    if (settings) {\n        const { id: settingsId, tenantId: settingsTenantId, ...restOfSettings } = settings;\n        updateData.settings = {\n            update: {\n                ...restOfSettings,\n                visitorVisibility: restOfSettings.visitorVisibility || undefined,\n                donationSettings: restOfSettings.donationSettings || undefined,\n                liveStreamSettings: restOfSettings.liveStreamSettings || undefined,\n            }\n        };\n    }\n\n    if (branding) {\n        const { id: brandingId, tenantId: brandingTenantId, ...restOfBranding } = branding;\n        updateData.branding = {\n            update: {\n                ...restOfBranding,\n                customLinks: restOfBranding.customLinks || undefined,\n            }\n        };\n    }\n\n    return await prisma.tenant.update({\n        where: { id },\n        data: updateData,\n    });\n}\n\nexport async function requestToJoinTenant(userId: string, tenantId: string): Promise<UserTenantMembership> {\n    const existingMembership = await getMembershipForUserInTenant(userId, tenantId);\nif (existingMembership) {\n        return existingMembership;\n    }\n    return await prisma.userTenantMembership.create({\n        data: {\n            userId,\n            tenantId,\n            roles: {\n                create: {\n                    role: TenantRole.MEMBER,\n                }\n            },\n            status: MembershipStatus.PENDING,\n        }\n    });\n}\n\n// NOTE: These are not secure and are for demonstration only.\n// In a real app, you'd use secure tokens and a proper reset flow.\nexport async function requestPasswordReset(email: string): Promise<boolean> {\n    const user = await getUserByEmail(email);\n    if (!user) return false;\n    // In a real app, generate a token, save it, and email a link.\n    console.log(`Password reset requested for ${email}. In this demo, we'll just allow a direct reset.`);\n    return true;\n}\n\nexport async function resetPassword(email: string, newPass: string) {\n    const user = await getUserByEmail(email);\n    if (!user) return { success: false, message: \"User not found.\" };\n    const hashedPassword = await bcrypt.hash(newPass, 10);\n    await prisma.user.update({\n        where: { email },\n        data: { password: hashedPassword },\n    });\n    return { success: true };\n}\n\nexport async function logAuditEvent(event: Omit<AuditLog, 'id' | 'createdAt'>): Promise<AuditLog> {\n    return await prisma.auditLog.create({\n        data: {\n            ...event,\n            metadata: event.metadata || {},\n        },\n    });\n}\n\nexport async function getOrCreateDirectConversation(userId1: string, userId2: string): Promise<Conversation> {\n    const existing = await prisma.conversation.findFirst({\n        where: {\n            isDirectMessage: true,\n            participants: {\n                every: {\n                    userId: { in: [userId1, userId2] }\n                }\n            }\n        },\n        include: { participants: true }\n    });\n\n    if (existing) return existing;\n\n    return await prisma.conversation.create({\n        data: {\n            isDirectMessage: true,\n            participants: {\n                create: [\n                    { userId: userId1 },\n                    { userId: userId2 },\n                ]\n            }\n        }\n    });\n}\n\nexport async function getConversationsForUser(userId: string) {\n    return await prisma.conversation.findMany({\n        where: {\n            participants: {\n                some: {\n                    userId: userId\n                }\n            }\n        },\n        include: {\n            participants: {\n                include: {\n                    user: {\n                        include: {\n                            profile: true\n                        }\n                    }\n                }\n            },\n            messages: {\n                orderBy: {\n                    createdAt: 'desc'\n                },\n                take: 1,\n                include: {\n                    user: {\n                        include: {\n                            profile: true\n                        }\n                    }\n                }\n            }\n        },\n        orderBy: {\n            id: 'desc'\n        }\n    });\n}\n\nexport async function getMessagesForConversation(conversationId: string) {\n    return await prisma.chatMessage.findMany({\n        where: {\n            conversationId: conversationId\n        },\n        include: {\n            user: {\n                include: {\n                    profile: true\n                }\n            }\n        },\n        orderBy: {\n            createdAt: 'asc'\n        }\n    });\n}\n\nexport async function addMessage(conversationId: string, senderId: string, content: string) {\n    const message = await prisma.chatMessage.create({\n        data: {\n            conversationId,\n            userId: senderId,\n            text: content\n        },\n        include: {\n            user: {\n                include: {\n                    profile: true\n                }\n            }\n        }\n    });\n\n    return message;\n}\n\nexport async function deleteMessage(messageId: string) {\n    return await prisma.chatMessage.delete({\n        where: { id: messageId }\n    });\n}\n\nexport async function markConversationAsRead(conversationId: string, userId: string) {\n    // This would update read receipts via ConversationParticipant's lastReadMessageId\n    // For now, just return success\n    return { success: true };\n}\n\nexport async function getAllUsers() {\n    return await prisma.user.findMany({\n        include: {\n            profile: true\n        }\n    });\n}\n\nexport async function getAuditLogs() {\n    return await prisma.auditLog.findMany({\n        include: {\n            actorUser: {\n                include: {\n                    profile: true\n                }\n            },\n            effectiveUser: {\n                include: {\n                    profile: true\n                }\n            }\n        },\n        orderBy: {\n            createdAt: 'desc'\n        },\n        take: 100\n    });\n}\n\n// Get enriched memberships for a user (includes tenant details)\nexport async function getEnrichedMembershipsForUser(userId: string) {\n    const memberships = await prisma.userTenantMembership.findMany({\n        where: { userId },\n        include: {\n            tenant: {\n                include: {\n                    settings: true,\n                    branding: true,\n                }\n            }\n        }\n    });\n    \n    return memberships.map(m => ({\n        membership: m,\n        tenant: m.tenant\n    }));\n}\n\n// Update membership profile (display name and title within a tenant)\nexport async function updateMembershipProfile(\n    userId: string, \n    membershipId: string, \n    data: { displayName?: string; displayTitle?: string }\n) {\n    return await prisma.userTenantMembership.update({\n        where: { id: membershipId, userId },\n        data: {\n            displayName: data.displayName,\n            displayTitle: data.displayTitle\n        }\n    });\n}\n\n// Update user notification preferences\nexport async function updateUserNotificationPreferences(\n    userId: string,\n    preferences: any\n) {\n    // Note: This assumes notification preferences are stored in a JSON field or separate table\n    // Adjust based on your actual schema\n    return await prisma.user.update({\n        where: { id: userId },\n        data: {\n            // If you have a notificationPreferences JSON field:\n            // notificationPreferences: preferences\n        }\n    });\n}\n\n// ===== MISSING FUNCTION STUBS =====\n// These functions are called by components but not yet fully implemented\n\nexport async function getMembersForTenant(tenantId: string) {\n    // TODO: Implement member fetching with enriched data\n    return [];\n}\n\nexport async function updateMembershipStatus(userId: string, tenantId: string, status: string) {\n    // TODO: Implement membership status update\n    return null;\n}\n\nexport async function updateMemberRolesAndTitle(userId: string, tenantId: string, roles: any[], title: string) {\n    // TODO: Implement member roles and title update\n    return null;\n}\n\nexport async function getSmallGroupsForTenant(tenantId: string) {\n    // TODO: Implement small groups fetching\n    return [];\n}\n\nexport async function createSmallGroup(tenantId: string, groupData: any) {\n    // TODO: Implement small group creation\n    return null;\n}\n\nexport async function getVolunteerNeedsForTenant(tenantId: string) {\n    // TODO: Implement volunteer needs fetching\n    return [];\n}\n\nexport async function addVolunteerNeed(tenantId: string, needData: any) {\n    // TODO: Implement volunteer need creation\n    return null;\n}\n\nexport async function getResourceItemsForTenant(tenantId: string) {\n    // TODO: Implement resource items fetching\n    return [];\n}\n\nexport async function addResourceItem(tenantId: string, itemData: any) {\n    // TODO: Implement resource item creation\n    return null;\n}\n\nexport async function deleteResourceItem(itemId: string) {\n    // TODO: Implement resource item deletion\n    return null;\n}\n\nexport async function getCommunityPostsForTenant(tenantId: string) {\n    // TODO: Implement community posts fetching\n    return [];\n}\n\nexport async function updateCommunityPostStatus(postId: string, status: string) {\n    // TODO: Implement community post status update\n    return null;\n}\n\nexport async function getContactSubmissionsForTenant(tenantId: string) {\n    // TODO: Implement contact submissions fetching\n    return [];\n}\n\nexport async function updateContactSubmissionStatus(submissionId: string, status: string) {\n    // TODO: Implement contact submission status update\n    return null;\n}\n\nexport async function respondToContactSubmission(submissionId: string, response: string) {\n    // TODO: Implement contact submission response\n    return null;\n}\n\nexport async function updateTenantPermissions(tenantId: string, permissions: any) {\n    // TODO: Implement tenant permissions update\n    return null;\n}\n\nexport async function addPost(tenantId: string, postData: any) {\n    // TODO: Implement post creation\n    return null;\n}\n\nexport async function addEvent(tenantId: string, eventData: any) {\n    // TODO: Implement event creation\n    return null;\n}\n\nexport async function getSermonsForTenant(tenantId: string) {\n    // TODO: Implement sermons fetching\n    return [];\n}\n\nexport async function getPodcastsForTenant(tenantId: string) {\n    // TODO: Implement podcasts fetching\n    return [];\n}\n\nexport async function getBooksForTenant(tenantId: string) {\n    // TODO: Implement books fetching\n    return [];\n}\n\nexport async function getDonationsForTenant(tenantId: string) {\n    // TODO: Implement donations fetching\n    return [];\n}\n\nexport async function addDonationRecord(tenantId: string, donationData: any) {\n    // TODO: Implement donation record creation\n    return null;\n}\n\nexport async function addContactSubmission(tenantId: string, submissionData: any) {\n    // TODO: Implement contact submission creation\n    return null;\n}\n\nexport async function addCommunityPost(tenantId: string, postData: any) {\n    // TODO: Implement community post creation\n    return null;\n}\n\nexport async function joinSmallGroup(groupId: string, userId: string) {\n    // TODO: Implement small group join\n    return null;\n}\n\nexport async function leaveSmallGroup(groupId: string, userId: string) {\n    // TODO: Implement small group leave\n    return null;\n}\n\nexport async function signUpForNeed(needId: string, userId: string) {\n    // TODO: Implement volunteer need sign up\n    return null;\n}\n\nexport async function cancelSignUp(needId: string, userId: string) {\n    // TODO: Implement volunteer need cancellation\n    return null;\n}\n\nexport async function createConversation(conversationData: any) {\n    // TODO: Implement conversation creation\n    return null;\n}\n\nexport async function adminUpdateUserProfile(userId: string, profileData: any) {\n    // TODO: Implement admin user profile update\n    return null;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 793, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/ui/Input.tsx"],"sourcesContent":["import React from 'react';\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n  containerClassName?: string;\n}\n\nconst Input: React.FC<InputProps> = ({ label, id, containerClassName, ...props }) => {\n  return (\n    <div className={containerClassName}>\n      <label htmlFor={id} className=\"block text-sm font-medium text-gray-700 mb-1\">\n        {label}\n      </label>\n      <input\n        id={id}\n        className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400\"\n        {...props}\n      />\n    </div>\n  );\n};\n\nexport default Input;"],"names":[],"mappings":";;;;;;AAOA,MAAM,QAA8B,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,kBAAkB,EAAE,GAAG,OAAO;IAC9E,qBACE,8OAAC;QAAI,WAAW;;0BACd,8OAAC;gBAAM,SAAS;gBAAI,WAAU;0BAC3B;;;;;;0BAEH,8OAAC;gBACC,IAAI;gBACJ,WAAU;gBACT,GAAG,KAAK;;;;;;;;;;;;AAIjB;uCAEe"}},
    {"offset": {"line": 833, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/messages/ConversationList.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport type { EnrichedConversation, User } from '@/types';\nimport Input from '../ui/Input';\n\ninterface ConversationListProps {\n  conversations: EnrichedConversation[];\n  currentUser: User;\n  activeConversationId?: string | null;\n  onConversationSelect: (conversation: EnrichedConversation) => void;\n  searchTerm?: string;\n  onSearchChange?: (term: string) => void;\n}\n\nconst ConversationList: React.FC<ConversationListProps> = ({\n  conversations,\n  currentUser,\n  activeConversationId,\n  onConversationSelect,\n  searchTerm,\n  onSearchChange,\n}) => {\n  const getOtherParticipant = (conv: EnrichedConversation) => {\n    return conv.participants.find((p) => p.id !== currentUser.id);\n  };\n\n  const filteredConversations = useMemo(() => {\n    if (!searchTerm) return conversations;\n    const lowercasedTerm = searchTerm.toLowerCase();\n    return conversations.filter((c) => c.displayName.toLowerCase().includes(lowercasedTerm));\n  }, [conversations, searchTerm]);\n\n  return (\n    <div className=\"flex-1 flex flex-col\">\n      {onSearchChange && searchTerm !== undefined && (\n        <div className=\"p-4 border-b border-gray-200\">\n          <Input\n            label=\"\"\n            id=\"conversation-search\"\n            type=\"search\"\n            placeholder=\"Search conversations...\"\n            value={searchTerm}\n            onChange={(e) => onSearchChange(e.target.value)}\n          />\n        </div>\n      )}\n      <div className=\"flex-1 overflow-y-auto\">\n        <ul className=\"divide-y divide-gray-200\">\n          {filteredConversations.map((conv) => {\n            const otherParticipant = conv.isDirect ? getOtherParticipant(conv) : null;\n            const isActive = conv.id === activeConversationId;\n            const lastMessageText = conv.lastMessage\n              ? `${conv.lastMessage.userId === currentUser.id ? 'You: ' : ''}${conv.lastMessage.text}`\n              : 'No messages yet';\n\n            return (\n              <li\n                key={conv.id}\n                onClick={() => onConversationSelect(conv)}\n                className={`p-4 cursor-pointer transition-colors ${\n                  isActive ? 'bg-amber-50' : 'hover:bg-gray-50'\n                }`}\n              >\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"relative\">\n                    {conv.isDirect && otherParticipant ? (\n                      <img\n                        className=\"h-10 w-10 rounded-full\"\n                        // FIX: Access avatarUrl and displayName from the nested profile object.\n                        src={otherParticipant.profile.avatarUrl}\n                        alt={otherParticipant.profile.displayName}\n                      />\n                    ) : (\n                      <div className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center\">\n                        <span className=\"text-gray-500 font-bold\">#</span>\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex justify-between items-center\">\n                      <p className=\"text-sm font-semibold text-gray-900 truncate\">\n                        {conv.displayName}\n                      </p>\n                      {conv.lastMessage && (\n                        <div className=\"text-xs text-gray-400 self-start flex-shrink-0 ml-2\">\n                          {conv.lastMessage.createdAt.toLocaleTimeString([], {\n                            hour: '2-digit',\n                            minute: '2-digit',\n                          })}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                       <p className=\"text-sm text-gray-500 truncate\">{lastMessageText}</p>\n                       {conv.unreadCount > 0 && (\n                         <span className=\"ml-2 flex-shrink-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full\">\n                           {conv.unreadCount}\n                         </span>\n                       )}\n                    </div>\n                  </div>\n                </div>\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default ConversationList;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAWA,MAAM,mBAAoD,CAAC,EACzD,aAAa,EACb,WAAW,EACX,oBAAoB,EACpB,oBAAoB,EACpB,UAAU,EACV,cAAc,EACf;IACC,MAAM,sBAAsB,CAAC;QAC3B,OAAO,KAAK,YAAY,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,YAAY,EAAE;IAC9D;IAEA,MAAM,wBAAwB,IAAA,gNAAO,EAAC;QACpC,IAAI,CAAC,YAAY,OAAO;QACxB,MAAM,iBAAiB,WAAW,WAAW;QAC7C,OAAO,cAAc,MAAM,CAAC,CAAC,IAAM,EAAE,WAAW,CAAC,WAAW,GAAG,QAAQ,CAAC;IAC1E,GAAG;QAAC;QAAe;KAAW;IAE9B,qBACE,8OAAC;QAAI,WAAU;;YACZ,kBAAkB,eAAe,2BAChC,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,4IAAK;oBACJ,OAAM;oBACN,IAAG;oBACH,MAAK;oBACL,aAAY;oBACZ,OAAO;oBACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;0BAIpD,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAG,WAAU;8BACX,sBAAsB,GAAG,CAAC,CAAC;wBAC1B,MAAM,mBAAmB,KAAK,QAAQ,GAAG,oBAAoB,QAAQ;wBACrE,MAAM,WAAW,KAAK,EAAE,KAAK;wBAC7B,MAAM,kBAAkB,KAAK,WAAW,GACpC,GAAG,KAAK,WAAW,CAAC,MAAM,KAAK,YAAY,EAAE,GAAG,UAAU,KAAK,KAAK,WAAW,CAAC,IAAI,EAAE,GACtF;wBAEJ,qBACE,8OAAC;4BAEC,SAAS,IAAM,qBAAqB;4BACpC,WAAW,CAAC,qCAAqC,EAC/C,WAAW,gBAAgB,oBAC3B;sCAEF,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDACZ,KAAK,QAAQ,IAAI,iCAChB,8OAAC;4CACC,WAAU;4CACV,wEAAwE;4CACxE,KAAK,iBAAiB,OAAO,CAAC,SAAS;4CACvC,KAAK,iBAAiB,OAAO,CAAC,WAAW;;;;;qGAG3C,8OAAC;4CAAI,WAAU;sDACb,cAAA,8OAAC;gDAAK,WAAU;0DAA0B;;;;;;;;;;;;;;;;kDAIhD,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAE,WAAU;kEACV,KAAK,WAAW;;;;;;oDAElB,KAAK,WAAW,kBACf,8OAAC;wDAAI,WAAU;kEACZ,KAAK,WAAW,CAAC,SAAS,CAAC,kBAAkB,CAAC,EAAE,EAAE;4DACjD,MAAM;4DACN,QAAQ;wDACV;;;;;;;;;;;;0DAIN,8OAAC;gDAAI,WAAU;;kEACZ,8OAAC;wDAAE,WAAU;kEAAkC;;;;;;oDAC9C,KAAK,WAAW,GAAG,mBAClB,8OAAC;wDAAK,WAAU;kEACb,KAAK,WAAW;;;;;;;;;;;;;;;;;;;;;;;;2BAvCvB,KAAK,EAAE;;;;;oBA+ClB;;;;;;;;;;;;;;;;;AAKV;uCAEe"}},
    {"offset": {"line": 1018, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/ui/Button.tsx"],"sourcesContent":["import React from 'react';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'danger';\n  size?: 'sm' | 'md';\n  children: React.ReactNode;\n}\n\nconst Button: React.FC<ButtonProps> = ({ children, variant = 'primary', size = 'md', className, ...props }) => {\n  const baseClasses = \"rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\";\n\n  const variantClasses = {\n    primary: 'bg-amber-600 text-white hover:bg-amber-700 focus:ring-amber-500',\n    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400',\n    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',\n  };\n  \n  const sizeClasses = {\n      md: \"px-4 py-2 text-sm\",\n      sm: \"px-3 py-1.5 text-xs\",\n  }\n\n  return (\n    <button className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${className}`} {...props}>\n      {children}\n    </button>\n  );\n};\n\nexport default Button;\n"],"names":[],"mappings":";;;;;;AAQA,MAAM,SAAgC,CAAC,EAAE,QAAQ,EAAE,UAAU,SAAS,EAAE,OAAO,IAAI,EAAE,SAAS,EAAE,GAAG,OAAO;IACxG,MAAM,cAAc;IAEpB,MAAM,iBAAiB;QACrB,SAAS;QACT,WAAW;QACX,QAAQ;IACV;IAEA,MAAM,cAAc;QAChB,IAAI;QACJ,IAAI;IACR;IAEA,qBACE,8OAAC;QAAO,WAAW,GAAG,YAAY,CAAC,EAAE,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,WAAW;QAAG,GAAG,KAAK;kBACxG;;;;;;AAGP;uCAEe"}},
    {"offset": {"line": 1050, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/lib/permissions.ts"],"sourcesContent":["import { TenantRole, User, Tenant, ChatMessage, Conversation, UserTenantMembership } from '@prisma/client';\nimport { prisma } from './db';\n\n// Define RolePermissions based on your application's logic, as it's not in Prisma schema\nexport interface RolePermissions {\n  canCreatePosts: boolean;\n  canCreateEvents: boolean;\n  canCreateSermons: boolean;\n  canCreatePodcasts: boolean;\n  canCreateBooks: boolean;\n  canCreateGroupChats: boolean;\n  canInviteMembers: boolean;\n  canApproveMembership: boolean;\n  canBanMembers: boolean;\n  canModeratePosts: boolean;\n  canModerateChats: boolean;\n  canPostInAnnouncementChannels?: boolean;\n  canManagePrayerWall: boolean;\n  canUploadResources: boolean;\n  canManageResources: boolean;\n  canManageContactSubmissions: boolean;\n}\n\n// This can be a simple enum if you don't need the string values\nexport enum TenantRoleType {\n    MEMBER = 'MEMBER',\n    STAFF = 'STAFF',\n    MODERATOR = 'MODERATOR',\n}\n\nasync function getMembershipForUserInTenant(userId: string, tenantId: string): Promise<(UserTenantMembership & { roles: { role: TenantRole }[] }) | null> {\n    return prisma.userTenantMembership.findUnique({\n        where: {\n            userId_tenantId: {\n                userId,\n                tenantId,\n            },\n        },\n        include: {\n            roles: {\n                select: {\n                    role: true\n                }\n            },\n        }\n    });\n}\n\n\n\n/**\n * Maps a specific TenantRole to a more general TenantRoleType for permission lookups.\n */\nfunction getRoleType(role: TenantRole): TenantRoleType | 'ADMIN' {\n    switch (role) {\n        case TenantRole.ADMIN:\n            return 'ADMIN';\n        case TenantRole.STAFF:\n        case TenantRole.CLERGY:\n            return TenantRoleType.STAFF;\n        case TenantRole.MODERATOR:\n            return TenantRoleType.MODERATOR;\n        case TenantRole.MEMBER:\n            return TenantRoleType.MEMBER;\n        default:\n            return TenantRoleType.MEMBER;\n    }\n}\n\n\n/**\n * Checks if a user has a specific permission within a tenant.\n * This is the centralized source of truth for all permission checks.\n *\n * @param user The user to check.\n * @param tenant The tenant context for the permission.\n * @param permission The permission to check for (e.g., 'canCreatePosts').\n * @returns {boolean} True if the user has the permission, false otherwise.\n */\nexport async function can(user: User, tenant: Tenant, permission: keyof RolePermissions): Promise<boolean> {\n  // Super Admins can do anything.\n  if (user.isSuperAdmin) {\n    return true;\n  }\n\n  // Find the user's membership for this specific tenant.\n  const membership = await getMembershipForUserInTenant(user.id, tenant.id);\n\n  // If the user is not a member or not approved, they have no permissions.\n  if (!membership || membership.status !== 'APPROVED') {\n    return false;\n  }\n  \n  // Check if any of the user's roles grant the required permission.\n  for (const roleInfo of membership.roles) {\n    const roleType = getRoleType(roleInfo.role);\n    const permissions = tenant.permissions as any;\n\n    // If permissions is null or undefined, no permissions are granted\n    if (!permissions) {\n      continue;\n    }\n\n    if (roleType === 'ADMIN') {\n        // Admins have all permissions defined under the ADMIN key.\n        if (permissions.ADMIN && permissions.ADMIN[permission]) {\n            return true;\n        }\n    } else {\n        // For other roles, check against their TenantRoleType.\n        const rolePerms = permissions[roleType];\n        if (rolePerms && rolePerms[permission]) {\n            return true; // Permission granted by at least one role.\n        }\n    }\n  }\n\n  return false; // No role granted the permission.\n}\n\n/**\n * Checks if a user has a specific role within a tenant.\n *\n * @param user The user to check.\n * @param tenantId The ID of the tenant context for the role.\n * @param role The role to check for.\n * @returns {boolean} True if the user has the role, false otherwise.\n */\nexport async function hasRole(userId: string, tenantId: string, requiredRoles: TenantRole[]): Promise<boolean> {\n  const membership = await getMembershipForUserInTenant(userId, tenantId);\n\n  if (!membership || membership.status !== 'APPROVED') {\n    return false;\n  }\n\n  return membership.roles.some(roleInfo => requiredRoles.includes(roleInfo.role));\n}\n\n/**\n * Checks if a user can view a certain type of content (e.g., posts, events).\n * It checks tenant settings for public visibility and feature enablement.\n *\n * @param userId The ID of the user attempting to view. Can be null for anonymous users.\n * @param tenantId The ID of the tenant where the content resides.\n * @param contentType The key for the content type in tenant settings (e.g., 'posts', 'calendar').\n * @returns {Promise<boolean>} True if the user can view the content.\n */\nexport async function canUserViewContent(userId: string | null, tenantId: string, contentType: 'posts' | 'calendar' | 'sermons' | 'podcasts' | 'books' | 'prayerWall'): Promise<boolean> {\n    try {\n        const tenant = await prisma.tenant.findUnique({\n            where: { id: tenantId },\n            include: { settings: true }\n        });\n\n        if (!tenant || !tenant.settings) {\n            return false;\n        }\n\n        const settings = tenant.settings as any;\n\n        // Check if the entire feature is disabled\n        const featureFlag = `enable${contentType.charAt(0).toUpperCase() + contentType.slice(1)}`;\n        if (!settings[featureFlag]) {\n            return false;\n        }\n\n        const membership = userId ? await getMembershipForUserInTenant(userId, tenantId) : null;\n\n        // If user is not a member, check public visibility settings\n        if (!membership || membership.status !== 'APPROVED') {\n            // Check if visitorVisibility exists and has the content type property\n            if (!settings.visitorVisibility || typeof settings.visitorVisibility !== 'object') {\n                return false;\n            }\n            const result = settings.visitorVisibility[contentType] === true;\n            return result;\n        }\n\n        // If they are an approved member, they can view it as long as the feature is enabled.\n        return true;\n    } catch (error) {\n        console.error('[canUserViewContent] Error:', error);\n        throw error;\n    }\n}\n\n/**\n * Checks if a user has permission to create a post in a tenant.\n *\n * @param userId The ID of the user.\n * @param tenantId The ID of the tenant.\n * @param isAnnouncement Whether the post is an announcement.\n * @returns {Promise<boolean>} True if the user can create the post.\n */\nexport async function canUserPost(userId: string, tenantId: string, isAnnouncement: boolean): Promise<boolean> {\n    const user = await prisma.user.findUnique({ where: { id: userId } });\n    const tenant = await prisma.tenant.findUnique({ where: { id: tenantId } });\n\n    if (!user || !tenant) return false;\n\n    if (isAnnouncement) {\n        return can(user, tenant, 'canPostInAnnouncementChannels');\n    }\n    return can(user, tenant, 'canCreatePosts');\n}\n\n\n/**\n * Checks if a user can delete a specific message.\n */\nexport async function canDeleteMessage(\n  user: User,\n  message: ChatMessage,\n  conversation: Conversation,\n  tenant: Tenant\n): Promise<boolean> {\n  if (user.isSuperAdmin) {\n    return true;\n  }\n  // User can delete their own message\n  if (message.userId === user.id) {\n    return true;\n  }\n  // Check for moderation permissions\n  if (!conversation.isDirectMessage) { // isGroupChat\n    if (await can(user, tenant, 'canModerateChats')) {\n      return true;\n    }\n  }\n  return false;\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1222, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/messages/MessageStream.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport type { User, EnrichedConversation, EnrichedChatMessage, Tenant } from '@/types';\nimport { getMessagesForConversation, addMessage, markConversationAsRead, deleteMessage } from '@/lib/data';\nimport Button from '../ui/Button';\nimport { can, canDeleteMessage } from '@/lib/permissions';\n\ninterface MessageStreamProps {\n  currentUser: User;\n  conversation: EnrichedConversation;\n  onViewProfile: (userId: string) => void;\n  tenant?: Tenant;\n  isDetailsPanelOpen: boolean;\n  onToggleDetailsPanel: () => void;\n  onMarkAsRead: () => void;\n}\n\nconst MessageStream: React.FC<MessageStreamProps> = ({ currentUser, conversation, onViewProfile, tenant, isDetailsPanelOpen, onToggleDetailsPanel, onMarkAsRead }) => {\n  const [messages, setMessages] = useState<EnrichedChatMessage[]>(() =>\n    getMessagesForConversation(conversation.id, tenant?.id)\n  );\n  const [newMessage, setNewMessage] = useState('');\n  const [showActionsFor, setShowActionsFor] = useState<string | null>(null);\n  const messagesEndRef = useRef<HTMLDivElement | null>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    setMessages(getMessagesForConversation(conversation.id, tenant?.id));\n    markConversationAsRead(currentUser.id, conversation.id);\n    onMarkAsRead();\n  }, [conversation.id, currentUser.id, onMarkAsRead, tenant?.id]);\n  \n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n  \n  const canSendMessage = useMemo(() => {\n    if (conversation.isDirect) {\n      return true;\n    }\n    if (tenant && conversation.name?.toLowerCase() === '#announcements') {\n      return can(currentUser, tenant, 'canPostInAnnouncementChannels');\n    }\n    return true;\n  }, [currentUser, conversation, tenant]);\n\n  const handleSendMessage = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (newMessage.trim() === '' || !canSendMessage) return;\n    addMessage(conversation.id, currentUser.id, newMessage.trim());\n    setMessages(getMessagesForConversation(conversation.id, tenant?.id));\n    setNewMessage('');\n    onMarkAsRead();\n  };\n  \n  const handleDeleteMessage = useCallback((messageId: string) => {\n    const success = deleteMessage(messageId, currentUser.id);\n    if (success) {\n      setMessages(currentMessages => currentMessages.filter(m => m.id !== messageId));\n      onMarkAsRead(); // To update last message snippet\n    } else {\n      alert(\"You don't have permission to delete this message.\");\n    }\n  }, [currentUser.id, onMarkAsRead]);\n\n  const otherParticipant = conversation.isDirect ? conversation.participants.find(p => p.id !== currentUser.id) : null;\n\n  return (\n    <>\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\n         <div className=\"flex items-center space-x-3\">\n             {conversation.isDirect && otherParticipant ? (\n                // FIX: Access avatarUrl and displayName from the nested profile object.\n                <img src={otherParticipant.profile.avatarUrl} alt={otherParticipant.profile.displayName} className=\"w-10 h-10 rounded-full\" />\n             ) : (\n                <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 text-xl\">#</div>\n             )}\n             <div>\n                <h2 className=\"text-lg font-bold text-gray-900\">{conversation.displayName}</h2>\n             </div>\n         </div>\n         {!conversation.isDirect && (\n            <button onClick={onToggleDetailsPanel} className={`p-2 rounded-md transition-colors lg:hidden ${isDetailsPanelOpen ? 'bg-amber-100 text-amber-700' : 'text-gray-400 hover:bg-gray-100 hover:text-gray-600'}`}>\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n            </button>\n         )}\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"flex-1 p-6 overflow-y-auto space-y-2\">\n        {messages.map((msg) => {\n           const userCanDelete = canDeleteMessage(currentUser, msg, conversation, tenant);\n           const isOwnMessage = msg.userId === currentUser.id;\n           return (\n            <div\n              key={msg.id}\n              className={`flex items-start gap-3 group relative ${\n                isOwnMessage ? 'justify-end' : 'justify-start'\n              }`}\n              onMouseEnter={() => setShowActionsFor(msg.id)}\n              onMouseLeave={() => setShowActionsFor(null)}\n            >\n              {!isOwnMessage && (\n                <img\n                  src={msg.userAvatarUrl}\n                  alt={msg.userDisplayName}\n                  className=\"w-8 h-8 rounded-full cursor-pointer\"\n                  onClick={() => onViewProfile(msg.userId)}\n                />\n              )}\n              <div className=\"flex flex-col\">\n                <div\n                  className={`max-w-md p-3 rounded-lg ${\n                    isOwnMessage ? 'bg-amber-500 text-white' : 'bg-gray-100 text-gray-800'\n                  }`}\n                >\n                  {!isOwnMessage && (\n                    <p \n                        className=\"text-xs font-bold mb-1 text-amber-700 cursor-pointer\"\n                        onClick={() => onViewProfile(msg.userId)}\n                    >\n                        {msg.userDisplayName}\n                    </p>\n                  )}\n                  <p className=\"text-sm\" style={{ whiteSpace: 'pre-wrap' }}>{msg.text}</p>\n                </div>\n                <p className={`text-xs mt-1 ${isOwnMessage ? 'text-gray-400 self-end' : 'text-gray-400'}`}>\n                  {msg.createdAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                </p>\n              </div>\n              {showActionsFor === msg.id && userCanDelete && (\n                <div className={`absolute top-0 ${isOwnMessage ? 'left-0 -translate-x-full pr-2' : 'right-0 translate-x-full pl-2'}`}>\n                  <div className=\"bg-white rounded-md shadow-lg border border-gray-200\">\n                    <button\n                      onClick={() => handleDeleteMessage(msg.id)}\n                      className=\"flex items-center space-x-2 w-full text-left px-3 py-1.5 text-xs text-red-600 hover:bg-red-50\"\n                    >\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z\" clipRule=\"evenodd\" />\n                      </svg>\n                      <span>Delete</span>\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n           );\n        })}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input Area */}\n      <div className=\"p-4 border-t border-gray-200 bg-gray-50\">\n        {canSendMessage ? (\n          <form onSubmit={handleSendMessage} className=\"flex items-center space-x-4\">\n            <input\n              type=\"text\"\n              placeholder={`Message ${conversation.displayName}...`}\n              aria-label=\"Chat message input\"\n              value={newMessage}\n              onChange={(e) => setNewMessage(e.target.value)}\n              className=\"flex-1 w-full px-4 py-2 border border-gray-300 rounded-full shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400\"\n            />\n            <Button type=\"submit\">Send</Button>\n          </form>\n        ) : (\n            <div className=\"text-center text-sm text-gray-500 italic px-4 py-2 bg-gray-100 rounded-full\">\n                You do not have permission to post in this channel.\n            </div>\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default MessageStream;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1568, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/ui/Modal.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect } from 'react';\n\ninterface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title: string;\n  children: React.ReactNode;\n}\n\nconst Modal: React.FC<ModalProps> = ({ isOpen, onClose, title, children }) => {\n  useEffect(() => {\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n    document.addEventListener('keydown', handleEscape);\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n    };\n  }, [onClose]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-start overflow-y-auto p-4 sm:p-10\"\n      aria-labelledby=\"modal-title\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white rounded-lg shadow-xl max-w-lg w-full overflow-hidden\"\n        onClick={(e) => e.stopPropagation()} // Prevent clicks inside the modal from closing it\n      >\n        <div className=\"flex justify-between items-center p-4 border-b border-gray-200\">\n          <h2 id=\"modal-title\" className=\"text-lg font-semibold text-gray-900\">\n            {title}\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600\"\n            aria-label=\"Close modal\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n        <div className=\"p-6\">\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Modal;"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAWA,MAAM,QAA8B,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE;IACvE,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe,CAAC;YACpB,IAAI,MAAM,GAAG,KAAK,UAAU;gBAC1B;YACF;QACF;QACA,SAAS,gBAAgB,CAAC,WAAW;QACrC,OAAO;YACL,SAAS,mBAAmB,CAAC,WAAW;QAC1C;IACF,GAAG;QAAC;KAAQ;IAEZ,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QACC,WAAU;QACV,mBAAgB;QAChB,MAAK;QACL,cAAW;QACX,SAAS;kBAET,cAAA,8OAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAEjC,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,IAAG;4BAAc,WAAU;sCAC5B;;;;;;sCAEH,8OAAC;4BACC,SAAS;4BACT,WAAU;4BACV,cAAW;sCAEX,cAAA,8OAAC;gCAAI,OAAM;gCAA6B,WAAU;gCAAU,MAAK;gCAAO,SAAQ;gCAAY,QAAO;0CACjG,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;8BAI3E,8OAAC;oBAAI,WAAU;8BACZ;;;;;;;;;;;;;;;;;AAKX;uCAEe"}},
    {"offset": {"line": 1675, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/ui/ToggleSwitch.tsx"],"sourcesContent":["\nimport React from 'react';\n\ninterface ToggleSwitchProps {\n  label: string;\n  enabled: boolean;\n  onChange: (enabled: boolean) => void;\n  description?: string;\n}\n\nconst ToggleSwitch: React.FC<ToggleSwitchProps> = ({ label, enabled, onChange, description }) => {\n  return (\n    <div className=\"flex items-center justify-between\">\n      <span className=\"flex-grow flex flex-col\">\n        <span className=\"text-sm font-medium text-gray-900\">{label}</span>\n        {description && <span className=\"text-sm text-gray-500\">{description}</span>}\n      </span>\n      <button\n        type=\"button\"\n        className={`${\n          enabled ? 'bg-amber-600' : 'bg-gray-200'\n        } relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500`}\n        role=\"switch\"\n        aria-checked={enabled}\n        onClick={() => onChange(!enabled)}\n      >\n        <span\n          aria-hidden=\"true\"\n          className={`${\n            enabled ? 'translate-x-5' : 'translate-x-0'\n          } pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200`}\n        />\n      </button>\n    </div>\n  );\n};\n\nexport default ToggleSwitch;\n"],"names":[],"mappings":";;;;;;AAUA,MAAM,eAA4C,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE;IAC1F,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAK,WAAU;;kCACd,8OAAC;wBAAK,WAAU;kCAAqC;;;;;;oBACpD,6BAAe,8OAAC;wBAAK,WAAU;kCAAyB;;;;;;;;;;;;0BAE3D,8OAAC;gBACC,MAAK;gBACL,WAAW,GACT,UAAU,iBAAiB,cAC5B,wNAAwN,CAAC;gBAC1N,MAAK;gBACL,gBAAc;gBACd,SAAS,IAAM,SAAS,CAAC;0BAEzB,cAAA,8OAAC;oBACC,eAAY;oBACZ,WAAW,GACT,UAAU,kBAAkB,gBAC7B,2HAA2H,CAAC;;;;;;;;;;;;;;;;;AAKvI;uCAEe"}},
    {"offset": {"line": 1741, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/messages/CreateChannelForm.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useMemo } from 'react';\nimport type { Tenant, User } from '@/types';\nimport { getMembersForTenant } from '@/lib/data';\nimport Input from '../ui/Input';\nimport Button from '../ui/Button';\nimport ToggleSwitch from '../ui/ToggleSwitch';\n\ninterface CreateChannelFormProps {\n  tenant: Tenant;\n  currentUser: User;\n  onSubmit: (data: { name: string; isPrivate: boolean; participantIds: string[] }) => void;\n  onCancel: () => void;\n}\n\nconst CreateChannelForm: React.FC<CreateChannelFormProps> = ({ tenant, currentUser, onSubmit, onCancel }) => {\n  const [name, setName] = useState('');\n  const [isPrivate, setIsPrivate] = useState(false);\n  const [selectedParticipants, setSelectedParticipants] = useState<Set<string>>(() => new Set([currentUser.id]));\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const members = useMemo(() => getMembersForTenant(tenant.id), [tenant.id]);\n\n  const handleParticipantToggle = (userId: string) => {\n    if (userId === currentUser.id) return; // Current user cannot be deselected\n    setSelectedParticipants(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(userId)) {\n        newSet.delete(userId);\n      } else {\n        newSet.add(userId);\n      }\n      return newSet;\n    });\n  };\n  \n  const filteredMembers = useMemo(() => {\n    if (!searchTerm) return members;\n    // FIX: Access displayName from the nested profile object.\n    return members.filter(m => m.profile.displayName.toLowerCase().includes(searchTerm.toLowerCase()));\n  }, [members, searchTerm]);\n\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!name.trim()) {\n      alert('Please enter a channel name.');\n      return;\n    }\n    onSubmit({\n      name: name.trim(),\n      isPrivate,\n      participantIds: Array.from(selectedParticipants),\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <Input\n        label=\"Channel Name\"\n        id=\"channel-name\"\n        name=\"name\"\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n        required\n        placeholder=\"# announcements\"\n      />\n      \n      <ToggleSwitch\n        label=\"Private Channel\"\n        description=\"If enabled, only selected members can see and join this channel.\"\n        enabled={isPrivate}\n        onChange={setIsPrivate}\n      />\n\n      {isPrivate && (\n        <div className=\"space-y-4\">\n          <h3 className=\"text-sm font-medium text-gray-900\">Select Members</h3>\n          <Input\n            label=\"\"\n            id=\"member-search\"\n            placeholder=\"Search members to add...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n          <div className=\"max-h-60 overflow-y-auto border border-gray-200 rounded-md p-2 space-y-2\">\n            {filteredMembers.map(member => (\n              <div key={member.id} className=\"flex items-center justify-between p-2 rounded hover:bg-gray-50\">\n                <div className=\"flex items-center space-x-3\">\n                  {/* FIX: Access avatarUrl and displayName from the nested profile object. */}\n                  <img src={member.profile.avatarUrl} alt={member.profile.displayName} className=\"w-8 h-8 rounded-full\" />\n                  <span className=\"text-sm text-gray-800\">{member.profile.displayName}</span>\n                </div>\n                <input\n                  type=\"checkbox\"\n                  className=\"h-4 w-4 text-amber-600 border-gray-300 rounded focus:ring-amber-500\"\n                  checked={selectedParticipants.has(member.id)}\n                  onChange={() => handleParticipantToggle(member.id)}\n                  disabled={member.id === currentUser.id}\n                />\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      <div className=\"flex justify-end items-center space-x-4 pt-4 border-t border-gray-200\">\n        <Button type=\"button\" variant=\"secondary\" onClick={onCancel}>\n          Cancel\n        </Button>\n        <Button type=\"submit\">\n          Create Channel\n        </Button>\n      </div>\n    </form>\n  );\n};\n\nexport default CreateChannelForm;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1947, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/types.ts"],"sourcesContent":["// --- ENUMS ---\n\nexport enum TenantRole {\n  MEMBER = 'MEMBER',\n  STAFF = 'STAFF',\n  CLERGY = 'CLERGY',\n  MODERATOR = 'MODERATOR',\n  ADMIN = 'ADMIN',\n}\n\n// Role types for permission mapping\nexport enum TenantRoleType {\n  MEMBER = 'MEMBER',\n  STAFF = 'STAFF',\n  MODERATOR = 'MODERATOR',\n}\n\nexport enum MembershipStatus {\n  REQUESTED = 'REQUESTED',\n  APPROVED = 'APPROVED',\n  REJECTED = 'REJECTED',\n  BANNED = 'BANNED',\n}\n\nexport enum MembershipApprovalMode {\n  OPEN = 'OPEN',\n  APPROVAL_REQUIRED = 'APPROVAL_REQUIRED',\n}\n\nexport enum VolunteerStatus {\n  CONFIRMED = 'CONFIRMED',\n  CANCELED = 'CANCELED',\n}\n\nexport enum SmallGroupRole {\n  LEADER = 'LEADER',\n  MEMBER = 'MEMBER',\n}\n\nexport enum CommunityPostType {\n    PRAYER_REQUEST = 'PRAYER_REQUEST',\n    TANGIBLE_NEED = 'TANGIBLE_NEED',\n}\n\nexport enum CommunityPostStatus {\n    PENDING_APPROVAL = 'PENDING_APPROVAL',\n    PUBLISHED = 'PUBLISHED',\n    FULFILLED = 'FULFILLED',\n}\n\nexport enum ResourceVisibility {\n    PUBLIC = 'PUBLIC',\n    MEMBERS_ONLY = 'MEMBERS_ONLY',\n}\n\nexport enum FileType {\n    PDF = 'PDF',\n    DOCX = 'DOCX',\n    MP3 = 'MP3',\n    JPG = 'JPG',\n    PNG = 'PNG',\n    OTHER = 'OTHER',\n}\n\nexport enum ContactSubmissionStatus {\n    UNREAD = 'UNREAD',\n    READ = 'READ',\n    ARCHIVED = 'ARCHIVED',\n}\n\n\n// --- USER-RELATED MODELS ---\nexport interface NotificationPreferences {\n  email: {\n    newAnnouncement: boolean;\n    newEvent: boolean;\n    directMessage: boolean;\n    groupChatMessage: boolean;\n    membershipUpdate: boolean;\n  };\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  password?: string; // NOTE: For mock login simulation.\n  isSuperAdmin: boolean;\n  profile: UserProfile;\n  privacySettings: UserPrivacySettings;\n  accountSettings: AccountSettings;\n  notificationPreferences: NotificationPreferences;\n}\n\nexport interface UserProfile {\n  displayName: string;\n  avatarUrl?: string;\n  bio?: string;\n  locationCity?: string;\n  locationCountry?: string;\n  languages?: string[];\n}\n\nexport interface UserPrivacySettings {\n  showAffiliations: boolean;\n}\n\nexport interface AccountSettings {\n  timezonePreference?: string;\n  dateFormat?: string;\n  timeFormat?: string;\n  languagePreference?: string;\n}\n\n\n// --- TENANT-RELATED MODELS ---\n\nexport interface Tenant {\n  id: string;\n  name: string;\n  slug: string;\n  creed: string;\n  address: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    postalCode: string;\n  };\n  contactEmail?: string;\n  phoneNumber?: string;\n  description: string;\n  settings: TenantSettings;\n  branding: TenantBranding;\n  permissions: TenantFeaturePermissions;\n}\n\nexport interface TenantBranding {\n  logoUrl: string;\n  bannerImageUrl: string;\n  primaryColor: string;\n  accentColor: string;\n  customLinks: Array<{ label: string; url: string }>;\n}\n\nexport interface LiveStreamSettings {\n  provider: 'YOUTUBE' | 'FACEBOOK' | 'VIMEO' | 'OTHER';\n  embedUrl: string;\n  isLive: boolean; // Manual toggle by admin\n}\n\nexport interface TenantSettings {\n  isPublic: boolean;\n  membershipApprovalMode: MembershipApprovalMode;\n  // Features\n  enableCalendar: boolean;\n  enablePosts: boolean;\n  enableSermons: boolean;\n  enablePodcasts: boolean;\n  enableBooks: boolean;\n  enableMemberDirectory: boolean;\n  enableGroupChat: boolean;\n  enableComments: boolean;\n  enableReactions: boolean;\n  enableDonations: boolean;\n  enableVolunteering: boolean;\n  enableSmallGroups: boolean;\n  enableLiveStream: boolean;\n  enablePrayerWall: boolean;\n  enableResourceCenter: boolean;\n  donationSettings: DonationSettings;\n  liveStreamSettings: LiveStreamSettings;\n  // Visibility (simplified for mock)\n  visitorVisibility: {\n    calendar: boolean;\n    posts: boolean;\n    sermons: boolean;\n    podcasts: boolean;\n    books: boolean;\n    prayerWall: boolean;\n  };\n}\n\n\nexport interface RolePermissions {\n  canCreatePosts: boolean;\n  canCreateEvents: boolean;\n  canCreateSermons: boolean;\n  canCreatePodcasts: boolean;\n  canCreateBooks: boolean;\n  canCreateGroupChats: boolean;\n  canInviteMembers: boolean;\n  canApproveMembership: boolean;\n  canBanMembers: boolean;\n  canModeratePosts: boolean;\n  canModerateChats: boolean;\n  canPostInAnnouncementChannels?: boolean;\n  canManagePrayerWall: boolean;\n  canUploadResources: boolean;\n  canManageResources: boolean;\n  canManageContactSubmissions: boolean;\n}\n\n// Sticking with a map for easier frontend access\nexport type TenantFeaturePermissions = {\n  [key in TenantRoleType]?: RolePermissions;\n} & { ADMIN: RolePermissions };\n\n\nexport interface UserTenantMembership {\n  id: string;\n  userId: string;\n  tenantId: string;\n  status: MembershipStatus;\n  roles: UserTenantRole[];\n  displayName?: string; // Tenant-specific display name override\n}\n\nexport interface UserTenantRole {\n    id: string;\n    role: TenantRole;\n    displayTitle?: string;\n    isPrimary: boolean;\n}\n\n// Enriched type for displaying members in the UI\nexport interface EnrichedMember extends User {\n  membership: UserTenantMembership;\n}\n\n\n// --- CONTENT & MESSAGING (Largely Unchanged) ---\n\nexport interface Post {\n  id: string;\n  tenantId: string;\n  authorUserId: string;\n  type: 'BLOG' | 'ANNOUNCEMENT' | 'BOOK';\n  title: string;\n  body: string;\n  isPublished: boolean;\n  publishedAt: Date;\n}\nexport interface PostInput {\n  title: string;\n  body: string;\n  type: 'BLOG' | 'ANNOUNCEMENT' | 'BOOK';\n  isPublished: boolean;\n}\nexport interface PostWithAuthor extends Post {\n    authorDisplayName: string;\n    authorAvatarUrl?: string;\n}\n\nexport interface Event {\n  id:string;\n  tenantId: string;\n  createdByUserId: string;\n  title: string;\n  description: string;\n  startDateTime: Date;\n  endDateTime: Date;\n  locationText: string;\n  isOnline: boolean;\n  onlineUrl?: string;\n}\nexport interface EventWithCreator extends Event {\n    creatorDisplayName: string;\n    creatorAvatarUrl?: string;\n}\n\nexport interface MediaItem {\n  id: string;\n  tenantId: string;\n  authorUserId: string;\n  type: 'SERMON_VIDEO' | 'PODCAST_AUDIO';\n  title: string;\n  description: string;\n  embedUrl: string;\n  publishedAt: Date;\n}\nexport interface EnrichedMediaItem extends MediaItem {\n    authorDisplayName: string;\n    authorAvatarUrl?: string;\n}\n\nexport interface ChatMessage {\n  id: string;\n  conversationId: string;\n  userId: string;\n  text: string;\n  createdAt: Date;\n  isDeleted?: boolean;\n}\n\nexport interface EnrichedChatMessage extends ChatMessage {\n  userDisplayName: string;\n  userAvatarUrl?: string;\n}\n\nexport interface Conversation {\n  id: string;\n  isDirect: boolean;\n  tenantId: string | null;\n  isPrivateGroup: boolean;\n  name?: string; // For group channels\n  description?: string; // Description for channels\n  createdByUserId: string;\n  isDefaultChannel: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport interface ConversationParticipant {\n  id: string;\n  conversationId: string;\n  userId: string;\n  lastReadMessageId?: string | null;\n}\n\nexport interface EnrichedConversation extends Conversation {\n    participants: User[];\n    unreadCount: number;\n    lastMessage?: EnrichedChatMessage;\n    displayName: string;\n}\n\n\n// --- ADMIN & AUDIT TYPES ---\n\nexport enum ActionType {\n  IMPERSONATE_START = 'IMPERSONATE_START',\n  IMPERSONATE_END = 'IMPERSONATE_END',\n  CREATE_POST = 'CREATE_POST',\n  DELETE_POST = 'DELETE_POST',\n  BAN_USER = 'BAN_USER',\n  UNBAN_USER = 'UNBAN_USER',\n  DELETE_MESSAGE = 'DELETE_MESSAGE',\n  USER_JOINED_TENANT = 'USER_JOINED_TENANT',\n  MEMBERSHIP_STATUS_UPDATED = 'MEMBERSHIP_STATUS_UPDATED',\n  MEMBER_ROLES_UPDATED = 'MEMBER_ROLES_UPDATED',\n  MEMBERSHIP_PROFILE_UPDATED = 'MEMBERSHIP_PROFILE_UPDATED',\n  USER_REGISTERED = 'USER_REGISTERED',\n  USER_PROFILE_UPDATED = 'USER_PROFILE_UPDATED',\n  ADMIN_UPDATED_USER_PROFILE = 'ADMIN_UPDATED_USER_PROFILE',\n  TENANT_PERMISSIONS_UPDATED = 'TENANT_PERMISSIONS_UPDATED',\n}\n\nexport interface AuditLog {\n  id: string;\n  actorUserId: string;\n  effectiveUserId?: string;\n  actionType: ActionType;\n  entityType?: string;\n  entityId?: string;\n  metadata?: Record<string, any>;\n  createdAt: Date;\n}\n\n// --- NOTIFICATION MODELS ---\nexport type NotificationType =\n  | 'NEW_DIRECT_MESSAGE'\n  | 'NEW_ANNOUNCEMENT'\n  | 'MEMBERSHIP_APPROVED'\n  | 'NEW_CONTACT_SUBMISSION';\n\nexport interface Notification {\n  id: string;\n  userId: string; // The recipient\n  actorUserId?: string; // The user who caused the notification\n  type: NotificationType;\n  message: string;\n  link?: string; // e.g., messages, tenant/tenant-1\n  isRead: boolean;\n  createdAt: Date;\n}\n\n// --- DONATION MODELS ---\nexport interface DonationSettings {\n  mode: 'EXTERNAL' | 'INTEGRATED';\n  externalUrl?: string;\n  integratedProvider?: 'STRIPE' | 'PAYPAL';\n  currency: string;\n  suggestedAmounts: number[];\n  allowCustomAmounts: boolean;\n  leaderboardEnabled: boolean;\n  leaderboardVisibility: 'PUBLIC' | 'MEMBERS_ONLY';\n  leaderboardTimeframe: 'ALL_TIME' | 'YEARLY' | 'MONTHLY';\n}\n\nexport interface DonationRecord {\n  id: string;\n  tenantId: string;\n  userId: string | null; // null for anonymous from public page\n  displayName: string; // denormalized for anonymous/guest donations\n  amount: number;\n  currency: string;\n  donatedAt: Date;\n  isAnonymousOnLeaderboard: boolean;\n  message?: string;\n}\n\nexport interface EnrichedDonationRecord extends DonationRecord {\n    userAvatarUrl?: string;\n}\n\n// --- VOLUNTEER MODELS ---\nexport interface VolunteerNeed {\n  id: string;\n  tenantId: string;\n  eventId?: string; // Optional link to an Event\n  title: string;\n  description: string;\n  date: Date;\n  slotsNeeded: number;\n}\n\nexport interface VolunteerSignup {\n  id: string;\n  needId: string;\n  userId: string;\n  signedUpAt: Date;\n  status: VolunteerStatus;\n}\n\n// Enriched types for UI\nexport interface EnrichedSignup {\n  signup: VolunteerSignup;\n  user: User;\n}\n\nexport interface EnrichedVolunteerNeed extends VolunteerNeed {\n  signups: EnrichedSignup[];\n}\n\n// --- SMALL GROUP MODELS ---\nexport interface SmallGroup {\n  id: string;\n  tenantId: string;\n  name: string;\n  description: string;\n  leaderUserId: string;\n  meetingSchedule: string; // e.g., \"Tuesdays at 7 PM\"\n  isActive: boolean;\n}\n\nexport interface SmallGroupMembership {\n  id: string;\n  groupId: string;\n  userId: string;\n  role: SmallGroupRole;\n  joinedAt: Date;\n}\n\n// Enriched types for UI\nexport interface EnrichedGroupMember {\n    membership: SmallGroupMembership;\n    user: User;\n}\n\nexport interface EnrichedSmallGroup extends SmallGroup {\n    leader: User;\n    members: EnrichedGroupMember[];\n}\n\n// --- COMMUNITY BOARD / PRAYER WALL MODELS ---\nexport interface CommunityPost {\n    id: string;\n    tenantId: string;\n    authorUserId: string | null; // Null for anonymous\n    type: CommunityPostType;\n    body: string;\n    isAnonymous: boolean;\n    status: CommunityPostStatus;\n    createdAt: Date;\n}\n\nexport interface EnrichedCommunityPost extends CommunityPost {\n    authorDisplayName: string;\n    authorAvatarUrl?: string;\n}\n\n// --- RESOURCE CENTER MODELS ---\nexport interface ResourceItem {\n    id: string;\n    tenantId: string;\n    uploaderUserId: string;\n    title: string;\n    description: string;\n    fileUrl: string; // For mock, this is just a string. In real app, it would be a URL to a file.\n    fileType: FileType;\n    visibility: ResourceVisibility;\n    createdAt: Date;\n}\n\nexport interface EnrichedResourceItem extends ResourceItem {\n    uploaderDisplayName: string;\n    uploaderAvatarUrl?: string;\n}\n\n// --- CONTACT & SUBMISSIONS ---\nexport interface ContactSubmission {\n    id: string;\n    tenantId: string;\n    name: string;\n    email: string;\n    message: string;\n    status: ContactSubmissionStatus;\n    createdAt: Date;\n}"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;AAET,IAAA,AAAK,oCAAA;;;;;;WAAA;;AASL,IAAA,AAAK,wCAAA;;;;WAAA;;AAML,IAAA,AAAK,0CAAA;;;;;WAAA;;AAOL,IAAA,AAAK,gDAAA;;;WAAA;;AAKL,IAAA,AAAK,yCAAA;;;WAAA;;AAKL,IAAA,AAAK,wCAAA;;;WAAA;;AAKL,IAAA,AAAK,2CAAA;;;WAAA;;AAKL,IAAA,AAAK,6CAAA;;;;WAAA;;AAML,IAAA,AAAK,4CAAA;;;WAAA;;AAKL,IAAA,AAAK,kCAAA;;;;;;;WAAA;;AASL,IAAA,AAAK,iDAAA;;;;WAAA;;AAyQL,IAAA,AAAK,oCAAA;;;;;;;;;;;;;;;;WAAA"}},
    {"offset": {"line": 2063, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/messages/ConversationDetailsPanel.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\n// FIX: Changed 'import type' for TenantRole to a value import.\nimport { TenantRole, type EnrichedConversation, type Tenant, type User, type UserTenantMembership } from '@/types';\nimport { getMembershipForUserInTenant } from '@/lib/data';\n\ninterface ConversationDetailsPanelProps {\n  conversation: EnrichedConversation;\n  tenant: Tenant;\n  onViewProfile: (userId: string) => void;\n}\n\ninterface EnrichedParticipant extends User {\n  roles: TenantRole[];\n  membership: UserTenantMembership;\n}\n\nconst ConversationDetailsPanel: React.FC<ConversationDetailsPanelProps> = ({ conversation, tenant, onViewProfile }) => {\n  const enrichedParticipants = useMemo((): EnrichedParticipant[] => {\n    return conversation.participants.map(p => {\n        const membership = getMembershipForUserInTenant(p.id, tenant.id);\n        if (!membership) return null; // Should not happen for channel members\n        return {\n            ...p,\n            roles: membership.roles.map(r => r.role),\n            membership,\n        }\n    }).filter((p): p is EnrichedParticipant => p !== null)\n    .sort((a,b) => {\n        const roleOrder = { [TenantRole.ADMIN]: 0, [TenantRole.STAFF]: 1, [TenantRole.CLERGY]: 1, [TenantRole.MODERATOR]: 2, [TenantRole.MEMBER]: 3 };\n        const aRole = a.roles[0] || TenantRole.MEMBER;\n        const bRole = b.roles[0] || TenantRole.MEMBER;\n        if (roleOrder[aRole] < roleOrder[bRole]) return -1;\n        if (roleOrder[aRole] > roleOrder[bRole]) return 1;\n        return a.profile.displayName.localeCompare(b.profile.displayName);\n    });\n  }, [conversation.participants, tenant.id]);\n\n  const roleColors: { [key: string]: string } = {\n    ADMIN: 'bg-red-100 text-red-800',\n    STAFF: 'bg-sky-100 text-sky-800',\n    CLERGY: 'bg-emerald-100 text-emerald-800',\n    MODERATOR: 'bg-indigo-100 text-indigo-800',\n    MEMBER: 'bg-gray-100 text-gray-800',\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-white\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200\">\n        <h3 className=\"font-bold text-lg text-gray-900\">{conversation.displayName}</h3>\n        {conversation.description && (\n          <p className=\"text-sm text-gray-500 mt-1\">{conversation.description}</p>\n        )}\n      </div>\n\n      {/* Members List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"p-4\">\n          <h4 className=\"text-xs font-bold uppercase text-gray-500\">\n            Members &mdash; {enrichedParticipants.length}\n          </h4>\n        </div>\n        <ul>\n          {enrichedParticipants.map(participant => (\n            <li \n              key={participant.id} \n              className=\"px-4 py-2 hover:bg-gray-50 cursor-pointer\"\n              onClick={() => onViewProfile(participant.id)}\n            >\n              <div className=\"flex items-center space-x-3\">\n                <img src={participant.profile.avatarUrl} alt={participant.profile.displayName} className=\"w-8 h-8 rounded-full\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-gray-800\">{participant.membership.displayName || participant.profile.displayName}</p>\n                  <div className=\"flex flex-wrap gap-1 mt-0.5\">\n                    {participant.roles.map(role => (\n                       <span key={role} className={`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${roleColors[role] || 'bg-gray-100 text-gray-800'}`}>\n                         {role}\n                       </span>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default ConversationDetailsPanel;"],"names":[],"mappings":";;;;;AAAA;AACA,+DAA+D;AAC/D;AACA;;;;;AAaA,MAAM,2BAAoE,CAAC,EAAE,YAAY,EAAE,MAAM,EAAE,aAAa,EAAE;IAChH,MAAM,uBAAuB,IAAA,gNAAO,EAAC;QACnC,OAAO,aAAa,YAAY,CAAC,GAAG,CAAC,CAAA;YACjC,MAAM,aAAa,IAAA,2IAA4B,EAAC,EAAE,EAAE,EAAE,OAAO,EAAE;YAC/D,IAAI,CAAC,YAAY,OAAO,MAAM,wCAAwC;YACtE,OAAO;gBACH,GAAG,CAAC;gBACJ,OAAO,WAAW,KAAK,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;gBACvC;YACJ;QACJ,GAAG,MAAM,CAAC,CAAC,IAAgC,MAAM,MAChD,IAAI,CAAC,CAAC,GAAE;YACL,MAAM,YAAY;gBAAE,CAAC,mHAAU,CAAC,KAAK,CAAC,EAAE;gBAAG,CAAC,mHAAU,CAAC,KAAK,CAAC,EAAE;gBAAG,CAAC,mHAAU,CAAC,MAAM,CAAC,EAAE;gBAAG,CAAC,mHAAU,CAAC,SAAS,CAAC,EAAE;gBAAG,CAAC,mHAAU,CAAC,MAAM,CAAC,EAAE;YAAE;YAC5I,MAAM,QAAQ,EAAE,KAAK,CAAC,EAAE,IAAI,mHAAU,CAAC,MAAM;YAC7C,MAAM,QAAQ,EAAE,KAAK,CAAC,EAAE,IAAI,mHAAU,CAAC,MAAM;YAC7C,IAAI,SAAS,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,EAAE,OAAO,CAAC;YACjD,IAAI,SAAS,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,EAAE,OAAO;YAChD,OAAO,EAAE,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,EAAE,OAAO,CAAC,WAAW;QACpE;IACF,GAAG;QAAC,aAAa,YAAY;QAAE,OAAO,EAAE;KAAC;IAEzC,MAAM,aAAwC;QAC5C,OAAO;QACP,OAAO;QACP,QAAQ;QACR,WAAW;QACX,QAAQ;IACV;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmC,aAAa,WAAW;;;;;;oBACxE,aAAa,WAAW,kBACvB,8OAAC;wBAAE,WAAU;kCAA8B,aAAa,WAAW;;;;;;;;;;;;0BAKvE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAG,WAAU;;gCAA4C;gCACvC,qBAAqB,MAAM;;;;;;;;;;;;kCAGhD,8OAAC;kCACE,qBAAqB,GAAG,CAAC,CAAA,4BACxB,8OAAC;gCAEC,WAAU;gCACV,SAAS,IAAM,cAAc,YAAY,EAAE;0CAE3C,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,KAAK,YAAY,OAAO,CAAC,SAAS;4CAAE,KAAK,YAAY,OAAO,CAAC,WAAW;4CAAE,WAAU;;;;;;sDACzF,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAE,WAAU;8DAAuC,YAAY,UAAU,CAAC,WAAW,IAAI,YAAY,OAAO,CAAC,WAAW;;;;;;8DACzH,8OAAC;oDAAI,WAAU;8DACZ,YAAY,KAAK,CAAC,GAAG,CAAC,CAAA,qBACpB,8OAAC;4DAAgB,WAAW,CAAC,sEAAsE,EAAE,UAAU,CAAC,KAAK,IAAI,6BAA6B;sEACnJ;2DADQ;;;;;;;;;;;;;;;;;;;;;;+BAVf,YAAY,EAAE;;;;;;;;;;;;;;;;;;;;;;AAuBjC;uCAEe"}},
    {"offset": {"line": 2242, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/Temple4/Temple4/app/components/tenant/ChatPage.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useMemo, useEffect, useCallback } from 'react';\nimport type { Tenant, User, EnrichedConversation } from '@/types';\nimport { getConversationsForUser, createConversation } from '@/lib/data';\nimport ConversationList from '../messages/ConversationList';\nimport MessageStream from '../messages/MessageStream';\nimport { can } from '@/lib/permissions';\nimport Button from '../ui/Button';\nimport Modal from '../ui/Modal';\nimport CreateChannelForm from '../messages/CreateChannelForm';\nimport ConversationDetailsPanel from '../messages/ConversationDetailsPanel';\n\ninterface ChatPageProps {\n  tenant: Tenant;\n  user: User;\n  onViewProfile: (userId: string) => void;\n}\n\nconst ChatPage: React.FC<ChatPageProps> = ({ tenant, user, onViewProfile }) => {\n  const [updateTrigger, setUpdateTrigger] = useState(0);\n  const [isDetailsPanelOpen, setIsDetailsPanelOpen] = useState(true);\n\n  const tenantConversations = useMemo(() => {\n    const all = getConversationsForUser(user.id);\n    return all.filter((c) => c.tenantId === tenant.id);\n  }, [user.id, tenant.id, updateTrigger]);\n\n  const [activeConversation, setActiveConversation] = useState<EnrichedConversation | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [newlyCreatedConvId, setNewlyCreatedConvId] = useState<string | null>(null);\n\n  const canCreate = can(user, tenant, 'canCreateGroupChats');\n\n  useEffect(() => {\n    if (newlyCreatedConvId) {\n      // A new channel was just created\n      const newConv = tenantConversations.find((c) => c.id === newlyCreatedConvId);\n      if (newConv) {\n        setActiveConversation(newConv);\n        setNewlyCreatedConvId(null); // Reset\n      }\n    } else {\n      // Normal behavior: check if active is still valid or pick a default\n      const activeConvStillExists = tenantConversations.some((c) => c.id === activeConversation?.id);\n      if (!activeConvStillExists) {\n        const announcementChannel = tenantConversations.find(c => c.name === '#announcements');\n        const defaultChannel = tenantConversations.find((c) => c.isDefaultChannel);\n        setActiveConversation(announcementChannel || defaultChannel || tenantConversations[0] || null);\n      }\n    }\n  }, [tenantConversations, activeConversation, newlyCreatedConvId]);\n\n  const handleCreateChannel = (data: { name: string; isPrivate: boolean; participantIds: string[] }) => {\n    const newConv = createConversation(tenant.id, user.id, data.name, data.isPrivate, data.participantIds);\n    setIsModalOpen(false);\n    setNewlyCreatedConvId(newConv.id);\n    setUpdateTrigger((c) => c + 1);\n  };\n\n  const handleConversationSelect = useCallback((conversation: EnrichedConversation) => {\n    setActiveConversation(conversation);\n  }, []);\n\n  const forceConversationListUpdate = useCallback(() => {\n    setUpdateTrigger(c => c + 1);\n  }, []);\n\n\n  return (\n    <>\n      <div className=\"flex h-[calc(100vh-170px)] bg-white rounded-lg shadow-sm overflow-hidden\">\n        {/* Left Panel: Conversation List */}\n        <div className=\"w-full sm:w-1/3 md:w-1/4 border-r border-gray-200 flex flex-col\">\n          <div className=\"p-4 border-b border-gray-200 flex justify-between items-center\">\n            <div>\n              <h2 className=\"text-xl font-bold text-gray-900\">Channels</h2>\n              <p className=\"text-sm text-gray-500\">Conversations in {tenant.name}</p>\n            </div>\n            {canCreate && (\n              <Button size=\"sm\" onClick={() => setIsModalOpen(true)}>\n                New\n              </Button>\n            )}\n          </div>\n          <ConversationList\n            conversations={tenantConversations}\n            currentUser={user}\n            activeConversationId={activeConversation?.id}\n            onConversationSelect={handleConversationSelect}\n          />\n        </div>\n\n        {/* Middle Panel: Message Stream */}\n        <div className=\"flex-1 flex flex-col\">\n          {activeConversation ? (\n            <MessageStream\n              key={activeConversation.id} // Re-mount component when conversation changes\n              currentUser={user}\n              conversation={activeConversation}\n              onViewProfile={onViewProfile}\n              tenant={tenant}\n              isDetailsPanelOpen={isDetailsPanelOpen}\n              onToggleDetailsPanel={() => setIsDetailsPanelOpen(!isDetailsPanelOpen)}\n              onMarkAsRead={forceConversationListUpdate}\n            />\n          ) : (\n            <div className=\"flex-1 flex items-center justify-center text-center\">\n              <div>\n                <h3 className=\"text-lg font-medium text-gray-900\">No Channels Available</h3>\n                <p className=\"mt-1 text-sm text-gray-500\">\n                  {canCreate ? 'Create a channel to start chatting.' : 'There are no channels for you in this tenant yet.'}\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Right Panel: Conversation Details */}\n        {isDetailsPanelOpen && activeConversation && (\n            <div className=\"hidden lg:block w-full sm:w-1/3 md:w-1/4 border-l border-gray-200\">\n                <ConversationDetailsPanel \n                    key={activeConversation.id}\n                    conversation={activeConversation}\n                    tenant={tenant}\n                    onViewProfile={onViewProfile}\n                />\n            </div>\n        )}\n\n      </div>\n      <Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} title=\"Create a New Channel\">\n        <CreateChannelForm\n          tenant={tenant}\n          currentUser={user}\n          onSubmit={handleCreateChannel}\n          onCancel={() => setIsModalOpen(false)}\n        />\n      </Modal>\n    </>\n  );\n};\n\nexport default ChatPage;"],"names":[],"mappings":"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"}}]
}