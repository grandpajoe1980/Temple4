module.exports=[29173,(a,b,c)=>{b.exports=a.x("@prisma/client",()=>require("@prisma/client"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},66917,a=>{"use strict";var b=a.i(87924);a.s(["default",0,({children:a,variant:c="primary",size:d="md",className:e,...f})=>(0,b.jsx)("button",{className:`rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${{primary:"bg-amber-600 text-white hover:bg-amber-700 focus:ring-amber-500",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[c]} ${{md:"px-4 py-2 text-sm",sm:"px-3 py-1.5 text-xs"}[d]} ${e}`,...f,children:a})])},63187,a=>{"use strict";var b=a.i(87924);a.s(["default",0,({label:a,id:c,containerClassName:d,...e})=>(0,b.jsxs)("div",{className:d,children:[(0,b.jsx)("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("input",{id:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400",...e})]})])},58020,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.s(["default",0,({isOpen:a,onClose:d,title:e,children:f})=>((0,c.useEffect)(()=>{let a=a=>{"Escape"===a.key&&d()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[d]),a)?(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-start overflow-y-auto p-4 sm:p-10","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",onClick:d,children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full overflow-hidden",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[(0,b.jsx)("h2",{id:"modal-title",className:"text-lg font-semibold text-gray-900",children:e}),(0,b.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600","aria-label":"Close modal",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:"p-6",children:f})]})}):null])},64055,a=>{"use strict";var b,c=a.i(87924),d=a.i(72131),e=a.i(82665),f=a.i(66917),g=a.i(29173),h=a.i(8706);async function i(a,b){return h.prisma.userTenantMembership.findUnique({where:{userId_tenantId:{userId:a,tenantId:b}},include:{roles:{select:{role:!0}}}})}async function j(a,b,c){if(a.isSuperAdmin)return!0;let d=await i(a.id,b.id);if(!d||"APPROVED"!==d.status)return!1;for(let a of d.roles){let d=function(a){switch(a){case g.TenantRole.ADMIN:return"ADMIN";case g.TenantRole.STAFF:case g.TenantRole.CLERGY:return"STAFF";case g.TenantRole.MODERATOR:return"MODERATOR";case g.TenantRole.MEMBER:default:return"MEMBER"}}(a.role),e=b.permissions;if("ADMIN"===d){if(e.ADMIN[c])return!0}else{let a=e[d];if(a&&a[c])return!0}}return!1}async function k(a,b,c,d){return!!(a.isSuperAdmin||b.userId===a.id||!c.isDirectMessage&&await j(a,d,"canModerateChats"))}(b={}).MEMBER="MEMBER",b.STAFF="STAFF",b.MODERATOR="MODERATOR",a.s(["default",0,({currentUser:a,conversation:b,onViewProfile:g,tenant:h,isDetailsPanelOpen:i,onToggleDetailsPanel:l,onMarkAsRead:m})=>{let[n,o]=(0,d.useState)(()=>(0,e.getMessagesForConversation)(b.id,h?.id)),[p,q]=(0,d.useState)(""),[r,s]=(0,d.useState)(null),t=(0,d.useRef)(null);(0,d.useEffect)(()=>{o((0,e.getMessagesForConversation)(b.id,h?.id)),(0,e.markConversationAsRead)(a.id,b.id),m()},[b.id,a.id,m,h?.id]),(0,d.useEffect)(()=>{t.current?.scrollIntoView({behavior:"smooth"})},[n]);let u=(0,d.useMemo)(()=>!!b.isDirect||!h||b.name?.toLowerCase()!=="#announcements"||j(a,h,"canPostInAnnouncementChannels"),[a,b,h]),v=(0,d.useCallback)(b=>{(0,e.deleteMessage)(b,a.id)?(o(a=>a.filter(a=>a.id!==b)),m()):alert("You don't have permission to delete this message.")},[a.id,m]),w=b.isDirect?b.participants.find(b=>b.id!==a.id):null;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[b.isDirect&&w?(0,c.jsx)("img",{src:w.profile.avatarUrl,alt:w.profile.displayName,className:"w-10 h-10 rounded-full"}):(0,c.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 text-xl",children:"#"}),(0,c.jsx)("div",{children:(0,c.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:b.displayName})})]}),!b.isDirect&&(0,c.jsx)("button",{onClick:l,className:`p-2 rounded-md transition-colors lg:hidden ${i?"bg-amber-100 text-amber-700":"text-gray-400 hover:bg-gray-100 hover:text-gray-600"}`,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]}),(0,c.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto space-y-2",children:[n.map(d=>{let e=k(a,d,b,h),f=d.userId===a.id;return(0,c.jsxs)("div",{className:`flex items-start gap-3 group relative ${f?"justify-end":"justify-start"}`,onMouseEnter:()=>s(d.id),onMouseLeave:()=>s(null),children:[!f&&(0,c.jsx)("img",{src:d.userAvatarUrl,alt:d.userDisplayName,className:"w-8 h-8 rounded-full cursor-pointer",onClick:()=>g(d.userId)}),(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsxs)("div",{className:`max-w-md p-3 rounded-lg ${f?"bg-amber-500 text-white":"bg-gray-100 text-gray-800"}`,children:[!f&&(0,c.jsx)("p",{className:"text-xs font-bold mb-1 text-amber-700 cursor-pointer",onClick:()=>g(d.userId),children:d.userDisplayName}),(0,c.jsx)("p",{className:"text-sm",style:{whiteSpace:"pre-wrap"},children:d.text})]}),(0,c.jsx)("p",{className:`text-xs mt-1 ${f?"text-gray-400 self-end":"text-gray-400"}`,children:d.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),r===d.id&&e&&(0,c.jsx)("div",{className:`absolute top-0 ${f?"left-0 -translate-x-full pr-2":"right-0 translate-x-full pl-2"}`,children:(0,c.jsx)("div",{className:"bg-white rounded-md shadow-lg border border-gray-200",children:(0,c.jsxs)("button",{onClick:()=>v(d.id),className:"flex items-center space-x-2 w-full text-left px-3 py-1.5 text-xs text-red-600 hover:bg-red-50",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,c.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})}),(0,c.jsx)("span",{children:"Delete"})]})})})]},d.id)}),(0,c.jsx)("div",{ref:t})]}),(0,c.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:u?(0,c.jsxs)("form",{onSubmit:c=>{c.preventDefault(),""!==p.trim()&&u&&((0,e.addMessage)(b.id,a.id,p.trim()),o((0,e.getMessagesForConversation)(b.id,h?.id)),q(""),m())},className:"flex items-center space-x-4",children:[(0,c.jsx)("input",{type:"text",placeholder:`Message ${b.displayName}...`,"aria-label":"Chat message input",value:p,onChange:a=>q(a.target.value),className:"flex-1 w-full px-4 py-2 border border-gray-300 rounded-full shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400"}),(0,c.jsx)(f.default,{type:"submit",children:"Send"})]}):(0,c.jsx)("div",{className:"text-center text-sm text-gray-500 italic px-4 py-2 bg-gray-100 rounded-full",children:"You do not have permission to post in this channel."})})]})}],64055)},97633,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(63187);let f=({conversations:a,currentUser:c,activeConversationId:f,onConversationSelect:g,searchTerm:h,onSearchChange:i})=>{let j=(0,d.useMemo)(()=>{if(!h)return a;let b=h.toLowerCase();return a.filter(a=>a.displayName.toLowerCase().includes(b))},[a,h]);return(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[i&&void 0!==h&&(0,b.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,b.jsx)(e.default,{label:"",id:"conversation-search",type:"search",placeholder:"Search conversations...",value:h,onChange:a=>i(a.target.value)})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,b.jsx)("ul",{className:"divide-y divide-gray-200",children:j.map(a=>{let d=a.isDirect?a.participants.find(a=>a.id!==c.id):null,e=a.id===f,h=a.lastMessage?`${a.lastMessage.userId===c.id?"You: ":""}${a.lastMessage.text}`:"No messages yet";return(0,b.jsx)("li",{onClick:()=>g(a),className:`p-4 cursor-pointer transition-colors ${e?"bg-amber-50":"hover:bg-gray-50"}`,children:(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"relative",children:a.isDirect&&d?(0,b.jsx)("img",{className:"h-10 w-10 rounded-full",src:d.profile.avatarUrl,alt:d.profile.displayName}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-gray-500 font-bold",children:"#"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-gray-900 truncate",children:a.displayName}),a.lastMessage&&(0,b.jsx)("div",{className:"text-xs text-gray-400 self-start flex-shrink-0 ml-2",children:a.lastMessage.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 truncate",children:h}),a.unreadCount>0&&(0,b.jsx)("span",{className:"ml-2 flex-shrink-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full",children:a.unreadCount})]})]})]})},a.id)})})})]})};var g=a.i(64055),h=a.i(66917),i=a.i(58020),j=a.i(82665);let k=({currentUser:a,onClose:c,onStartConversation:f})=>{let[g,i]=(0,d.useState)(""),k=(0,d.useMemo)(()=>(0,j.getAllUsers)().filter(b=>b.id!==a.id),[a.id]),l=(0,d.useMemo)(()=>{if(!g.trim())return k;let a=g.toLowerCase();return k.filter(b=>b.profile.displayName.toLowerCase().includes(a)||b.email.toLowerCase().includes(a))},[k,g]);return(0,b.jsxs)("div",{className:"flex flex-col",style:{minHeight:"50vh"},children:[(0,b.jsx)(e.default,{label:"",id:"user-search",type:"search",placeholder:"Search for a user by name or email...",value:g,onChange:a=>i(a.target.value)}),(0,b.jsx)("div",{className:"flex-1 mt-4 -mx-6 px-2 overflow-y-auto",children:(0,b.jsx)("ul",{className:"divide-y divide-gray-200",children:l.length>0?l.map(a=>(0,b.jsx)("li",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50",onClick:()=>f(a.id),children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("img",{src:a.profile.avatarUrl,alt:a.profile.displayName,className:"w-10 h-10 rounded-full"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-gray-800",children:a.profile.displayName}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.email})]})]})},a.id)):(0,b.jsx)("li",{className:"p-8 text-center text-sm text-gray-500",children:"No users found matching your search."})})}),(0,b.jsx)("div",{className:"pt-4 border-t border-gray-200 text-right",children:(0,b.jsx)(h.default,{variant:"secondary",onClick:c,children:"Cancel"})})]})},l=({currentUser:a,initialConversations:c,onBack:e,onViewProfile:j,initialActiveConversationId:l})=>{let[m,n]=(0,d.useState)(c),[o,p]=(0,d.useState)(""),[q,r]=(0,d.useState)(!1),[s,t]=(0,d.useState)(null),u=(0,d.useMemo)(()=>m,[m]),[v,w]=(0,d.useState)(()=>l?m.find(a=>a.id===l)||m[0]||null:m.length>0?m[0]:null);(0,d.useEffect)(()=>{let a=s||l;if(a){let b=m.find(b=>b.id===a);b&&(w(b),s&&t(null))}},[l,m,s]);let x=(0,d.useCallback)(async a=>{let b=await fetch("/api/conversations/direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientId:a})});if(b.ok){let a=await b.json();n(b=>b.find(b=>b.id===a.id)?b:[...b,a]),r(!1),t(a.id)}},[]),y=(0,d.useCallback)(()=>{fetch("/api/conversations").then(a=>a.json()).then(a=>n(a))},[]);return(0,b.jsxs)("div",{children:[(0,b.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(h.default,{variant:"secondary",size:"sm",onClick:e,children:"â† Back"}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Messages"})]}),(0,b.jsx)(h.default,{onClick:()=>r(!0),children:"+ New Message"})]})}),(0,b.jsx)("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 mt-8",children:(0,b.jsxs)("div",{className:"flex h-[calc(100vh-170px)] bg-white rounded-lg shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:(0,b.jsx)(f,{conversations:u,currentUser:a,activeConversationId:v?.id,onConversationSelect:w,searchTerm:o,onSearchChange:p})}),(0,b.jsx)("div",{className:"w-2/3 flex flex-col",children:v?(0,b.jsx)(g.default,{currentUser:a,conversation:v,onViewProfile:j,isDetailsPanelOpen:!1,onToggleDetailsPanel:()=>{},onMarkAsRead:y},v.id):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center text-center",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Select a Conversation"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Choose a conversation from the left or start a new one."})]})})})]})}),(0,b.jsx)(i.default,{isOpen:q,onClose:()=>r(!1),title:"Start a New Conversation",children:(0,b.jsx)(k,{currentUser:a,onClose:()=>r(!1),onStartConversation:x})})]})};function m({user:a,initialConversations:d}){let e=(0,c.useRouter)();return(0,b.jsx)(l,{currentUser:a,initialConversations:d,onBack:()=>e.push("/"),onViewProfile:a=>e.push(`/profile/${a}`)})}a.s(["default",()=>m],97633)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__97ad56fd._.js.map