{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../app/components/ui/Button.tsx","../../../../app/components/ui/Input.tsx","../../../../app/components/ui/Modal.tsx","../../../../app/components/messages/MessageStream.tsx","../../../../lib/permissions.ts","../../../../app/messages/MessagesPageClient.tsx","../../../../app/components/messages/MessagesPage.tsx","../../../../app/components/messages/ConversationList.tsx","../../../../app/components/messages/NewMessageModal.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","import React from 'react';\r\n\r\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n  variant?: 'primary' | 'secondary' | 'danger';\r\n  size?: 'sm' | 'md';\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Button: React.FC<ButtonProps> = ({ children, variant = 'primary', size = 'md', className, ...props }) => {\r\n  const baseClasses = \"rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\";\r\n\r\n  const variantClasses = {\r\n    primary: 'bg-amber-600 text-white hover:bg-amber-700 focus:ring-amber-500',\r\n    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400',\r\n    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',\r\n  };\r\n  \r\n  const sizeClasses = {\r\n      md: \"px-4 py-2 text-sm\",\r\n      sm: \"px-3 py-1.5 text-xs\",\r\n  }\r\n\r\n  return (\r\n    <button className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${className}`} {...props}>\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default Button;\r\n","import React from 'react';\r\n\r\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\r\n  label: string;\r\n  containerClassName?: string;\r\n}\r\n\r\nconst Input: React.FC<InputProps> = ({ label, id, containerClassName, ...props }) => {\r\n  return (\r\n    <div className={containerClassName}>\r\n      <label htmlFor={id} className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n        {label}\r\n      </label>\r\n      <input\r\n        id={id}\r\n        className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400\"\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Input;","'use client';\r\n\r\nimport React, { useEffect } from 'react';\r\n\r\ninterface ModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  title: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Modal: React.FC<ModalProps> = ({ isOpen, onClose, title, children }) => {\r\n  useEffect(() => {\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('keydown', handleEscape);\r\n    return () => {\r\n      document.removeEventListener('keydown', handleEscape);\r\n    };\r\n  }, [onClose]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-start overflow-y-auto p-4 sm:p-10\"\r\n      aria-labelledby=\"modal-title\"\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        className=\"bg-white rounded-lg shadow-xl max-w-lg w-full overflow-hidden\"\r\n        onClick={(e) => e.stopPropagation()} // Prevent clicks inside the modal from closing it\r\n      >\r\n        <div className=\"flex justify-between items-center p-4 border-b border-gray-200\">\r\n          <h2 id=\"modal-title\" className=\"text-lg font-semibold text-gray-900\">\r\n            {title}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600\"\r\n            aria-label=\"Close modal\"\r\n          >\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div className=\"p-6\">\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Modal;","'use client';\r\n\r\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\r\nimport type { User, EnrichedConversation, EnrichedChatMessage, Tenant } from '../../types';\r\nimport { getMessagesForConversation, addMessage, markConversationAsRead, deleteMessage } from '../../../lib/data';\r\nimport Button from '../ui/Button';\r\nimport { can, canDeleteMessage } from '../../../lib/permissions';\r\n\r\ninterface MessageStreamProps {\r\n  currentUser: User;\r\n  conversation: EnrichedConversation;\r\n  onViewProfile: (userId: string) => void;\r\n  tenant?: Tenant;\r\n  isDetailsPanelOpen: boolean;\r\n  onToggleDetailsPanel: () => void;\r\n  onMarkAsRead: () => void;\r\n}\r\n\r\nconst MessageStream: React.FC<MessageStreamProps> = ({ currentUser, conversation, onViewProfile, tenant, isDetailsPanelOpen, onToggleDetailsPanel, onMarkAsRead }) => {\r\n  const [messages, setMessages] = useState<EnrichedChatMessage[]>(() =>\r\n    getMessagesForConversation(conversation.id, tenant?.id)\r\n  );\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [showActionsFor, setShowActionsFor] = useState<string | null>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    setMessages(getMessagesForConversation(conversation.id, tenant?.id));\r\n    markConversationAsRead(currentUser.id, conversation.id);\r\n    onMarkAsRead();\r\n  }, [conversation.id, currentUser.id, onMarkAsRead, tenant?.id]);\r\n  \r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n  \r\n  const canSendMessage = useMemo(() => {\r\n    if (conversation.isDirect) {\r\n      return true;\r\n    }\r\n    if (tenant && conversation.name?.toLowerCase() === '#announcements') {\r\n      return can(currentUser, tenant, 'canPostInAnnouncementChannels');\r\n    }\r\n    return true;\r\n  }, [currentUser, conversation, tenant]);\r\n\r\n  const handleSendMessage = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (newMessage.trim() === '' || !canSendMessage) return;\r\n    addMessage(conversation.id, currentUser.id, newMessage.trim());\r\n    setMessages(getMessagesForConversation(conversation.id, tenant?.id));\r\n    setNewMessage('');\r\n    onMarkAsRead();\r\n  };\r\n  \r\n  const handleDeleteMessage = useCallback((messageId: string) => {\r\n    const success = deleteMessage(messageId, currentUser.id);\r\n    if (success) {\r\n      setMessages(currentMessages => currentMessages.filter(m => m.id !== messageId));\r\n      onMarkAsRead(); // To update last message snippet\r\n    } else {\r\n      alert(\"You don't have permission to delete this message.\");\r\n    }\r\n  }, [currentUser.id, onMarkAsRead]);\r\n\r\n  const otherParticipant = conversation.isDirect ? conversation.participants.find(p => p.id !== currentUser.id) : null;\r\n\r\n  return (\r\n    <>\r\n      {/* Header */}\r\n      <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\r\n         <div className=\"flex items-center space-x-3\">\r\n             {conversation.isDirect && otherParticipant ? (\r\n                // FIX: Access avatarUrl and displayName from the nested profile object.\r\n                <img src={otherParticipant.profile.avatarUrl} alt={otherParticipant.profile.displayName} className=\"w-10 h-10 rounded-full\" />\r\n             ) : (\r\n                <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 text-xl\">#</div>\r\n             )}\r\n             <div>\r\n                <h2 className=\"text-lg font-bold text-gray-900\">{conversation.displayName}</h2>\r\n             </div>\r\n         </div>\r\n         {!conversation.isDirect && (\r\n            <button onClick={onToggleDetailsPanel} className={`p-2 rounded-md transition-colors lg:hidden ${isDetailsPanelOpen ? 'bg-amber-100 text-amber-700' : 'text-gray-400 hover:bg-gray-100 hover:text-gray-600'}`}>\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                </svg>\r\n            </button>\r\n         )}\r\n      </div>\r\n\r\n      {/* Messages Area */}\r\n      <div className=\"flex-1 p-6 overflow-y-auto space-y-2\">\r\n        {messages.map((msg) => {\r\n           const userCanDelete = canDeleteMessage(currentUser, msg, conversation, tenant);\r\n           const isOwnMessage = msg.userId === currentUser.id;\r\n           return (\r\n            <div\r\n              key={msg.id}\r\n              className={`flex items-start gap-3 group relative ${\r\n                isOwnMessage ? 'justify-end' : 'justify-start'\r\n              }`}\r\n              onMouseEnter={() => setShowActionsFor(msg.id)}\r\n              onMouseLeave={() => setShowActionsFor(null)}\r\n            >\r\n              {!isOwnMessage && (\r\n                <img\r\n                  src={msg.userAvatarUrl}\r\n                  alt={msg.userDisplayName}\r\n                  className=\"w-8 h-8 rounded-full cursor-pointer\"\r\n                  onClick={() => onViewProfile(msg.userId)}\r\n                />\r\n              )}\r\n              <div className=\"flex flex-col\">\r\n                <div\r\n                  className={`max-w-md p-3 rounded-lg ${\r\n                    isOwnMessage ? 'bg-amber-500 text-white' : 'bg-gray-100 text-gray-800'\r\n                  }`}\r\n                >\r\n                  {!isOwnMessage && (\r\n                    <p \r\n                        className=\"text-xs font-bold mb-1 text-amber-700 cursor-pointer\"\r\n                        onClick={() => onViewProfile(msg.userId)}\r\n                    >\r\n                        {msg.userDisplayName}\r\n                    </p>\r\n                  )}\r\n                  <p className=\"text-sm\" style={{ whiteSpace: 'pre-wrap' }}>{msg.text}</p>\r\n                </div>\r\n                <p className={`text-xs mt-1 ${isOwnMessage ? 'text-gray-400 self-end' : 'text-gray-400'}`}>\r\n                  {msg.createdAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                </p>\r\n              </div>\r\n              {showActionsFor === msg.id && userCanDelete && (\r\n                <div className={`absolute top-0 ${isOwnMessage ? 'left-0 -translate-x-full pr-2' : 'right-0 translate-x-full pl-2'}`}>\r\n                  <div className=\"bg-white rounded-md shadow-lg border border-gray-200\">\r\n                    <button\r\n                      onClick={() => handleDeleteMessage(msg.id)}\r\n                      className=\"flex items-center space-x-2 w-full text-left px-3 py-1.5 text-xs text-red-600 hover:bg-red-50\"\r\n                    >\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                        <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z\" clipRule=\"evenodd\" />\r\n                      </svg>\r\n                      <span>Delete</span>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n           );\r\n        })}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"p-4 border-t border-gray-200 bg-gray-50\">\r\n        {canSendMessage ? (\r\n          <form onSubmit={handleSendMessage} className=\"flex items-center space-x-4\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder={`Message ${conversation.displayName}...`}\r\n              aria-label=\"Chat message input\"\r\n              value={newMessage}\r\n              onChange={(e) => setNewMessage(e.target.value)}\r\n              className=\"flex-1 w-full px-4 py-2 border border-gray-300 rounded-full shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400\"\r\n            />\r\n            <Button type=\"submit\">Send</Button>\r\n          </form>\r\n        ) : (\r\n            <div className=\"text-center text-sm text-gray-500 italic px-4 py-2 bg-gray-100 rounded-full\">\r\n                You do not have permission to post in this channel.\r\n            </div>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MessageStream;","import { TenantRole, User, Tenant, ChatMessage, Conversation, UserTenantMembership } from '@prisma/client';\r\nimport { prisma } from './db';\r\n\r\n// Define RolePermissions based on your application's logic, as it's not in Prisma schema\r\nexport interface RolePermissions {\r\n  canCreatePosts: boolean;\r\n  canCreateEvents: boolean;\r\n  canCreateSermons: boolean;\r\n  canCreatePodcasts: boolean;\r\n  canCreateBooks: boolean;\r\n  canCreateGroupChats: boolean;\r\n  canInviteMembers: boolean;\r\n  canApproveMembership: boolean;\r\n  canBanMembers: boolean;\r\n  canModeratePosts: boolean;\r\n  canModerateChats: boolean;\r\n  canPostInAnnouncementChannels?: boolean;\r\n  canManagePrayerWall: boolean;\r\n  canUploadResources: boolean;\r\n  canManageResources: boolean;\r\n  canManageContactSubmissions: boolean;\r\n}\r\n\r\n// This can be a simple enum if you don't need the string values\r\nexport enum TenantRoleType {\r\n    MEMBER = 'MEMBER',\r\n    STAFF = 'STAFF',\r\n    MODERATOR = 'MODERATOR',\r\n}\r\n\r\nasync function getMembershipForUserInTenant(userId: string, tenantId: string): Promise<(UserTenantMembership & { roles: { role: TenantRole }[] }) | null> {\r\n    return prisma.userTenantMembership.findUnique({\r\n        where: {\r\n            userId_tenantId: {\r\n                userId,\r\n                tenantId,\r\n            },\r\n        },\r\n        include: {\r\n            roles: {\r\n                select: {\r\n                    role: true\r\n                }\r\n            },\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\n/**\r\n * Maps a specific TenantRole to a more general TenantRoleType for permission lookups.\r\n */\r\nfunction getRoleType(role: TenantRole): TenantRoleType | 'ADMIN' {\r\n    switch (role) {\r\n        case TenantRole.ADMIN:\r\n            return 'ADMIN';\r\n        case TenantRole.STAFF:\r\n        case TenantRole.CLERGY:\r\n            return TenantRoleType.STAFF;\r\n        case TenantRole.MODERATOR:\r\n            return TenantRoleType.MODERATOR;\r\n        case TenantRole.MEMBER:\r\n            return TenantRoleType.MEMBER;\r\n        default:\r\n            return TenantRoleType.MEMBER;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Checks if a user has a specific permission within a tenant.\r\n * This is the centralized source of truth for all permission checks.\r\n *\r\n * @param user The user to check.\r\n * @param tenant The tenant context for the permission.\r\n * @param permission The permission to check for (e.g., 'canCreatePosts').\r\n * @returns {boolean} True if the user has the permission, false otherwise.\r\n */\r\nexport async function can(user: User, tenant: Tenant, permission: keyof RolePermissions): Promise<boolean> {\r\n  // Super Admins can do anything.\r\n  if (user.isSuperAdmin) {\r\n    return true;\r\n  }\r\n\r\n  // Find the user's membership for this specific tenant.\r\n  const membership = await getMembershipForUserInTenant(user.id, tenant.id);\r\n\r\n  // If the user is not a member or not approved, they have no permissions.\r\n  if (!membership || membership.status !== 'APPROVED') {\r\n    return false;\r\n  }\r\n  \r\n  // Check if any of the user's roles grant the required permission.\r\n  for (const roleInfo of membership.roles) {\r\n    const roleType = getRoleType(roleInfo.role);\r\n    const permissions = tenant.permissions as any;\r\n\r\n    if (roleType === 'ADMIN') {\r\n        // Admins have all permissions defined under the ADMIN key.\r\n        if (permissions.ADMIN[permission]) {\r\n            return true;\r\n        }\r\n    } else {\r\n        // For other roles, check against their TenantRoleType.\r\n        const rolePerms = permissions[roleType];\r\n        if (rolePerms && rolePerms[permission]) {\r\n            return true; // Permission granted by at least one role.\r\n        }\r\n    }\r\n  }\r\n\r\n  return false; // No role granted the permission.\r\n}\r\n\r\n/**\r\n * Checks if a user has a specific role within a tenant.\r\n *\r\n * @param user The user to check.\r\n * @param tenantId The ID of the tenant context for the role.\r\n * @param role The role to check for.\r\n * @returns {boolean} True if the user has the role, false otherwise.\r\n */\r\nexport async function hasRole(userId: string, tenantId: string, requiredRoles: TenantRole[]): Promise<boolean> {\r\n  const membership = await getMembershipForUserInTenant(userId, tenantId);\r\n\r\n  if (!membership || membership.status !== 'APPROVED') {\r\n    return false;\r\n  }\r\n\r\n  return membership.roles.some(roleInfo => requiredRoles.includes(roleInfo.role));\r\n}\r\n\r\n/**\r\n * Checks if a user can view a certain type of content (e.g., posts, events).\r\n * It checks tenant settings for public visibility and feature enablement.\r\n *\r\n * @param userId The ID of the user attempting to view. Can be null for anonymous users.\r\n * @param tenantId The ID of the tenant where the content resides.\r\n * @param contentType The key for the content type in tenant settings (e.g., 'posts', 'calendar').\r\n * @returns {Promise<boolean>} True if the user can view the content.\r\n */\r\nexport async function canUserViewContent(userId: string | null, tenantId: string, contentType: 'posts' | 'calendar' | 'sermons' | 'podcasts' | 'books' | 'prayerWall'): Promise<boolean> {\r\n    const tenant = await prisma.tenant.findUnique({\r\n        where: { id: tenantId },\r\n        include: { settings: true }\r\n    });\r\n\r\n    if (!tenant || !tenant.settings) return false;\r\n\r\n    const settings = tenant.settings as any;\r\n\r\n    // Check if the entire feature is disabled\r\n    const featureFlag = `enable${contentType.charAt(0).toUpperCase() + contentType.slice(1)}`;\r\n    if (!settings[featureFlag]) {\r\n        return false;\r\n    }\r\n\r\n    const membership = userId ? await getMembershipForUserInTenant(userId, tenantId) : null;\r\n\r\n    // If user is not a member, check public visibility settings\r\n    if (!membership || membership.status !== 'APPROVED') {\r\n        return settings.visitorVisibility[contentType];\r\n    }\r\n\r\n    // If they are an approved member, they can view it as long as the feature is enabled.\r\n    return true;\r\n}\r\n\r\n/**\r\n * Checks if a user has permission to create a post in a tenant.\r\n *\r\n * @param userId The ID of the user.\r\n * @param tenantId The ID of the tenant.\r\n * @param isAnnouncement Whether the post is an announcement.\r\n * @returns {Promise<boolean>} True if the user can create the post.\r\n */\r\nexport async function canUserPost(userId: string, tenantId: string, isAnnouncement: boolean): Promise<boolean> {\r\n    const user = await prisma.user.findUnique({ where: { id: userId } });\r\n    const tenant = await prisma.tenant.findUnique({ where: { id: tenantId }, include: { permissions: true } });\r\n\r\n    if (!user || !tenant) return false;\r\n\r\n    if (isAnnouncement) {\r\n        return can(user, tenant, 'canPostInAnnouncementChannels');\r\n    }\r\n    return can(user, tenant, 'canCreatePosts');\r\n}\r\n\r\n\r\n/**\r\n * Checks if a user can delete a specific message.\r\n */\r\nexport async function canDeleteMessage(\r\n  user: User,\r\n  message: ChatMessage,\r\n  conversation: Conversation,\r\n  tenant: Tenant\r\n): Promise<boolean> {\r\n  if (user.isSuperAdmin) {\r\n    return true;\r\n  }\r\n  // User can delete their own message\r\n  if (message.userId === user.id) {\r\n    return true;\r\n  }\r\n  // Check for moderation permissions\r\n  if (!conversation.isDirectMessage) { // isGroupChat\r\n    if (await can(user, tenant, 'canModerateChats')) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}","'use client';\r\n\r\nimport { useRouter } from 'next/navigation';\r\nimport MessagesPage from '../components/messages/MessagesPage';\r\nimport type { User, EnrichedConversation } from '../../types';\r\n\r\ninterface MessagesPageClientProps {\r\n  user: User;\r\n  initialConversations: EnrichedConversation[];\r\n}\r\n\r\nexport default function MessagesPageClient({ user, initialConversations }: MessagesPageClientProps) {\r\n  const router = useRouter();\r\n  \r\n  return (\r\n    <MessagesPage \r\n      currentUser={user}\r\n      initialConversations={initialConversations}\r\n      onBack={() => router.push('/')} \r\n      onViewProfile={(userId) => router.push(`/profile/${userId}`)} \r\n    />\r\n  );\r\n}\r\n","'use client';\r\n\r\nimport React, { useState, useMemo, useEffect, useCallback } from 'react';\r\nimport type { User, EnrichedConversation } from '../../types';\r\nimport ConversationList from './ConversationList';\r\nimport MessageStream from './MessageStream';\r\nimport Button from '../ui/Button';\r\nimport Modal from '../ui/Modal';\r\nimport NewMessageModal from './NewMessageModal';\r\n\r\ninterface MessagesPageProps {\r\n  currentUser: User;\r\n  initialConversations: EnrichedConversation[];\r\n  onBack: () => void;\r\n  onViewProfile: (userId: string) => void;\r\n  initialActiveConversationId?: string | null;\r\n}\r\n\r\nconst MessagesPage: React.FC<MessagesPageProps> = ({ \r\n  currentUser, \r\n  initialConversations,\r\n  onBack, \r\n  onViewProfile, \r\n  initialActiveConversationId \r\n}) => {\r\n  const [conversations, setConversations] = useState<EnrichedConversation[]>(initialConversations);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [isNewMessageModalOpen, setIsNewMessageModalOpen] = useState(false);\r\n  const [newlyCreatedConvId, setNewlyCreatedConvId] = useState<string | null>(null);\r\n\r\n  const allUserConversations = useMemo(() => conversations, [conversations]);\r\n  \r\n  const [activeConversation, setActiveConversation] = useState<EnrichedConversation | null>(() => {\r\n    if (initialActiveConversationId) {\r\n      return conversations.find(c => c.id === initialActiveConversationId) || conversations[0] || null;\r\n    }\r\n    return conversations.length > 0 ? conversations[0] : null;\r\n  });\r\n\r\n  useEffect(() => {\r\n    const conversationIdToSelect = newlyCreatedConvId || initialActiveConversationId;\r\n    if (conversationIdToSelect) {\r\n      const conversationToActivate = conversations.find(c => c.id === conversationIdToSelect);\r\n      if (conversationToActivate) {\r\n        setActiveConversation(conversationToActivate);\r\n        if (newlyCreatedConvId) {\r\n          setNewlyCreatedConvId(null);\r\n        }\r\n      }\r\n    }\r\n  }, [initialActiveConversationId, conversations, newlyCreatedConvId]);\r\n  \r\n  const handleStartConversation = useCallback(async (recipientId: string) => {\r\n    // Create or get conversation via API\r\n    const response = await fetch('/api/conversations/direct', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ recipientId }),\r\n    });\r\n    \r\n    if (response.ok) {\r\n      const conversation = await response.json();\r\n      setConversations(prev => {\r\n        const exists = prev.find(c => c.id === conversation.id);\r\n        return exists ? prev : [...prev, conversation];\r\n      });\r\n      setIsNewMessageModalOpen(false);\r\n      setNewlyCreatedConvId(conversation.id);\r\n    }\r\n  }, []);\r\n\r\n  const forceConversationListUpdate = useCallback(() => {\r\n    // Reload conversations from server\r\n    fetch('/api/conversations')\r\n      .then(res => res.json())\r\n      .then(data => setConversations(data));\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n        <header className=\"bg-white shadow-sm sticky top-0 z-10\">\r\n          <div className=\"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <Button variant=\"secondary\" size=\"sm\" onClick={onBack}>&larr; Back</Button>\r\n              <h1 className=\"text-xl font-bold text-gray-800\">Messages</h1>\r\n            </div>\r\n            <Button onClick={() => setIsNewMessageModalOpen(true)}>\r\n              + New Message\r\n            </Button>\r\n          </div>\r\n        </header>\r\n\r\n        <div className=\"max-w-7xl mx-auto sm:px-6 lg:px-8 mt-8\">\r\n            <div className=\"flex h-[calc(100vh-170px)] bg-white rounded-lg shadow-sm overflow-hidden\">\r\n            <div className=\"w-1/3 border-r border-gray-200 flex flex-col\">\r\n                <ConversationList\r\n                  conversations={allUserConversations}\r\n                  currentUser={currentUser}\r\n                  activeConversationId={activeConversation?.id}\r\n                  onConversationSelect={setActiveConversation}\r\n                  searchTerm={searchTerm}\r\n                  onSearchChange={setSearchTerm}\r\n                />\r\n            </div>\r\n            <div className=\"w-2/3 flex flex-col\">\r\n                {activeConversation ? (\r\n                <MessageStream\r\n                    key={activeConversation.id} // Re-mount component when conversation changes\r\n                    currentUser={currentUser}\r\n                    conversation={activeConversation}\r\n                    onViewProfile={onViewProfile}\r\n                    isDetailsPanelOpen={false}\r\n                    onToggleDetailsPanel={() => {}}\r\n                    onMarkAsRead={forceConversationListUpdate}\r\n                />\r\n                ) : (\r\n                <div className=\"flex-1 flex items-center justify-center text-center\">\r\n                    <div>\r\n                    <h3 className=\"text-lg font-medium text-gray-900\">Select a Conversation</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-500\">\r\n                        Choose a conversation from the left or start a new one.\r\n                    </p>\r\n                    </div>\r\n                </div>\r\n                )}\r\n            </div>\r\n            </div>\r\n        </div>\r\n        <Modal isOpen={isNewMessageModalOpen} onClose={() => setIsNewMessageModalOpen(false)} title=\"Start a New Conversation\">\r\n            <NewMessageModal \r\n                currentUser={currentUser}\r\n                onClose={() => setIsNewMessageModalOpen(false)}\r\n                onStartConversation={handleStartConversation}\r\n            />\r\n        </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessagesPage;","import React, { useMemo } from 'react';\r\nimport type { EnrichedConversation, User } from '../../types';\r\nimport Input from '../ui/Input';\r\n\r\ninterface ConversationListProps {\r\n  conversations: EnrichedConversation[];\r\n  currentUser: User;\r\n  activeConversationId?: string | null;\r\n  onConversationSelect: (conversation: EnrichedConversation) => void;\r\n  searchTerm?: string;\r\n  onSearchChange?: (term: string) => void;\r\n}\r\n\r\nconst ConversationList: React.FC<ConversationListProps> = ({\r\n  conversations,\r\n  currentUser,\r\n  activeConversationId,\r\n  onConversationSelect,\r\n  searchTerm,\r\n  onSearchChange,\r\n}) => {\r\n  const getOtherParticipant = (conv: EnrichedConversation) => {\r\n    return conv.participants.find((p) => p.id !== currentUser.id);\r\n  };\r\n\r\n  const filteredConversations = useMemo(() => {\r\n    if (!searchTerm) return conversations;\r\n    const lowercasedTerm = searchTerm.toLowerCase();\r\n    return conversations.filter((c) => c.displayName.toLowerCase().includes(lowercasedTerm));\r\n  }, [conversations, searchTerm]);\r\n\r\n  return (\r\n    <div className=\"flex-1 flex flex-col\">\r\n      {onSearchChange && searchTerm !== undefined && (\r\n        <div className=\"p-4 border-b border-gray-200\">\r\n          <Input\r\n            label=\"\"\r\n            id=\"conversation-search\"\r\n            type=\"search\"\r\n            placeholder=\"Search conversations...\"\r\n            value={searchTerm}\r\n            onChange={(e) => onSearchChange(e.target.value)}\r\n          />\r\n        </div>\r\n      )}\r\n      <div className=\"flex-1 overflow-y-auto\">\r\n        <ul className=\"divide-y divide-gray-200\">\r\n          {filteredConversations.map((conv) => {\r\n            const otherParticipant = conv.isDirect ? getOtherParticipant(conv) : null;\r\n            const isActive = conv.id === activeConversationId;\r\n            const lastMessageText = conv.lastMessage\r\n              ? `${conv.lastMessage.userId === currentUser.id ? 'You: ' : ''}${conv.lastMessage.text}`\r\n              : 'No messages yet';\r\n\r\n            return (\r\n              <li\r\n                key={conv.id}\r\n                onClick={() => onConversationSelect(conv)}\r\n                className={`p-4 cursor-pointer transition-colors ${\r\n                  isActive ? 'bg-amber-50' : 'hover:bg-gray-50'\r\n                }`}\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"relative\">\r\n                    {conv.isDirect && otherParticipant ? (\r\n                      <img\r\n                        className=\"h-10 w-10 rounded-full\"\r\n                        // FIX: Access avatarUrl and displayName from the nested profile object.\r\n                        src={otherParticipant.profile.avatarUrl}\r\n                        alt={otherParticipant.profile.displayName}\r\n                      />\r\n                    ) : (\r\n                      <div className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                        <span className=\"text-gray-500 font-bold\">#</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <p className=\"text-sm font-semibold text-gray-900 truncate\">\r\n                        {conv.displayName}\r\n                      </p>\r\n                      {conv.lastMessage && (\r\n                        <div className=\"text-xs text-gray-400 self-start flex-shrink-0 ml-2\">\r\n                          {conv.lastMessage.createdAt.toLocaleTimeString([], {\r\n                            hour: '2-digit',\r\n                            minute: '2-digit',\r\n                          })}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center\">\r\n                       <p className=\"text-sm text-gray-500 truncate\">{lastMessageText}</p>\r\n                       {conv.unreadCount > 0 && (\r\n                         <span className=\"ml-2 flex-shrink-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full\">\r\n                           {conv.unreadCount}\r\n                         </span>\r\n                       )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </li>\r\n            );\r\n          })}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConversationList;\r\n","'use client';\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport type { User } from '../../types';\r\nimport { getAllUsers } from '../../../lib/data';\r\nimport Input from '../ui/Input';\r\nimport Button from '../ui/Button';\r\n\r\ninterface NewMessageModalProps {\r\n  currentUser: User;\r\n  onClose: () => void;\r\n  onStartConversation: (recipientId: string) => void;\r\n}\r\n\r\nconst NewMessageModal: React.FC<NewMessageModalProps> = ({ currentUser, onClose, onStartConversation }) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n\r\n  const allOtherUsers = useMemo(() => {\r\n    return getAllUsers().filter(u => u.id !== currentUser.id);\r\n  }, [currentUser.id]);\r\n\r\n  const filteredUsers = useMemo(() => {\r\n    if (!searchTerm.trim()) {\r\n      return allOtherUsers;\r\n    }\r\n    const lowercasedTerm = searchTerm.toLowerCase();\r\n    return allOtherUsers.filter(\r\n      u =>\r\n        // FIX: Access displayName from the nested profile object.\r\n        u.profile.displayName.toLowerCase().includes(lowercasedTerm) ||\r\n        u.email.toLowerCase().includes(lowercasedTerm)\r\n    );\r\n  }, [allOtherUsers, searchTerm]);\r\n\r\n  return (\r\n    <div className=\"flex flex-col\" style={{ minHeight: '50vh' }}>\r\n      <Input\r\n        label=\"\"\r\n        id=\"user-search\"\r\n        type=\"search\"\r\n        placeholder=\"Search for a user by name or email...\"\r\n        value={searchTerm}\r\n        onChange={e => setSearchTerm(e.target.value)}\r\n      />\r\n\r\n      <div className=\"flex-1 mt-4 -mx-6 px-2 overflow-y-auto\">\r\n        <ul className=\"divide-y divide-gray-200\">\r\n          {filteredUsers.length > 0 ? (\r\n            filteredUsers.map(user => (\r\n              <li\r\n                key={user.id}\r\n                className=\"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50\"\r\n                onClick={() => onStartConversation(user.id)}\r\n              >\r\n                <div className=\"flex items-center space-x-4\">\r\n                  {/* FIX: Access avatarUrl and displayName from the nested profile object. */}\r\n                  <img src={user.profile.avatarUrl} alt={user.profile.displayName} className=\"w-10 h-10 rounded-full\" />\r\n                  <div>\r\n                    <p className=\"font-semibold text-gray-800\">{user.profile.displayName}</p>\r\n                    <p className=\"text-sm text-gray-500\">{user.email}</p>\r\n                  </div>\r\n                </div>\r\n              </li>\r\n            ))\r\n          ) : (\r\n            <li className=\"p-8 text-center text-sm text-gray-500\">\r\n              No users found matching your search.\r\n            </li>\r\n          )}\r\n        </ul>\r\n      </div>\r\n\r\n      <div className=\"pt-4 border-t border-gray-200 text-right\">\r\n        <Button variant=\"secondary\" onClick={onClose}>\r\n          Cancel\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewMessageModal;\r\n"],"names":["module","exports","require","vendored","AppRouterContext","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1,2]}