(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,83079,e=>{"use strict";var s=e.i(43476);e.s(["default",0,({children:e,variant:t="primary",size:r="md",className:a,...l})=>(0,s.jsx)("button",{className:`rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${{primary:"bg-amber-600 text-white hover:bg-amber-700 focus:ring-amber-500",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[t]} ${{md:"px-4 py-2 text-sm",sm:"px-3 py-1.5 text-xs"}[r]} ${a}`,...l,children:e})])},18566,(e,s,t)=>{s.exports=e.r(76562)},44849,e=>{"use strict";var s=e.i(43476);e.s(["default",0,({label:e,id:t,containerClassName:r,...a})=>(0,s.jsxs)("div",{className:r,children:[(0,s.jsx)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,s.jsx)("input",{id:t,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400",...a})]})])},58911,e=>{"use strict";var s=e.i(43476),t=e.i(71645);e.s(["default",0,({isOpen:e,onClose:r,title:a,children:l})=>((0,t.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[r]),e)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-start overflow-y-auto p-4 sm:p-10","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",onClick:r,children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[(0,s.jsx)("h2",{id:"modal-title",className:"text-lg font-semibold text-gray-900",children:a}),(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600","aria-label":"Close modal",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"p-6",children:l})]})}):null])},29104,e=>{"use strict";var s,t=e.i(43476),r=e.i(71645),a=e.i(31487),l=e.i(83079),i=e.i(18228),n=e.i(8896);async function d(e,s){return n.prisma.userTenantMembership.findUnique({where:{userId_tenantId:{userId:e,tenantId:s}},include:{roles:{select:{role:!0}}}})}async function o(e,s,t){if(e.isSuperAdmin)return!0;let r=await d(e.id,s.id);if(!r||"APPROVED"!==r.status)return!1;for(let e of r.roles){let r=function(e){switch(e){case i.TenantRole.ADMIN:return"ADMIN";case i.TenantRole.STAFF:case i.TenantRole.CLERGY:return"STAFF";case i.TenantRole.MODERATOR:return"MODERATOR";case i.TenantRole.MEMBER:default:return"MEMBER"}}(e.role),a=s.permissions;if("ADMIN"===r){if(a.ADMIN[t])return!0}else{let e=a[r];if(e&&e[t])return!0}}return!1}async function c(e,s,t,r){return!!(e.isSuperAdmin||s.userId===e.id||!t.isDirectMessage&&await o(e,r,"canModerateChats"))}(s={}).MEMBER="MEMBER",s.STAFF="STAFF",s.MODERATOR="MODERATOR",e.s(["default",0,({currentUser:e,conversation:s,onViewProfile:i,tenant:n,isDetailsPanelOpen:d,onToggleDetailsPanel:x,onMarkAsRead:m})=>{let[u,h]=(0,r.useState)(()=>(0,a.getMessagesForConversation)(s.id,n?.id)),[f,g]=(0,r.useState)(""),[p,v]=(0,r.useState)(null),y=(0,r.useRef)(null);(0,r.useEffect)(()=>{h((0,a.getMessagesForConversation)(s.id,n?.id)),(0,a.markConversationAsRead)(e.id,s.id),m()},[s.id,e.id,m,n?.id]),(0,r.useEffect)(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[u]);let j=(0,r.useMemo)(()=>!!s.isDirect||!n||s.name?.toLowerCase()!=="#announcements"||o(e,n,"canPostInAnnouncementChannels"),[e,s,n]),b=(0,r.useCallback)(s=>{(0,a.deleteMessage)(s,e.id)?(h(e=>e.filter(e=>e.id!==s)),m()):alert("You don't have permission to delete this message.")},[e.id,m]),N=s.isDirect?s.participants.find(s=>s.id!==e.id):null;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[s.isDirect&&N?(0,t.jsx)("img",{src:N.profile.avatarUrl,alt:N.profile.displayName,className:"w-10 h-10 rounded-full"}):(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 text-xl",children:"#"}),(0,t.jsx)("div",{children:(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:s.displayName})})]}),!s.isDirect&&(0,t.jsx)("button",{onClick:x,className:`p-2 rounded-md transition-colors lg:hidden ${d?"bg-amber-100 text-amber-700":"text-gray-400 hover:bg-gray-100 hover:text-gray-600"}`,children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]}),(0,t.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto space-y-2",children:[u.map(r=>{let a=c(e,r,s,n),l=r.userId===e.id;return(0,t.jsxs)("div",{className:`flex items-start gap-3 group relative ${l?"justify-end":"justify-start"}`,onMouseEnter:()=>v(r.id),onMouseLeave:()=>v(null),children:[!l&&(0,t.jsx)("img",{src:r.userAvatarUrl,alt:r.userDisplayName,className:"w-8 h-8 rounded-full cursor-pointer",onClick:()=>i(r.userId)}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:`max-w-md p-3 rounded-lg ${l?"bg-amber-500 text-white":"bg-gray-100 text-gray-800"}`,children:[!l&&(0,t.jsx)("p",{className:"text-xs font-bold mb-1 text-amber-700 cursor-pointer",onClick:()=>i(r.userId),children:r.userDisplayName}),(0,t.jsx)("p",{className:"text-sm",style:{whiteSpace:"pre-wrap"},children:r.text})]}),(0,t.jsx)("p",{className:`text-xs mt-1 ${l?"text-gray-400 self-end":"text-gray-400"}`,children:r.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),p===r.id&&a&&(0,t.jsx)("div",{className:`absolute top-0 ${l?"left-0 -translate-x-full pr-2":"right-0 translate-x-full pl-2"}`,children:(0,t.jsx)("div",{className:"bg-white rounded-md shadow-lg border border-gray-200",children:(0,t.jsxs)("button",{onClick:()=>b(r.id),className:"flex items-center space-x-2 w-full text-left px-3 py-1.5 text-xs text-red-600 hover:bg-red-50",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})}),(0,t.jsx)("span",{children:"Delete"})]})})})]},r.id)}),(0,t.jsx)("div",{ref:y})]}),(0,t.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:j?(0,t.jsxs)("form",{onSubmit:t=>{t.preventDefault(),""!==f.trim()&&j&&((0,a.addMessage)(s.id,e.id,f.trim()),h((0,a.getMessagesForConversation)(s.id,n?.id)),g(""),m())},className:"flex items-center space-x-4",children:[(0,t.jsx)("input",{type:"text",placeholder:`Message ${s.displayName}...`,"aria-label":"Chat message input",value:f,onChange:e=>g(e.target.value),className:"flex-1 w-full px-4 py-2 border border-gray-300 rounded-full shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm bg-white text-gray-900 placeholder:text-gray-400"}),(0,t.jsx)(l.default,{type:"submit",children:"Send"})]}):(0,t.jsx)("div",{className:"text-center text-sm text-gray-500 italic px-4 py-2 bg-gray-100 rounded-full",children:"You do not have permission to post in this channel."})})]})}],29104)},29001,e=>{"use strict";var s=e.i(43476),t=e.i(18566),r=e.i(71645),a=e.i(44849);let l=({conversations:e,currentUser:t,activeConversationId:l,onConversationSelect:i,searchTerm:n,onSearchChange:d})=>{let o=(0,r.useMemo)(()=>{if(!n)return e;let s=n.toLowerCase();return e.filter(e=>e.displayName.toLowerCase().includes(s))},[e,n]);return(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[d&&void 0!==n&&(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsx)(a.default,{label:"",id:"conversation-search",type:"search",placeholder:"Search conversations...",value:n,onChange:e=>d(e.target.value)})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:o.map(e=>{let r=e.isDirect?e.participants.find(e=>e.id!==t.id):null,a=e.id===l,n=e.lastMessage?`${e.lastMessage.userId===t.id?"You: ":""}${e.lastMessage.text}`:"No messages yet";return(0,s.jsx)("li",{onClick:()=>i(e),className:`p-4 cursor-pointer transition-colors ${a?"bg-amber-50":"hover:bg-gray-50"}`,children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"relative",children:e.isDirect&&r?(0,s.jsx)("img",{className:"h-10 w-10 rounded-full",src:r.profile.avatarUrl,alt:r.profile.displayName}):(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-gray-500 font-bold",children:"#"})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900 truncate",children:e.displayName}),e.lastMessage&&(0,s.jsx)("div",{className:"text-xs text-gray-400 self-start flex-shrink-0 ml-2",children:e.lastMessage.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 truncate",children:n}),e.unreadCount>0&&(0,s.jsx)("span",{className:"ml-2 flex-shrink-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full",children:e.unreadCount})]})]})]})},e.id)})})})]})};var i=e.i(29104),n=e.i(83079),d=e.i(58911),o=e.i(31487);let c=({currentUser:e,onClose:t,onStartConversation:l})=>{let[i,d]=(0,r.useState)(""),c=(0,r.useMemo)(()=>(0,o.getAllUsers)().filter(s=>s.id!==e.id),[e.id]),x=(0,r.useMemo)(()=>{if(!i.trim())return c;let e=i.toLowerCase();return c.filter(s=>s.profile.displayName.toLowerCase().includes(e)||s.email.toLowerCase().includes(e))},[c,i]);return(0,s.jsxs)("div",{className:"flex flex-col",style:{minHeight:"50vh"},children:[(0,s.jsx)(a.default,{label:"",id:"user-search",type:"search",placeholder:"Search for a user by name or email...",value:i,onChange:e=>d(e.target.value)}),(0,s.jsx)("div",{className:"flex-1 mt-4 -mx-6 px-2 overflow-y-auto",children:(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:x.length>0?x.map(e=>(0,s.jsx)("li",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50",onClick:()=>l(e.id),children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("img",{src:e.profile.avatarUrl,alt:e.profile.displayName,className:"w-10 h-10 rounded-full"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-800",children:e.profile.displayName}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.email})]})]})},e.id)):(0,s.jsx)("li",{className:"p-8 text-center text-sm text-gray-500",children:"No users found matching your search."})})}),(0,s.jsx)("div",{className:"pt-4 border-t border-gray-200 text-right",children:(0,s.jsx)(n.default,{variant:"secondary",onClick:t,children:"Cancel"})})]})},x=({currentUser:e,initialConversations:t,onBack:a,onViewProfile:o,initialActiveConversationId:x})=>{let[m,u]=(0,r.useState)(t),[h,f]=(0,r.useState)(""),[g,p]=(0,r.useState)(!1),[v,y]=(0,r.useState)(null),j=(0,r.useMemo)(()=>m,[m]),[b,N]=(0,r.useState)(()=>x?m.find(e=>e.id===x)||m[0]||null:m.length>0?m[0]:null);(0,r.useEffect)(()=>{let e=v||x;if(e){let s=m.find(s=>s.id===e);s&&(N(s),v&&y(null))}},[x,m,v]);let w=(0,r.useCallback)(async e=>{let s=await fetch("/api/conversations/direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientId:e})});if(s.ok){let e=await s.json();u(s=>s.find(s=>s.id===e.id)?s:[...s,e]),p(!1),y(e.id)}},[]),C=(0,r.useCallback)(()=>{fetch("/api/conversations").then(e=>e.json()).then(e=>u(e))},[]);return(0,s.jsxs)("div",{children:[(0,s.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(n.default,{variant:"secondary",size:"sm",onClick:a,children:"â† Back"}),(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Messages"})]}),(0,s.jsx)(n.default,{onClick:()=>p(!0),children:"+ New Message"})]})}),(0,s.jsx)("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 mt-8",children:(0,s.jsxs)("div",{className:"flex h-[calc(100vh-170px)] bg-white rounded-lg shadow-sm overflow-hidden",children:[(0,s.jsx)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:(0,s.jsx)(l,{conversations:j,currentUser:e,activeConversationId:b?.id,onConversationSelect:N,searchTerm:h,onSearchChange:f})}),(0,s.jsx)("div",{className:"w-2/3 flex flex-col",children:b?(0,s.jsx)(i.default,{currentUser:e,conversation:b,onViewProfile:o,isDetailsPanelOpen:!1,onToggleDetailsPanel:()=>{},onMarkAsRead:C},b.id):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center text-center",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Select a Conversation"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Choose a conversation from the left or start a new one."})]})})})]})}),(0,s.jsx)(d.default,{isOpen:g,onClose:()=>p(!1),title:"Start a New Conversation",children:(0,s.jsx)(c,{currentUser:e,onClose:()=>p(!1),onStartConversation:w})})]})};function m({user:e,initialConversations:r}){let a=(0,t.useRouter)();return(0,s.jsx)(x,{currentUser:e,initialConversations:r,onBack:()=>a.push("/"),onViewProfile:e=>a.push(`/profile/${e}`)})}e.s(["default",()=>m],29001)}]);